<!DOCTYPE html>





<html class="theme-next gemini" lang="en">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    search: {
      root: '/',
      path: ''
    },
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    }
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Uyouii&#39;s Blogs">
<meta property="og:url" content="https://uyouii.github.io/page/4/index.html">
<meta property="og:site_name" content="Uyouii&#39;s Blogs">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Uyouii&#39;s Blogs">
  <link rel="canonical" href="https://uyouii.github.io/page/4/">


<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Uyouii's Blogs</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  <div class="container sidebar-position-left page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Uyouii's Blogs</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">There are many things need to learn.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
    <ul id="menu" class="menu">
        
        
        
          
          <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
    </ul>
</nav>

</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://uyouii.github.io/2018/02/23/IO复用：select和poll/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Uyouii">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Uyouii's Blogs">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/02/23/IO复用：select和poll/" class="post-title-link" itemprop="url">IO复用：select和poll</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-02-23 17:17:07" itemprop="dateCreated datePublished" datetime="2018-02-23T17:17:07+08:00">2018-02-23</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-02 11:28:18" itemprop="dateModified" datetime="2019-08-02T11:28:18+08:00">2019-08-02</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unix-Network-Programming/" itemprop="url" rel="index"><span itemprop="name">Unix Network Programming</span></a></span>

                
                
              
            </span>
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h2 id="使用I-O复用的经典场合"><a href="#使用I-O复用的经典场合" class="headerlink" title="使用I/O复用的经典场合"></a>使用I/O复用的经典场合</h2><ul>
<li>当客户处理多个描述符（通常是交互式输入和网络套接字）时，必须使用I/O复用。</li>
<li>当一个客户端同时处理多个套接字时可能的。</li>
<li>如果一个TCP服务器既要处理监听套接字，又要处理已连接套接字。</li>
<li>如果一个服务器既要处理TCP，又要处理UDP，一般就要使用I/O复用。</li>
<li>如果一个服务器要处理多个服务器或者多个协议，一般要使用I/O复用。</li>
</ul>
<h2 id="select-函数"><a href="#select-函数" class="headerlink" title="select 函数"></a>select 函数</h2><p>该函数允许进程指示内核等待多个事件中的任何一个发生，并只在有一个或多个事件发生或经历一段指定的时间后才唤醒它。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/select.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">select</span><span class="params">(<span class="keyword">int</span> maxfdpl, fd_set *readset, fd_set *writeset, fd_set *exceptset, <span class="keyword">const</span> struct timeval *timeout)</span></span>;</span><br></pre></td></tr></table></figure>
<p>select函数修改由指针readset、writeset和exceptset所指向的描述符集，因而这三个参数都是值-结果参数。调用该函数时，我们所指定所关心的描述符的值，该函数返回时，结果将指示哪些描述符已就绪。该函数返回后，我们使用FD_ISSET宏来测试fd_set数据类型中的描述符。描述符集内任何与未就绪描述符对应的位返回时均清成0。每次重新调用select函数时，我们都得再次把所有描述符集内所关心的位置均置为1。</p>
<h2 id="描述符就绪条件"><a href="#描述符就绪条件" class="headerlink" title="描述符就绪条件"></a>描述符就绪条件</h2><h3 id="套接字准备好读"><a href="#套接字准备好读" class="headerlink" title="套接字准备好读"></a>套接字准备好读</h3><ol>
<li>该套接字接收缓冲区中的数据字节数大于等于套接字接收缓冲区低水位标记的当前大小。对这样的套接字执行读操作不会阻塞并将返回一个大于0的值。可以使用SO_RCVLOWAT套接字选项设置该套接字的低水位标记。对于TCP和UDP套接字，其默认值为1。</li>
<li>该连接的读半部关闭（也就是接收了FIN的TCP连接）。对于这样的套接字的读操作将不阻塞并返回0(也就是返回EOF)。</li>
<li>该套接字是一个监听套接字且已完成的连接数不为0。对这样的套接字的accept通常不会阻塞。</li>
<li>其上有一个套接字错误待处理。对这样的套接字的读操作将不阻塞并返回-1（也就是返回一个错误），同时把errno设置成确切的错误条件。这些待处理错误（pending error）也可以通过指定SO_ERROR套接字选项调用getsockopt获取并清除。</li>
</ol>
<h3 id="套接字准备好写"><a href="#套接字准备好写" class="headerlink" title="套接字准备好写"></a>套接字准备好写</h3><ol>
<li>该套接字发送缓冲区中的可用空间字节数大于等于套接字发送缓冲区低水位标记的当前大小，并且u后者该套接字已连接，或者该套接字不需要连接（如UDP套接字）。这意味着如果我们把这样的套接字设置为非阻塞，写操作将不阻塞并返回一个正值。可以使用SO_SNDLOWAT套接字选项来设置该套接字的低水位标记。对于TCP和UDP套接字而言，其默认值是2048。</li>
<li>该连接的写半部关闭，对这样的套接字的写操作将产生SIGPIPE信号。</li>
<li>使用非阻塞式connect的套接字已建立连接，或者connect已经以失败告终。</li>
<li>其上有一个套接字错误待处理。对这样的套接字的写操作将不阻塞并返回-1(也就是返回一个错误)，同时把errno设置成确切的错误条件。这些待处理的错误也可以通过指定的SO_ERROR套接字选项调用getsockopt获取并清除。</li>
</ol>
<p>当某个套接字发生错误时，它将由select标记为即可读又可写。</p>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://uyouii.github.io/2018/02/23/TCP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Uyouii">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Uyouii's Blogs">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/02/23/TCP/" class="post-title-link" itemprop="url">TCP</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-02-23 17:16:50" itemprop="dateCreated datePublished" datetime="2018-02-23T17:16:50+08:00">2018-02-23</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-02 11:28:18" itemprop="dateModified" datetime="2019-08-02T11:28:18+08:00">2019-08-02</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unix-Network-Programming/" itemprop="url" rel="index"><span itemprop="name">Unix Network Programming</span></a></span>

                
                
              
            </span>
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h2 id="TCP-状态转换图"><a href="#TCP-状态转换图" class="headerlink" title="TCP 状态转换图"></a>TCP 状态转换图</h2><p><img src="https://github.com/Uyouii/Uyouii.github.io/raw/master/images/TCP%20state.jpg" alt="image"></p>
<h2 id="TCP连接分组转换"><a href="#TCP连接分组转换" class="headerlink" title="TCP连接分组转换"></a>TCP连接分组转换</h2><p><img src="https://github.com/Uyouii/Uyouii.github.io/raw/master/images/tcp%20connection%20example.jpg" alt="image"></p>
<h2 id="捎带（piggybacking）"><a href="#捎带（piggybacking）" class="headerlink" title="捎带（piggybacking）"></a>捎带（piggybacking）</h2><p>服务器对于客户端请求的确认可以伴随其应答发生，这种做法称为捎带（piggybacking），它通常在服务器处理请求并产生应答的时间少于200ms时发生。</p>
<h2 id="TIME-WAIT状态"><a href="#TIME-WAIT状态" class="headerlink" title="TIME_WAIT状态"></a>TIME_WAIT状态</h2><p>在TCP链接中，执行主动关闭的那端会有TIME_WAIT状态。改端点停留在这个状态的持续时间时<strong>最长分节生命期 maximum segment lifetime，MSL</strong>的两倍，有时称为2MSL。</p>
<p>任何TCP的实现都需要为MSL选择一个值。MSL时任何IP数据报能够在因特网中存活的最长时间。这个时间是有限的，因为每个数据报含有一个称为<strong>跳限 hop limit</strong>的8位字段，它的最大值是255。虽然跳限不是真正的时间限制，但是仍然假设：具有最大跳限的分组在网络中存活的时间不会超过MSL秒。</p>
<p>分组在网路中的迷途通常是路由异常的结果。某个路由器崩溃或某两个路由器之间的某个链路断开时，路由协议需要花费数秒钟到数分钟的时间才能稳定并找出另一条通路。并且在这段时间内有可能发生路由循环(路由器A把分组发送给路由器B，而B再把他们发送回A)。</p>
<p>假设迷途的分组是一个TCP分节，在迷途期间，发送端TCP超时并重传该分组，而重传的分组却通过某条候选路径到达最终目的地。不久之后路由器修复，之前迷途的分组也最终被送到目的地。这个原来的分组称为<strong>迷途的重组分组 lost duplicate</strong>或<strong>漫游的重组分组 wandering duplicate</strong>。</p>
<h3 id="TIME-WAIT状态存在的理由"><a href="#TIME-WAIT状态存在的理由" class="headerlink" title="TIME_WAIT状态存在的理由"></a>TIME_WAIT状态存在的理由</h3><ol>
<li><strong>可靠地实现TCP全双工连接的终止</strong></li>
<li><strong>允许老的重复分节在网络中消逝</strong></li>
</ol>
<p>对于理由1，在TCP关闭连接的4次握手中，如果最终的ACK丢失了，服务器将重新发送它的最后的那个FIN，因此客户端必须维护状态信息，以允许它重新发送最终那个ACK。如果客户端不维护状态信息，它将相应一个rst，该分节将被服务器解释成一个错误。如果TCP打算执行所有必要的工作以彻底终止某个连接上的两个方向的数据流，那么它必须正确处理连接终止序列4个分节中任何一个分节丢失的情况。</p>
<p>执行主动关闭的那一端是处于TIME_WAIT状态的那一端，因为可能不得不重传最终的ACK的就是那一端。</p>
<p>对于理由2：假设服务端和客户端分别在1500端口和21端口之间有一个TCP连接。关闭这个连接之后，在相同的IP地址和端口之间建立另一个连接。后一个连接称为前一个连接的<code>化身 incarnation</code>，因为他们的IP地址和端口号都相同。</p>
<p>TCP必须防止来自某个连接的老的重复分组在该连接已终止后再现，从而被误解为属于同一连接的某个新的化身。为做到这一点，TCP将不给处于<code>TIME_WAIT</code>状态的连接发起新的化身。<code>TIME_WAIT</code>的持续时间是MSL的2倍，足以让某个方向上的分组最多存活MSL秒被丢弃，另一个方向上的应答最多存活MSL秒也被丢弃。通过这个规则可以保证没成功建立一个TCP连接时，来自该连接先前化身的重复分组都已在网络中消逝了。</p>
<h2 id="TCP输出"><a href="#TCP输出" class="headerlink" title="TCP输出"></a>TCP输出</h2><p>每一个TCP套接字都有一个发送缓冲区，可以使用<code>SO_SNDBUF</code>套接字选项来更改缓冲区的大小。当某个应用进程调用write时，内核从该应用进程的缓冲区复制所有数据写到套接字的发送缓冲区。</p>
<p>如果该套接字的发送缓冲区容不下应用进程的所有数据（或是应用进程的缓冲区大于套接字的发送缓冲区，或是套接字的发送缓冲区中已有其他数据），该应用进程将被投入睡眠。这里假设套接字是阻塞的（套接字默认设置是阻塞的）。内核将不从write系统调用返回，知道应用进程缓冲区中的所有数据都复制到套接字的发送缓冲区。</p>
<p>从写一个TCP套接字的write调用成功返回仅仅表示我们可以从重新使用原来的应用进程缓冲区，并不表明对端的TCP或应用进程已经接收到数据。</p>
<h2 id="PF-INET和AF-INET的区别"><a href="#PF-INET和AF-INET的区别" class="headerlink" title="PF_INET和AF_INET的区别"></a>PF_INET和AF_INET的区别</h2><p>AF: Address Family，表示地址族</p>
<p>PF: Protocol Family，表示协议族</p>
<p>在windows中的Winsock2.h中定义：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> AF_INET 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PF_INET AF_INET</span></span><br></pre></td></tr></table></figure></p>
<p>所以在windows中<code>AF_INET</code>与<code>PF_INET</code>完全一样。</p>
<p>而在Unix/Linux系统中，不同的版本这两者有微小的差别。对于BSD，是AF，对于POSIX，是PF。</p>
<p>理论上在建立socket时指定协议，应该用<code>PF_xxxx</code>，设置地址时应该用<code>AF_xxxx</code>。</p>
<p>当然<code>AF_INET</code>和<code>PF_INET</code>的值是相同的，混用也不会有太大问题。</p>
<h2 id="RST"><a href="#RST" class="headerlink" title="RST"></a>RST</h2><p>RST是TCP在发生错误时发送的一种TCP分节，产生RST的三个条件是：</p>
<ol>
<li>目的地为某端口的SYN到达，然而该端口上并没有正在监听的服务器</li>
<li>TCP想取消一个已有连接</li>
<li>TCP接收到一个根本不存在的连接上的分节</li>
</ol>
<h2 id="基于TCP客户-服务器程序的套接字函数"><a href="#基于TCP客户-服务器程序的套接字函数" class="headerlink" title="基于TCP客户/服务器程序的套接字函数"></a>基于TCP客户/服务器程序的套接字函数</h2><p><img src="https://github.com/Uyouii/Uyouii.github.io/raw/master/images/TCP%20client_server%20socket%20function.JPG" alt="image"></p>
<h2 id="connect-函数"><a href="#connect-函数" class="headerlink" title="connect 函数"></a>connect 函数</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">connect</span><span class="params">(<span class="keyword">int</span> sockfd, <span class="keyword">const</span> struct sockaddr* servaddr, <span class="keyword">socklen_t</span> addrlen)</span></span>;</span><br></pre></td></tr></table></figure>
<p>客户端在调用函数connect前不必非得调用connect函数，因为如果需要的话，内核会确定源IP地址，并选择一个临时端口作为源端口。</p>
<p>如果是TCP套接字，调用connect时会激发TCP的三次握手过程，而且仅在连接建立成功或出错时才返回。</p>
<p>出错有以下几种情况:</p>
<ol>
<li>若TCP客户端没有收到SYN分节的响应，则返回<code>ETIMEDOUT</code>错误。</li>
<li>若对客户的SYN的响应时RST，则表明该服务器主机在我们指定的端口上没有进程在等待与之连接。这是一种硬错误（hard error），客户一接收到RST就马上返回<code>ECONNECTREFUSED</code></li>
<li>若客户端发出的SYN在中间的某个路由器上引发了一个“destination unreachable”ICMP错误，则认为是一种软错误（soft error）。</li>
</ol>
<h2 id="bind函数"><a href="#bind函数" class="headerlink" title="bind函数"></a>bind函数</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">bind</span><span class="params">(<span class="keyword">int</span> sockfd, <span class="keyword">const</span> struct sockaddr *myaddr, <span class="keyword">socklen_t</span> addrlen)</span></span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>如果一个TCP客户端或者服务器未曾调用bind捆绑一个端口，当调用connect或者listen时，内核就要为相应的套接字选择一个临时端口。</li>
</ul>
<p>这个过程有一个例外：远程过程调用服务器（Remote Procedure Call，RPC）。他们通常由内核为他们的监听套接字选择一个临时端口，而该端口随后通过RPC端口映射器进行注册。客户在connect这个服务器之前，必须与端口映射器联系以获取他们的临时端口。</p>
<ul>
<li>进程可以把一个特地的IP地址捆绑到它的套接字上，不过这个IP地址必须属于其所在主机的网络接口之一。对于TCP客户，这就为在该套接字上发送的IP数据报指派了源IP地址。对于TCP服务器，这就限定该套接字只接收那些目的地为这个IP地址的客户连接。</li>
</ul>
<p>TCP客户通常不把IP地址捆绑到它的套接字上，当连接套接字时，内核将根据所用外出网络接口来选择源IP地址，而所用外出接口则取决于到达服务器所需的路径。如果TCP服务器没有把IP地址捆绑到它的套接字上，内核就把客户端发送的SYN的目的IP地址作为服务器的源IP地址。</p>
<p>如果指定端口号为0，那么内核就找bind被调用时选择一个临时端口。然而如果指定IP地址为通配地址，那么内核将等到套接字已连接（TCP）或已在套接字上发出数据报（UDP）时才选择一个本地IP地址。</p>
<p>如果想要得到内核所选择的临时端口值，必须调用函数getsockname来返回协议地址。</p>
<p>bind函数返回一个常见错误EADDRINUSE(“Adress already in use”，地址已使用)</p>
<h2 id="listen函数"><a href="#listen函数" class="headerlink" title="listen函数"></a>listen函数</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">listen</span><span class="params">(<span class="keyword">int</span> sockfd,<span class="keyword">int</span> backlog)</span></span></span><br></pre></td></tr></table></figure>
<p>listen函数仅由TCP服务器调用，它完成两件事情：</p>
<ol>
<li>当socket函数创建一个套接字时，它被假定为一个主动套接字，也就是说，它是一个将调用connect发起连接的客户端套接字。listen函数把一个未连接的套接字转换成一个被动套接字，指示内核应接受指向该套接字的连接请求。调用listen导致套接字从closed状态转换到LISTEN状态。</li>
<li>第二个参数规定了内核应该为相应套接字排队的最大连接个数。</li>
</ol>
<p>内核为任何一个给定的监听套接字维护两个队列：</p>
<ol>
<li>未完成连接队列（incomplete connection queue），每个这样的SYN分节对应其中一项：已由某个客户端发出并到达服务器，而服务器正在等待并完成相应的TCP三路握手过程。这些套接字处于SYN_RCVD状态。</li>
<li>已完成连接队列（complete connection queue），每个已完成三路握手的客户端对应其中一项，这些套接字处于ESTABLISHED状态。</li>
</ol>
<p>如果三路握手正常完成，该项就从未完成连接队列移到已完成队列的队尾。当进程调用accept时，已完成连接队列中的队头将返回给进程，如果该队列为空，那么进程将被投入睡眠，知道TCP在该队列中放入一项才唤醒它。</p>
<p>关于两个队列：</p>
<ol>
<li>listen函数的backlog参数曾被规定为这两个队列的总和的最大值。</li>
<li>源自Berkeley的实现给backlog增设了一个模糊因子（fudge factor）：把它乘以1.5得到未处理队列最大长度。</li>
<li>不要把backlog定义为0，如果不想让客户端连接到套接字上，可以关掉该监听套接字。</li>
<li>在三路握手正常完成的前提下（也就是说没有丢失分节，从而没有重传），未完成连接队列中的任何一项在其中的存留时间就是一个RTT，而RTT的值取决于特定的客户与服务器。</li>
<li>当一个客户SYN到达时，若这些队列是满的，TCP就忽略该分节，也就是不发送RST，这么做是因为：这种情况是暂时的，客户TCP将重发SYN。</li>
<li>在三路握手完成之后，但在服务器调用accept之前到达的数据应由服务器TCP排队，最大数据量为已连接套接字接收缓冲区大小。</li>
</ol>
<h2 id="accept函数"><a href="#accept函数" class="headerlink" title="accept函数"></a>accept函数</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">accept</span><span class="params">(<span class="keyword">int</span> sockfd, struct sockaddr *cliaddr, <span class="keyword">socklen_t</span> *addrlen)</span></span></span><br></pre></td></tr></table></figure>
<p>accept函数由TCP服务器调用，用于从已完成连接队列头返回下一个已完成连接。如果已完成连接队列为空，那么进程被投入睡眠（假设套接字为默认的阻塞方式）。</p>
<p>如果accept成功，那么其返回值是由内核自动生成的一个全新描述符，代表与说返回客户的TCP连接。 accept函数的第一个参数为监听套接字（listening socket）描述符（由socket创建，随后用作bind和listen的第一个参数的描述符），称它的返回值为已连接套接字（connected socket）。</p>
<p>一个服务器通常只创建一个监听套接字，它在该服务器的生命期内一直存在。内核为每个由服务器进程接收的客户连接创建一个已连接套接字（也就是说对于它的TCP三路握手过程已经完成）。当服务器完成对某个给定客户的服务时，相应的已连接套接字就被关闭。</p>
<h2 id="close函数"><a href="#close函数" class="headerlink" title="close函数"></a>close函数</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">close</span><span class="params">(<span class="keyword">int</span> sockfd)</span></span>;</span><br></pre></td></tr></table></figure>
<p>close将一个TCP套接字的默认行为是把该套接字标记成已关闭，然后立即返回到调用进程，该套接字不能再由调用进程使用。然而TCP尝试发送已排队等待发送到对端的任何数据，发送完毕后发生的是正常的TCP连接终止序列。</p>
<p>并发服务器中父进程关闭已连接套接字只是导致相应描述符的引用计数值减1。如果引用计数值仍大于0，这个close调用并不引发TCP的四分组连接终止序列。</p>
<p>如果确实想在某个TCP连接上发送FIN，那么可以改用shutdown函数以代替close。</p>
<p>如果父进程对每个accept返回的已连接套接字都不调用close，首先父进程最终将耗尽可用描述符，因为任何进程在任何时刻可拥有的打开着的描述符通常都是有限制的。更重要的是，没有一个客户端连接会被终止。当子进程关闭已连接套接字时，它的引用计数值将由2递减为1且保持为1，因为父进程永不关闭任何已连接的套接字。这将妨碍TCP连接终止序列的发生，导致连接一直打开。</p>
<h2 id="getsockname-和-getpeername函数"><a href="#getsockname-和-getpeername函数" class="headerlink" title="getsockname 和 getpeername函数"></a>getsockname 和 getpeername函数</h2><p>这两个函数或者返回与某个套接字关联的本地协议地址（getsockname），或者返回与某个套接字关联的外地协议地址（getpeername）。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getsockname</span><span class="params">(<span class="keyword">int</span> sockfd, struct sockaddr *localaddr, <span class="keyword">socklen_t</span> *addrlen)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getpeername</span><span class="params">(<span class="keyword">int</span> sockfd, struct sockaddr *peeraddr, <span class="keyword">socklen_t</span> *addrlen)</span></span>;</span><br></pre></td></tr></table></figure></p>
<h2 id="wait-和-waitpid-函数"><a href="#wait-和-waitpid-函数" class="headerlink" title="wait 和 waitpid 函数"></a>wait 和 waitpid 函数</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="keyword">pid_t</span> wait(<span class="keyword">int</span> *statloc);</span><br><span class="line"><span class="keyword">pid_t</span> waitpid(<span class="keyword">pid_t</span> pid, <span class="keyword">int</span> *statloc, <span class="keyword">int</span> options);</span><br></pre></td></tr></table></figure>
<p>函数wait和waitpid均返回两个值：已终止子进程的进程ID号，以及通过statloc指针返回的子进程终止状态（一个整数）。</p>
<p>如果调用wait的进程没有已终止的子进程，不够有一个或多个子进程仍在执行，那么wait将阻塞到现有子进程第一个终止为止。</p>
<p>waitpid函数就等待哪个进程以及是否阻塞给了更多的控制。首先，pid参数允许我们指定想等待的进程ID，值-1表示等待第一个终止的子进程。其次，option允许指定附加选项，最常用的选项是WNOHANG，它告知内核在没有已终止的子进程时不要阻塞。</p>
<h2 id="shutdown函数"><a href="#shutdown函数" class="headerlink" title="shutdown函数"></a>shutdown函数</h2><p>终止网络连接的常用方法是调用close函数。不过close有两个限制，却可以使用shutdown函数来避免。</p>
<ol>
<li>close把描述符的引用计数减1，仅在该计数变成0时才关闭套接字。使用shutdown可以不管引用计数就激发TCP的正常连接终止序列。</li>
<li>close终止读和写两个方向的数据传送。既然TCP连接是全双工的，有时候需要告知对端我们已经完成了数据发送，即使对端仍有数据要发送给我们。</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">shutdown</span><span class="params">(<span class="keyword">int</span> sockfd, <span class="keyword">int</span> howto)</span></span>;</span><br></pre></td></tr></table></figure>
<p>shutdown的行为依赖于howto参数的值：</p>
<ol>
<li>SHUT_RD 关闭连接的读这一半————套接字中不再有数据可接收，而且套接字接收缓冲区中的现有数据都被丢弃。进程不能再对这样的套接字调用任何读函数。对一个TCP套接字调用这样的shutdown函数后，由该套接字接收的来自对端的任何数据都被确认，然后丢弃。</li>
<li>SHUT_WR 关闭连接的写这一半————对于TCP套接字，则成为半关闭（half close）。当前留在套接字发送缓冲区中的数据将被发送掉，后跟TCP的正常的连接终止序列。不管套接字描述符的引用计数是否等于0，这样的写半部分关闭照样执行。进程不能在对这样的套接字调用任何写函数。</li>
<li>SHUT_RDWR 连接的读半部和写半部都关闭————这与调用shutdown两次等效：第一次调用指定SHUT_RD，第二次调用指定SHUT_WR。</li>
</ol>
<h2 id="网络编程时遇到的情况"><a href="#网络编程时遇到的情况" class="headerlink" title="网络编程时遇到的情况"></a>网络编程时遇到的情况</h2><ol>
<li>当fork子进程时，必须捕获SIGHLD信号。</li>
<li>当捕获信号时，必须处理被中断的系统调用。</li>
<li>SIGCHLD的信号处理函数必须正确编写，应使用waitpid函数以面留下僵死进程。</li>
</ol>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://uyouii.github.io/2018/02/23/网络知识/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Uyouii">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Uyouii's Blogs">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/02/23/网络知识/" class="post-title-link" itemprop="url">网络知识</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-02-23 17:16:20" itemprop="dateCreated datePublished" datetime="2018-02-23T17:16:20+08:00">2018-02-23</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-02 11:28:18" itemprop="dateModified" datetime="2019-08-02T11:28:18+08:00">2019-08-02</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unix-Network-Programming/" itemprop="url" rel="index"><span itemprop="name">Unix Network Programming</span></a></span>

                
                
              
            </span>
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h2 id="客户端端口号"><a href="#客户端端口号" class="headerlink" title="客户端端口号"></a>客户端端口号</h2><p>客户端通常使用短期存活的<strong>临时端口（ephemeral port）</strong>。这些端口号通常由传输层协议自动赋予客户端。客户通常不关心其临时端口的具体值，只需要确定该端口号在所在主机中是唯一的就行。传输协议代码要确保这种唯一性。</p>
<h2 id="MTU"><a href="#MTU" class="headerlink" title="MTU"></a>MTU</h2><p>maximum transmission unit, 最大传输单元。</p>
<p>许多网络有一个硬件规定的MTU。例如，以太网的MTU是1500字节。</p>
<p>在两个主机之间的路径最下的MTU称为<strong>路径MTU(path MTU)</strong>。两个主机相反方向上路径MTU可以不一致，因为在因特网中路由选择往往是不对称的，也就是说从A到B的路径和从B到A的路径可以不相同。</p>
<p>当一个IP数据报从某个接口送出时，如果它的大小超过相应链路的MTU，IPv4和IPv6都将执行<strong>分片(fragmentation)</strong>。这些片段在到达目的地之前通常不会被<strong>重组（reassembling）</strong>。IPv4主机对其产生的数据报执行分片，IPv4路由器对其转发的数据包执行分片。然而IPv6只有主机对其产生的数据报执行分片，IPv6路由器不对其转发的数据报执行分片。</p>
<p>IPv4和IPv6都定义了<strong>最小重组缓冲区大小（minimum reassembly buffer size）</strong>，它是IPv4或IPv6的任何实现都必须保证支持的最小数据报大小。其值对于IPv4是576字节，对于IPv6是1500字节。</p>
<p>TCP中有一个<strong>MSS（maximum segment size，最大分片大小）</strong>，用于向对端TCP通告对端在每个分节中能发送的最大TCP数据量。MSS的目的是告诉对端其重组缓冲区大小的实际值，从而避免试图分片。MSS经常设置成MTU减去IP和TCP首部固定长度。</p>
<p>在以太网中使用IPv4的MSS值为1460，使用IPv6的MSS值为</p>
<h2 id="PDU-协议数据单元-protocol-data-unit"><a href="#PDU-协议数据单元-protocol-data-unit" class="headerlink" title="PDU(协议数据单元 protocol data unit)"></a>PDU(协议数据单元 protocol data unit)</h2><p>计算机网络各层对等实体间交换的单位信息称为<strong>协议数据单元(PDU)</strong>，按照协议与服务之间的关系，除了最底层（物理层）外，每层的PDU通过紧邻下层提供给本层的服务接口，作为下层的<strong>服务数据单元</strong>(<strong>service data unit, SDU</strong>)传递给下层，并由下层完成本层的PDU交换。如果本层的PDU大小超过紧临下层的最大SDU限制，那么本层需要实现把SDU划分为若干个合适的片段让下层分开载送，再在相反的方向把这些碎片重组成PDU。</p>
<p>应用层实体(如客户或者服务器进程)间交换的PDU称为<strong>应用数据(application data)</strong>，其中在应用进程之间交换的时没有长度限制的单个双向字节流，在UDP应用进程之间交换的是其长度不超过UDP发送缓冲区大小的<strong>单个记录(record)</strong>，在SCTP应用进程之间交换的是没有总长度限制的单个或多个双向记录流。</p>
<p>传输层实体间交换的PDU称为<strong>消息(message)</strong>，其中TCP的PDU称为<strong>分节(segment)</strong>。消息或分节的长度是有限的。</p>
<p>在TCP传输中，发送端TCP把来自应用进程的字节流数据按顺序经分割后封装在各个分节中传送给接收端TCP，其中每个分节所封装的数据即可能是发送端应用进程单次输出操作的结果，也可能是连续数次输出操作的结果，而且每个分节所封装的单次输出操作的结果或者首尾两次输出操作的结果既可能是完整的，也可能是不完整的，具体取决于连接建立阶段由对端通告的<strong>最大分节大小(MSS, maximum segment size)</strong>，以及外出接口的<strong>最大传输单元(maximum transmission unit, MTU)</strong>。</p>
<p>UDP传输层相当简单，发送端UDP就把来自应用进程的单个记录整个封装在UDP消息中传送给接收端UDP。</p>
<p>SCTP引入了称为<strong>块</strong>(<strong>chunk</strong>)的数据单元，SCTP消息就由一个公共首部加上一个或多个块构成：公共首部类似UDP消息的首部，仅仅给出源目的端口号和整个SCTP消息的校验和；块既可以承载数据，也可以承载控制信息。发送端SCTP把来自应用进程的（一个或多个）记录流数据按照数据流内顺序和记录边界封装在各个DATA块中，并在DATA块首部记上各自的流ID。</p>
<p>一个记录通常对应一个DATA块，对于过长的记录，发送端SCTP既可以像UDP那样拒绝发送，也可以把他们拆分到多个DATA块中以便发送，接收端SCTP收取后把他们组合成单个记录上传。</p>
<p>网络成实体间交换的PDU称为<strong>IP数据报(IP datagram)</strong>，其长度有限：IPV4数据报最大65535字节，IPv6数据报最大65575字节。发送端IP把来自传输层的消息（或TCP分节）整个封装在IP数据报中传送。</p>
<p>链路层实体间交换的PDU称为<strong>帧（frame）</strong>，其长度取决于具体的接口。</p>
<p>IP数据报由IP首部和所承载的传输层数据构成。过长的IP数据报无法封装在单个帧中，需要首先对其SDU进行<strong>分片（fragementation）</strong>，再把分成对得各个<strong>片段（fragement）</strong>冠以新的IP首部封装到多个帧中。在一个IP数据包从源端传送到目的端的传送过程中，分片操作既可能发生在源端，也可能发生在途中。</p>
<p>T<strong>CP/IP协议族为提高效率会尽可能避免IP分片/重组操作</strong>：TCP根据MSS和MTU限定每个分节的大小以及SCTP根据MTU分片/重组过长记录都是这个目的（STCP的块捆绑这是为了避免IP分片/重组操作的前提下提高块传输效率）；另外，IPv6禁止在途中的分片操作（基于其路径MTU发现功能），IPv4也尽量避免这种操作。</p>
<p>不论是否分片，都由IP作为链路层的SDU传入链路层，并由链路层封装再帧中的数据称为<strong>分组（packet，俗称包）</strong>。一个分组既可能是一个完整的IP数据报，也可能是某个IP数据报的SDU的一个片段冠以新的IP首部的结果。</p>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://uyouii.github.io/2018/02/23/socket-编程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Uyouii">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Uyouii's Blogs">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/02/23/socket-编程/" class="post-title-link" itemprop="url">socket 编程</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-02-23 17:16:07" itemprop="dateCreated datePublished" datetime="2018-02-23T17:16:07+08:00">2018-02-23</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-02 11:28:18" itemprop="dateModified" datetime="2019-08-02T11:28:18+08:00">2019-08-02</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Unix-Network-Programming/" itemprop="url" rel="index"><span itemprop="name">Unix Network Programming</span></a></span>

                
                
              
            </span>
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h2 id="套接字"><a href="#套接字" class="headerlink" title="套接字"></a>套接字</h2><p>标识每个端点的两个值（IP地址和端口号）通常称为一个套接字。</p>
<p>TCP无法仅仅通过查看端口号来分离外来的分节到不同的端点。它必须查看套接字对的所有4个元素才能确定由哪个端点接收某个到达的分节。</p>
<h2 id="不同套接字地址结构比较"><a href="#不同套接字地址结构比较" class="headerlink" title="不同套接字地址结构比较"></a>不同套接字地址结构比较</h2><p><img src="https://github.com/Uyouii/Uyouii.github.io/raw/master/images/different%20address%20struct.JPG" alt="image"></p>
<h2 id="getsockopt-和-setsockopt-函数"><a href="#getsockopt-和-setsockopt-函数" class="headerlink" title="getsockopt 和 setsockopt 函数"></a>getsockopt 和 setsockopt 函数</h2><p>这两个函数仅用于套接字<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getsockopt</span><span class="params">(<span class="keyword">int</span> sockfd, <span class="keyword">int</span> level, <span class="keyword">int</span> optname, <span class="keyword">void</span> *optval, <span class="keyword">socklen_t</span> *optlen)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">setsockopt</span><span class="params">(<span class="keyword">int</span> sockfd, <span class="keyword">int</span> level, <span class="keyword">int</span> optname, <span class="keyword">const</span> <span class="keyword">void</span>* optval, <span class="keyword">socklen_t</span> optlen)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>optval是一个指向某个变量的指针，setsockopt从<code>*optval</code>中取得选项待设置的新值，getsockopt则把已获取的选项当前值存放到<code>*optval</code>中。</p>
<p>套接字选项粗分为两大基本类型：一是启用或者禁止某个特性的二元选项（称为标志选项），二是取得并返回我们可以设置或检查的特定值选项（称为值选项）。</p>
<p>当给这些标志选项调用getsockopt函数时，<code>*optval</code>是一个整数。<code>*optval</code>中返回的值为0表示相应选项被禁止，不为0表示相应选项被启用。</p>
<p>setsockopt函数需要一个不为0的<code>*optva</code>值来启用选项，一个为0的<code>*optval</code>值来禁止选项。</p>
<h2 id="套接字选项"><a href="#套接字选项" class="headerlink" title="套接字选项"></a>套接字选项</h2><h3 id="SO-KEEPALIVE-套接字选项"><a href="#SO-KEEPALIVE-套接字选项" class="headerlink" title="SO_KEEPALIVE 套接字选项"></a>SO_KEEPALIVE 套接字选项</h3><p>给一个TCP套接字设置保持存活（keep-alive）选项后，如果在2小时内在该套接字的任一方向上都没有数据交换，TCP就自动给对端发送一个保持存活探测分节(keep-alive probe)。这是一个对端必须响应的TCP分节。</p>
<p>发送该分节后：</p>
<ol>
<li>对端以期望的ACK响应。应用进程得不到通知（因为一切正常）。在又经过仍无动静的2小时后，TCP将发出另一个探测分节。</li>
<li>对端以rst响应，它告知本端TCP：对端已崩溃且已重新启动。该套接字的待处理错误被置为ECONNRESET，套接字本身则被关闭。</li>
<li>对端对保持存活探测分节没有任何响应。源自Berkeley的TCP将另外发送8个探测分节，两两相隔75秒，试图得到一个响应。TCP在发出第一个探测分节后11分15秒内若没有得到任何响应则放弃。</li>
</ol>
<p>如果根本没有对TCP的探测分节的响应，该套接字的待处理错误就被置为ETIMEOUT，套接字本身则被关闭，然而如果该套接字收到一个ICMP错误作为某个探测分节的响应，那就返回相应的错误，套接字本身也被关闭。</p>
<p>本选项的功能是检测对端主机是否崩溃或变得不可达。如果对端进程崩溃，它的TCP将跨连接发送一个FIN，这可以通过调用select很容易的检测到。同时也要认识到，即使对任何保持存活探测分节均无响应（第三种情况），我们也不能肯定对端主机已经崩溃，因而TCP可能会终止一个有效连接。</p>
<p>本选项一本由服务器调用，不过客户端也可以使用。服务器使用本选项是因为它们花大部分时间阻塞在等待穿越TCP的连接输入上，也就是说在等待客户端的请求。然而如果客户主机连接掉线、电源掉线或系统崩溃，服务器进程将永远不会知道，并将继续等待永远不会到达的输入。这种情况称为半开连接（half-open connection）。保持存活选项将检测出这些半开连接并终止他们。</p>
<h3 id="SO-RCVBUF-和-SO-SNDBUF-套接字选项"><a href="#SO-RCVBUF-和-SO-SNDBUF-套接字选项" class="headerlink" title="SO_RCVBUF 和 SO_SNDBUF 套接字选项"></a>SO_RCVBUF 和 SO_SNDBUF 套接字选项</h3><p>每个套接字都有一个发送缓冲区和一个接收缓冲区。</p>
<p>接收缓冲区被TCP、UDP和SCTP用来保存接收到的数据，知道由应用进程来读取。对于TCP来说，套接字接收缓冲区中可用空间的大小限定了TCP通告对端的窗口大小。TCP套接字接收缓冲区不可能溢出，因为不允许对端发出超过本端所通告窗口大小的数据。这就是TCP的流量控制，如果对端无视窗口大大小而发出了超过该窗口大小的数据，本端TCP将丢弃他们。UDP是没有流量控制的：较快的发送端可以很容易地淹没较慢的接收端，导致接收端的UDP丢弃数据报。事实上较快的发送端甚至可以淹没本机的网络接口，导致数据报被本机丢弃。</p>
<p>当设置TCP套接字接收缓冲区的大小时，函数调用的顺序很重要。这是因为TCP的窗口规模选项是在建立连接时用SYN分节与对端互换得到的。对于客户，这意味着SO_RCVBUF选项必须在调用connect之前设置；对于服务器，这意味着该选项必须在调用listen之前给监听套接字设置。给已连接套接字设置该选项对于可能存在的窗口规模选项没有任何影响，因为accept直到TCP的三路握手完成才会创建并返回已连接套接字。这就是必须给监听套接字设置本选项的原因。（套接字缓冲区的大小总是由新创建的已连接套接字从监听套接字继承而来）。</p>
<p>TCP套接字缓冲区的大小至少应该是相应连接的MSS值的四倍。这一点的依据是TCP快速恢复算法的工作机制。TCP发送端使用三个重复的确认来检测某个分节是否丢失。发现某个分节丢失后，接收端将给新收到的每个分节发送一个重复的确认，如果窗口大小不足以存放4个这样的分节，那就不可能连发三个重复的确认，从而无法激活快速恢复算法。</p>
<h3 id="TCP-NODELAY套接字选项"><a href="#TCP-NODELAY套接字选项" class="headerlink" title="TCP_NODELAY套接字选项"></a>TCP_NODELAY套接字选项</h3><p>开启TCP_NODELAY选项将禁止TCP的Nagle算法。</p>
<p>Nagle算法的目的在于减少广域网（WAN）上小分组的数目。该算法指出：如果某个给定连接上有待确认数据（outstanding dataa），那么原本应该作为用户写操作相应的在该连接上立即发送相应小分组的行为就不会发生，直到现有数据被确认为止。这里“小”的定义就是小于MSS的任何分组。TCP总是尽可能地发送最大大小的分组，Nagle算法的目的在于防止一个连接在任何时刻有多个小分组待确认。</p>
<p>Nalge算法常常与另一个TCP算法联合使用：ACK延滞算法（delayed ACK algorithm）。该算法使得TCP在收到数据后不立即发送ACK，而是等待一小段时间(典型值为50~200ms)，然后才发送ACK。TCP期待在这一小段时间内自身有数据发送回对端，被延滞的ACK就可以由这些数据捎带，从而省掉一个TCP分节。</p>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://uyouii.github.io/2018/02/02/python2-7-深入理解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Uyouii">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Uyouii's Blogs">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/02/02/python2-7-深入理解/" class="post-title-link" itemprop="url">python2.7 深入理解</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-02-02 11:04:13" itemprop="dateCreated datePublished" datetime="2018-02-02T11:04:13+08:00">2018-02-02</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-02 11:28:18" itemprop="dateModified" datetime="2019-08-02T11:28:18+08:00">2019-08-02</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/learning-python/" itemprop="url" rel="index"><span itemprop="name">learning python</span></a></span>

                
                
              
            </span>
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h2 id="tuple-和-list的异同"><a href="#tuple-和-list的异同" class="headerlink" title="tuple 和 list的异同"></a>tuple 和 list的异同</h2><ol>
<li>tuple是不可变的，list是可变的。</li>
<li>tuple表示的是结构，list表示的是顺序。</li>
<li>list不能当作dict的key，tuple可以。</li>
<li>由于元组支持的操作比列表小，所以元组的操作相对于list会快上一点点。(除非有巨量的数据需要去处理，否则这一点不需要特别强调)</li>
</ol>
<p>tuple所谓的不可变指的是指向的位置不可变。如果tuple中含有一个list，这个list的内容是可以变化的，因为list本身在内存中的分配不是连续的。</p>
<h2 id="while-else-和-for-else"><a href="#while-else-和-for-else" class="headerlink" title="while/else 和 for/else"></a>while/else 和 for/else</h2><p>循环可以有一个<code>else</code>子句<br>在循环迭代完整个列表(对于<code>for</code>)后或执行条件为<code>false</code>(对于<code>while</code>)时执行，但循环被<code>break</code>中止的情况下不会执行。</p>
<h2 id="三元运算符"><a href="#三元运算符" class="headerlink" title="三元运算符"></a>三元运算符</h2><p>value if condition else other_value</p>
<p>e.g.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">is_fat = <span class="literal">True</span></span><br><span class="line">state = <span class="string">"fat"</span> <span class="keyword">if</span> is_fat <span class="keyword">else</span> <span class="string">"not fat"</span></span><br></pre></td></tr></table></figure></p>
<h2 id="嵌套函数和闭包-Closure"><a href="#嵌套函数和闭包-Closure" class="headerlink" title="嵌套函数和闭包(Closure)"></a>嵌套函数和闭包(Closure)</h2><p>函数不仅可以定义在模块的最外层，还可以定义在另一个函数的内部，像这种定义在函数里面的函数称之为<code>嵌套函数</code>。</p>
<p>嵌套函数可以访问到其外层作用域中声明的非局部变量。</p>
<p>闭包却可以即使脱离函数本身的作用范围，局部变量还是可以被访问得到。</p>
<p>闭包的定义：<br>在一些语言中，在函数中可以（嵌套）定义另一个函数时，如果内部的函数引用了外部的函数的变量， 则可能产生闭包。运行时，一旦外部的 函数被执行，一个闭包就形成了， 闭包中包含了内部函数的代码，以及所需外部函数中的变量的引用。</p>
<p>闭包可以用来在一个函数与一组“私有”变量之间创建关联关系。 在给定函数被多次调用的过程中，这些私有变量能够保持其持久性。</p>
<blockquote>
<p>注意：python闭包必须通过嵌套函数定义实现，但是嵌套函数不一定是闭包。</p>
</blockquote>
<p>当一个函数在执行完以后，访问了嵌套作用域的局部变量，闭包就产生了。假如嵌套函数没有访问嵌套作用域的局部变量，它就不是闭包。</p>
<p>产生闭包必须具备三个条件：</p>
<ol>
<li>需要定义嵌套函数</li>
<li>嵌套函数需要引用enclosing function中的变量</li>
<li>enclosing function需要返回嵌套函数</li>
</ol>
<p>闭包的作用：<br>闭包可以避免全局变量的使用，并且可以隐藏一些数据的格式。同时也可以提供面向对象的方法。</p>
<p><a href="https://www.programiz.com/python-programming/closure" target="_blank" rel="noopener">Python Closures</a></p>
<h2 id="迭代器-Iterators"><a href="#迭代器-Iterators" class="headerlink" title="迭代器(Iterators)"></a>迭代器(Iterators)</h2><p>python中的迭代器是一个可以被迭代的对象，每次迭代返回一个数据元素。</p>
<p>python的迭代器对象必须要实现两个特殊的方法：<code>__iter()__</code>和<code>__next()__</code>，被称为<strong>iterator protocol</strong></p>
<p>如果我们可以从一个对象获取<code>iterator</code>，则把这个对象成为<code>iterable</code>。很多python内置的容器都是可迭代的，像list, tuple, string。</p>
<p>可以通过<code>next()</code>函数人工的迭代遍历迭代器中所有的元素，当没有数据返回时，函数会抛出<code>StopIteration</code>异常。</p>
<p>一个更优雅的使用迭代器的方式是使用<code>for</code>循环，<code>for</code>可以迭代任何能够返回迭代器的对象。</p>
<h3 id="for-的内部实现"><a href="#for-的内部实现" class="headerlink" title="for 的内部实现"></a>for 的内部实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> iterable:</span><br><span class="line">    <span class="comment"># do something with element</span></span><br></pre></td></tr></table></figure>
<p>实际实现：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># create an iterator object from that iterable</span></span><br><span class="line">iter_obj = iter(iterable)</span><br><span class="line"></span><br><span class="line"><span class="comment"># infinite loop</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># get the next item</span></span><br><span class="line">        element = next(iter_obj)</span><br><span class="line">        <span class="comment"># do something with element</span></span><br><span class="line">    <span class="keyword">except</span> StopIteration:</span><br><span class="line">        <span class="comment"># if StopIteration is raised, break from loop</span></span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure></p>
<p><code>for</code>语句首先通过调用<code>iter()</code>创建了一个迭代器对象：<code>iter_obj</code>。</p>
<p>在循环内部通过调用<code>next()</code>函数去获取下一个元素。在所有元素都处理完之后，<code>StopIteration</code>被抛出，并在循环内部被捕获，并保证其他类型的异常不被捕获。</p>
<h3 id="实现迭代器对象"><a href="#实现迭代器对象" class="headerlink" title="实现迭代器对象"></a>实现迭代器对象</h3><p>实现迭代器对象只需要实现两个方法：<code>__iter()__</code>和<code>__next()__</code></p>
<p><code>__iter()__</code>方法返回迭代器对象本身。如果需要的话，可以进行初始化的操作。</p>
<p><code>__next()__</code>方法返回序列中的下一个元素。当达到最后一个元素的下一个调用时必须抛出<code>StopIteration</code>异常。</p>
<p>for example：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PowTwo</span>:</span></span><br><span class="line">    <span class="string">"""Class to implement an iterator</span></span><br><span class="line"><span class="string">    of powers of two"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, max = <span class="number">0</span>)</span>:</span></span><br><span class="line">        self.max = max</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.n = <span class="number">0</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.n &lt;= self.max:</span><br><span class="line">            result = <span class="number">2</span> ** self.n</span><br><span class="line">            self.n += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br></pre></td></tr></table></figure></p>
<p><a href="https://www.programiz.com/python-programming/iterator" target="_blank" rel="noopener">Python Interators</a></p>
<h2 id="生成器-Generators"><a href="#生成器-Generators" class="headerlink" title="生成器(Generators)"></a>生成器(Generators)</h2><p>生成器是创建迭代器的一种简单的方式。简单的说，生成器就是可以返回一个可迭代对象的函数（每次返回一个元素）</p>
<p>生成器的创建非常简单，只需要把函数定义中的<code>return</code>替换为<code>yeild</code>即可。</p>
<p>如果一个函数中包含了至少一个<code>yeild</code>语句，这个函数就是生成器。<code>yeild</code>和<code>return</code>都会从函数中返回值。</p>
<p>不同的是，<code>return</code>语句会终止整个函数的执行，<code>yeild</code>语句会暂停函数的执行并且储存函数的状态，在下一次成功调用后继续执行。</p>
<p>生成器函数和普通函数的异同：</p>
<ol>
<li>生成器函数包含了一个或者多个<code>yelid</code>语句</li>
<li>当被调用时，生成器函数返回一个迭代器对象，但是函数不会立即开始执行。</li>
<li><code>__iter()__</code>方法和<code>__next()__</code>方法会被自动的实现，所以可以调用<code>next()</code>函数获取下一个元素。</li>
<li>当函数执行<code>yelid</code>语句时，函数会被暂停执行，控制权会返还给调用者</li>
<li>局部变量和他们的状态在成功的调用之间会被保存</li>
<li>当函数结束时，<code>StopIteration</code>会在下一次的调用时被自动抛出。</li>
</ol>
<p>每个生成器只能被调用一次，要重新开始生成器的调用可以创建一个新的生成器对象，像:<code>a = my_gen()</code></p>
<blockquote>
<p>可以直接在for循环中使用生成器</p>
</blockquote>
<h3 id="生成器表达式-Generator-Expression"><a href="#生成器表达式-Generator-Expression" class="headerlink" title="生成器表达式(Generator Expression)"></a>生成器表达式(Generator Expression)</h3><p>生成器表达式(generateor expression)的语法和列表推导式(list comprehension)的结构很像，只需要把方括号替换为圆括号。</p>
<p>generator expression和list comprehension最主要的区别就是list comprehension每次生成整个列表，但是generator expression每次生成一个元素。</p>
<p>genreator expression只有每次被调用的时候才会输出元素，所以generator expression比list comprehension在内存的使用上跟高效。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Initialize the list</span></span><br><span class="line">my_list = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># square each term using list comprehension</span></span><br><span class="line"><span class="comment"># Output: [1, 9, 36, 100]</span></span><br><span class="line">[x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> my_list]</span><br><span class="line"></span><br><span class="line"><span class="comment"># same thing can be done using generator expression</span></span><br><span class="line"><span class="comment"># Output: &lt;generator object &lt;genexpr&gt; at 0x0000000002EBDAF8&gt;</span></span><br><span class="line">(x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> my_list)</span><br></pre></td></tr></table></figure>
<p>generator expression可以被函数调用，这种情况下圆括号可以省去。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>sum(x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> my_list)</span><br><span class="line"><span class="number">146</span></span><br></pre></td></tr></table></figure></p>
<p><a href="https://www.programiz.com/python-programming/generator" target="_blank" rel="noopener">Python Generators</a></p>
<h2 id="装饰器-decorator"><a href="#装饰器-decorator" class="headerlink" title="装饰器(decorator)"></a>装饰器(decorator)</h2><p>装饰器可以向已经写好的代码中添加功能，程序的一部分可以在编译时修改程序的另一部分。</p>
<blockquote>
<p>everything in python are objects.</p>
</blockquote>
<p>python函数的一些特性：</p>
<ol>
<li>同一个函数对象可以绑定不同的函数名称</li>
<li>函数可以作为参数传递给另一个函数(这些函数也被称为higher order functions)</li>
<li>函数可以把函数当作返回值</li>
</ol>
<p>函数和方法被称为可调用的(called)。在python中任何实现<code>__call__()</code>方法的对象都称为可调用的(called)。</p>
<p>装饰器就是<code>callable</code>并返回<code>callable</code>的对象。</p>
<p>装饰器一般读取一个函数，为其添加功能然后返回。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_pretty</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">"I got decorated"</span>)</span><br><span class="line">        func()</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ordinary</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"I am ordinary"</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>ordinary()</span><br><span class="line">I am ordinary</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># let's decorate this ordinary function</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pretty = make_pretty(ordinary)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pretty()</span><br><span class="line">I got decorated</span><br><span class="line">I am ordinary</span><br></pre></td></tr></table></figure>
<p>可以使用@符号和装饰器名称一起使用，放在函数定义前，表示该函数使用该装饰器<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@make_pretty</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ordinary</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"I am ordinary"</span>)</span><br></pre></td></tr></table></figure></p>
<p>等价于<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ordinary</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">"I am ordinary"</span>)</span><br><span class="line">ordinary = make_pretty(ordinary)</span><br></pre></td></tr></table></figure></p>
<p>带参数的装饰器需要保证inner function的参数和被修饰的函数参数保持一致。可以用一种通用的装饰器的实现方法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">works_for_all</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">"I can decorate any function"</span>)</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> inner</span><br></pre></td></tr></table></figure></p>
<p><code>args</code>是位置参数的元组，<code>kwargs</code>是默认参数的字典。</p>
<p>同一个函数可以被多个装饰器装饰多次（可以是同一个装饰器）。</p>
<p><a href="https://www.programiz.com/python-programming/decorator" target="_blank" rel="noopener">Python Decorator</a></p>
<h2 id="属性（Property）"><a href="#属性（Property）" class="headerlink" title="属性（Property）"></a>属性（Property）</h2><p>property example:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Celsius</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, temperature = <span class="number">0</span>)</span>:</span></span><br><span class="line">        self.temperature = temperature</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_fahrenheit</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (self.temperature * <span class="number">1.8</span>) + <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_temperature</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"Getting value"</span>)</span><br><span class="line">        <span class="keyword">return</span> self._temperature</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_temperature</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> value &lt; <span class="number">-273</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"Temperature below -273 is not possible"</span>)</span><br><span class="line">        print(<span class="string">"Setting value"</span>)</span><br><span class="line">        self._temperature = value</span><br><span class="line"></span><br><span class="line">    temperature = property(get_temperature,set_temperature)</span><br></pre></td></tr></table></figure></p>
<p>我们在最后一行创造了一个property对象：<code>temperature</code>。任何获取<code>temperature</code>值的代码会自动调用<code>get_temperature()</code>方法，而不是向<code>__dict__</code>中查找，任何给<code>temperature</code>赋值的代码会自动调用<code>set_temperature()</code>。</p>
<p>在python中，<code>property()</code>是一个内置的函数，创建和返回一个property对象。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">property(fget=<span class="literal">None</span>, fset=<span class="literal">None</span>, fdel=<span class="literal">None</span>, doc=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure></p>
<p><code>fget</code>是获取属性的值的函数，<code>fset</code>是设置属性值的函数，<code>fdel</code>是删除属性的函数，<code>doc</code>是一个字符串（类似于注释）。</p>
<p>property对象有三个方法：<code>gettter()</code>,<code>setter()</code>和<code>delete()</code>用于设置<code>fget</code>,<code>fset</code>和<code>del</code>。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">temperature = property(get_temperature,set_temperature)</span><br></pre></td></tr></table></figure></p>
<p>可以等价于<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># make empty property</span></span><br><span class="line">temperature = property()</span><br><span class="line"><span class="comment"># assign fget</span></span><br><span class="line">temperature = temperature.getter(get_temperature)</span><br><span class="line"><span class="comment"># assign fset</span></span><br><span class="line">temperature = temperature.setter(set_temperature)</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>注意：python2中实现property时，需要继承object，否则setter无效。python3默认继承，所以没有问题。</p>
</blockquote>
<h3 id="使用装饰器实现property"><a href="#使用装饰器实现property" class="headerlink" title="使用装饰器实现property"></a>使用装饰器实现property</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Celsius</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, temperature = <span class="number">0</span>)</span>:</span></span><br><span class="line">        self._temperature = temperature</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_fahrenheit</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (self.temperature * <span class="number">1.8</span>) + <span class="number">32</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">temperature</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"Getting value"</span>)</span><br><span class="line">        <span class="keyword">return</span> self._temperature</span><br><span class="line"></span><br><span class="line"><span class="meta">    @temperature.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">temperature</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> value &lt; <span class="number">-273</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"Temperature below -273 is not possible"</span>)</span><br><span class="line">        print(<span class="string">"Setting value"</span>)</span><br><span class="line">        self._temperature = value</span><br></pre></td></tr></table></figure>
<p><a href="https://www.programiz.com/python-programming/property" target="_blank" rel="noopener">Python Property</a></p>
<h2 id="方法和函数的区别"><a href="#方法和函数的区别" class="headerlink" title="方法和函数的区别"></a>方法和函数的区别</h2><blockquote>
<p><strong>function(函数)</strong> —— A series of statements which returns some value toa caller. It can also be passed zero or more arguments which may beused in the execution of the body.</p>
</blockquote>
<blockquote>
<p><strong>method(方法)</strong> —— A function which is defined inside a class body. If called as an attribute of an instance of that class, the method will get the instance object as its first argument (which isusually called self).</p>
</blockquote>
<p>本质上，函数和方法的区别是：函数属于<code>FunctionObject</code>，而方法属于<code>PyMethodObject</code>。</p>
<p>e.g.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aa</span><span class="params">(d, na=None, *kasd, **kassd)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">a = A()</span><br><span class="line"><span class="keyword">print</span> aa</span><br><span class="line"><span class="keyword">print</span> A.f</span><br><span class="line"><span class="keyword">print</span> a.f</span><br></pre></td></tr></table></figure></p>
<p>结果：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;function aa at <span class="number">0x0000000004D995F8</span>&gt;</span><br><span class="line">&lt;unbound method A.f&gt;</span><br><span class="line">&lt;bound method A.f of &lt;__main__.A object at <span class="number">0x0000000004DB97F0</span>&gt;&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="Bound-Method-和-Unbound-Method"><a href="#Bound-Method-和-Unbound-Method" class="headerlink" title="Bound Method 和 Unbound Method"></a>Bound Method 和 Unbound Method</h3><p>method还可以分为bound method和unbound method，bound method多了一个实例绑定的过程。</p>
<p>A.f是unbound method，a.f是bound method</p>
<p>bound和unbound的判断依据就是，当方法真正执行时，有没有传入实例。</p>
<p>A.f(a)和a.f()用法的区别只在于，第一种需要认为传入实例才能调用，第二种虚拟机帮我们做好了传入实例的动作，两种方法本质上是等价的。</p>
<h2 id="类方法-classmethod-和静态方法-statimethod"><a href="#类方法-classmethod-和静态方法-statimethod" class="headerlink" title="类方法(classmethod)和静态方法(statimethod)"></a>类方法(classmethod)和静态方法(statimethod)</h2><blockquote>
<p><strong>@classmethod</strong> means: when this method is called, we pass the class as the first argument instead of the instance of that class (as we normally do with methods). This means you can use the class and its properties inside that method rather than a particular instance.</p>
</blockquote>
<blockquote>
<p><strong>@staticmethod</strong> means: when this method is called, we don’t pass an instance of the class to it (as we normally do with methods). This means you can put a function inside a class but you can’t access the instance of that class (this is useful when your method does not use the instance).</p>
</blockquote>
<p><code>classmethod</code> must have a reference to a class object as the first parameter, whereas <code>staticmethod</code> can have no parameters at all.</p>
<p>example:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Date</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, day=<span class="number">0</span>, month=<span class="number">0</span>, year=<span class="number">0</span>)</span>:</span></span><br><span class="line">        self.day = day</span><br><span class="line">        self.month = month</span><br><span class="line">        self.year = year</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_string</span><span class="params">(cls, date_as_string)</span>:</span></span><br><span class="line">        day, month, year = map(int, date_as_string.split(<span class="string">'-'</span>))</span><br><span class="line">        date1 = cls(day, month, year)</span><br><span class="line">        <span class="keyword">return</span> date1</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_date_valid</span><span class="params">(date_as_string)</span>:</span></span><br><span class="line">        day, month, year = map(int, date_as_string.split(<span class="string">'-'</span>))</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> day &lt;= <span class="number">31</span> <span class="keyword">and</span> month &lt;= <span class="number">12</span> <span class="keyword">and</span> year &lt;= <span class="number">3999</span></span><br><span class="line"></span><br><span class="line">date2 = Date.from_string(<span class="string">'11-09-2012'</span>)</span><br><span class="line">is_date = Date.is_date_valid(<span class="string">'11-09-2012'</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="class-method"><a href="#class-method" class="headerlink" title="class method"></a>class method</h3><p>现在如果有一种需求通过接收一个外部的格式化的字符串(形如dd-mm-yy)需要创造大量的<code>Date</code>的实例。</p>
<p>在C++中可以通过重载的方式实现这种操作(重载Date的构造函数)，但是python没有这种特性。</p>
<p>上述的<code>classmethod</code>方法中，<code>cls</code>这个对象承载的是这个类本身，而不是这个类的实例。并且在<code>cls</code>的子类中也可以获取到这个方法。</p>
<h3 id="static-method"><a href="#static-method" class="headerlink" title="static method"></a>static method</h3><p>静态方法和类方法很像，但是静态方法没有强制性参数的要求。</p>
<p>但是静态方法无法访问这个实例本身，也无法调用类的内部方法和变量。</p>
<p><a href="https://stackoverflow.com/questions/12179271/meaning-of-classmethod-and-staticmethod-for-beginner" target="_blank" rel="noopener">classmethod and staticmethod in stackoverflow</a></p>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://uyouii.github.io/2018/01/30/python2.7 基础知识/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Uyouii">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Uyouii's Blogs">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/01/30/python2.7 基础知识/" class="post-title-link" itemprop="url">python2.7 基础知识</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-01-30 21:13:58" itemprop="dateCreated datePublished" datetime="2018-01-30T21:13:58+08:00">2018-01-30</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-02 11:28:18" itemprop="dateModified" datetime="2019-08-02T11:28:18+08:00">2019-08-02</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/learning-python/" itemprop="url" rel="index"><span itemprop="name">learning python</span></a></span>

                
                
              
            </span>
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <p><a href="http://www.pythondoc.com/pythontutorial27/index.html" target="_blank" rel="noopener">python 入门指南</a></p>
<h2 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h2><ol>
<li><code>//</code>运算符用于 floor division 而无论操作数是什么类型。</li>
<li>可以使用 <code>**</code> 运算符计算幂乘方</li>
</ol>
<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><ol>
<li>使用 原始字符串，方法是在第一个引号前面加上一个 <code>r</code>，例如 <code>r&#39;C:\some\name&#39;</code></li>
<li>字符串文本能够分成多行。一种方法是使用三引号：<code>&quot;&quot;&quot;...&quot;&quot;&quot;</code> 或者 <code>&#39;&#39;&#39;...&#39;&#39;&#39;</code>。行尾换行符会被自动包含到字符串中，但是可以在行尾加上 <code>\</code> 来避免这个行为。</li>
<li>字符串可以由 <code>+</code> 操作符连接(粘到一起)，可以由 <code>*</code> 表示重复</li>
<li>相邻的两个字符串文本自动连接在一起，只用于两个字符串文本，不能用于字符串表达式，如果想连接多个变量或者连接一个变量和一个字符串文本，使用 <code>+</code></li>
<li><p>支持索引和切片。索引用于获得单个字符，切片 让你获得一个子字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>word = <span class="string">'Python'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>word[<span class="number">0</span>:<span class="number">2</span>]  <span class="comment"># characters from position 0 (included) to 2 (excluded)</span></span><br><span class="line"><span class="string">'Py'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>word[<span class="number">2</span>:<span class="number">5</span>]  <span class="comment"># characters from position 2 (included) to 5 (excluded)</span></span><br><span class="line"><span class="string">'tho'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Python字符串不可以被更改—它们是<strong>不可变</strong>的。因此，赋值给字符串索引的位置会导致错误。</p>
</li>
<li>内置函数 len() 返回字符串长度。</li>
</ol>
<h3 id="See-also"><a href="#See-also" class="headerlink" title="See also"></a>See also</h3><blockquote>
<p><a href="https://docs.python.org/2.7/library/stdtypes.html#typesseq" target="_blank" rel="noopener">Sequence Types — str, unicode, list, tuple, bytearray, buffer, xrange</a><br><br><br>字符串和下节描述的Unicode字符串是 序列类型 的例子，它们支持这种类型共同的操作。</p>
</blockquote>
<blockquote>
<p><a href="https://docs.python.org/2.7/library/stdtypes.html#string-methods" target="_blank" rel="noopener">String Methods</a><br><br><br>字符串和Unicode字符串都支持大量的方法用于基本的转换和查找。<br><br></p>
</blockquote>
<blockquote>
<p><a href="https://docs.python.org/2.7/library/string.html#new-string-formatting" target="_blank" rel="noopener">String Formatting</a><br><br><br>这里描述了使用 str.format() 进行字符串格式化的信息。</p>
</blockquote>
<blockquote>
<p><a href="https://docs.python.org/2.7/library/stdtypes.html#string-formatting" target="_blank" rel="noopener">String Formatting Operations</a><br><br><br>这里描述了旧式的字符串格式化操作，它们在字符串和Unicode字符串是 % 操作符的左操作数时调用。</p>
</blockquote>
<h2 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h2><ol>
<li>在迭代过程中修改迭代序列不安全(只有在使用链表这样的可变序列时才会有这样的情况)。如果你想要修改你迭代的序列(例如：复制选择项)，你可以迭代它的复本。</li>
<li><p>需要迭代链表索引的话，可以结合使用 range() 和 len()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [&apos;Mary&apos;, &apos;had&apos;, &apos;a&apos;, &apos;little&apos;, &apos;lamb&apos;]</span><br><span class="line">for i in range(len(a)):</span><br><span class="line">    print i, a[i]</span><br></pre></td></tr></table></figure>
</li>
<li><p>循环可以有一个<code>else</code>子句；它在循环迭代完整个列表(对于<code>for</code>)后或执行条件为false(对于<code>while</code>) 时执行，但循环被 <code>break</code>中止的情况下不会执行。</p>
</li>
<li><code>try</code>语句的<code>else</code>子句在未出现异常时运行，循环的<code>else</code>子句在未出现<code>break</code>时运行。</li>
</ol>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><ol>
<li>函数调用 会为函数局部变量生成一个新的符号表。确切地说，所有函数中的变量赋值都是将值存储在<strong>局部符号表</strong>。变量引用首先在局部符号表中查找，然后是包含函数的局部符号表，然后是全局符号表，最后是内置名字表。因此，全局变量不能在函数中直接赋值 (除非用<code>global</code>语句命名)，尽管他们可以被引用。</li>
<li>函数引用的实际参数在函数调用时引入局部符号表，因此，实参总是传值调用(这里的值总是一个对象引用，而不是该对象的值)。</li>
<li>没有 return 语句的函数确实会返回一个值： <code>None</code>。</li>
<li><strong>函数默认值只被赋值一次</strong>。这使得当默认值是可变对象时会有所不同，比如列表、字典或者大多数类的实例。</li>
<li><code>def</code>是一个可执行指令，只有<code>def</code>执行的时候才会计算默认默认参数的值</li>
<li>在函数调用中，关键字的参数必须跟随在位置参数的后面。</li>
<li>引入一个形如<code>**name</code>的参数时，它接收一个字典。形如<code>*name</code>的形式参数，它接收一个元组。</li>
<li>可以在调用函数时加一个<code>*</code>操作符来自动把参数列表拆开。使用 <code>**</code> 操作符分拆关键字参数为字典。</li>
</ol>
<h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">list.append(x)</span><br><span class="line">把一个元素添加到链表的结尾，相当于 a[len(a):] = [x]。</span><br><span class="line"></span><br><span class="line">list.extend(L)</span><br><span class="line">将一个给定列表中的所有元素都添加到另一个列表中，相当于 a[len(a):] = L。</span><br><span class="line"></span><br><span class="line">list.insert(i, x)</span><br><span class="line">在指定位置插入一个元素。第一个参数是准备插入到其前面的那个元素的索引。</span><br><span class="line">例如 a.insert(<span class="number">0</span>, x) 会插入到整个链表之前，而 a.insert(len(a), x) 相当于 a.append(x)。</span><br><span class="line"></span><br><span class="line">list.remove(x)</span><br><span class="line">删除链表中值为 x 的第一个元素。如果没有这样的元素，就会返回一个错误。</span><br><span class="line"></span><br><span class="line">list.pop([i])</span><br><span class="line">从链表的指定位置删除元素，并将其返回。</span><br><span class="line">如果没有指定索引，a.pop()返回最后一个元素。元素随即从链表中被删除。</span><br><span class="line"><span class="string">"方法中 i 两边的方括号表示这个参数是可选的，而不是要求你输入一对方括号。"</span></span><br><span class="line"></span><br><span class="line">list.index(x)</span><br><span class="line">返回链表中第一个值为 x 的元素的索引。如果没有匹配的元素就会返回一个错误。</span><br><span class="line"></span><br><span class="line">list.count(x)</span><br><span class="line">返回 x 在链表中出现的次数。</span><br><span class="line"></span><br><span class="line">list.sort(cmp=<span class="literal">None</span>, key=<span class="literal">None</span>, reverse=<span class="literal">False</span>)</span><br><span class="line">对链表中的元素就地进行排序（参数可以用来自定义排序方法）。</span><br><span class="line"></span><br><span class="line">list.reverse()</span><br><span class="line">就地倒排链表中的元素。</span><br></pre></td></tr></table></figure>
<h3 id="函数式编程工具"><a href="#函数式编程工具" class="headerlink" title="函数式编程工具"></a>函数式编程工具</h3><h4 id="filter"><a href="#filter" class="headerlink" title="filter()"></a>filter()</h4><p><code>filter(function, sequence)</code>返回一个 sequence(序列)，包括了给定序列中所有调用 function(item) 后返回值为 true 的元素(如果可能的话，会返回相同的类型)。<br>如果该序列 (sequence)是一个 str, unicode 或者 tuple，返回值必定是同一类型，否则，它总是 list。</p>
<h4 id="map"><a href="#map" class="headerlink" title="map()"></a>map()</h4><p><code>map(function, sequence)</code>为每一个元素依次调用 function(item) 并将返回值组成一个链表返回。</p>
<p>可以传入多个序列，函数也必须要有对应数量的参数，执行时会依次用各序列上对应的元素来调用函数(如果某些序列比其它的短，就用 None 来代替)。如果把 None 做为一个函数传入，则直接返回参数做为替代。</p>
<h4 id="reduce"><a href="#reduce" class="headerlink" title="reduce()"></a>reduce()</h4><p><code>reduce(function, sequence)</code>返回一个单值，它是这样构造的：首先以序列的前两个元素调用函数 function，再以返回值和第三个参数调用，依次执行下去。</p>
<p>如果序列中只有一个元素，就返回它，如果序列是空的，就抛出一个异常。</p>
<p>可以传入第三个参数作为初始值。如果序列是空的，就返回初始值，否则函数会先接收初始值和序列的第一个元素，然后是返回值和下一个元素，依此类推。</p>
<h3 id="列表推导式"><a href="#列表推导式" class="headerlink" title="列表推导式"></a>列表推导式</h3><p>列表推导式由包含一个表达式的括号组成，表达式后面跟随一个 for 子句，之后可以有零或多个 for 或 if 子句。结果是一个列表，由表达式依据其后面的 for 和 if 子句上下文计算而来的结果构成。</p>
<p>例如：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">squares = [x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[(x, y) <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] <span class="keyword">for</span> y <span class="keyword">in</span> [<span class="number">3</span>,<span class="number">1</span>,<span class="number">4</span>] <span class="keyword">if</span> x != y]</span><br><span class="line">[(<span class="number">1</span>, <span class="number">3</span>), (<span class="number">1</span>, <span class="number">4</span>), (<span class="number">2</span>, <span class="number">3</span>), (<span class="number">2</span>, <span class="number">1</span>), (<span class="number">2</span>, <span class="number">4</span>), (<span class="number">3</span>, <span class="number">1</span>), (<span class="number">3</span>, <span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> math <span class="keyword">import</span> pi</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[str(round(pi, i)) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">6</span>)]</span><br><span class="line">[<span class="string">'3.1'</span>, <span class="string">'3.14'</span>, <span class="string">'3.142'</span>, <span class="string">'3.1416'</span>, <span class="string">'3.14159'</span>]</span><br></pre></td></tr></table></figure></p>
<p>列表推导式可以嵌套。</p>
<p>例如：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>matrix = [</span><br><span class="line"><span class="meta">... </span>    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>],</span><br><span class="line"><span class="meta">... </span>    [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>],</span><br><span class="line"><span class="meta">... </span>    [<span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>],</span><br><span class="line"><span class="meta">... </span>]</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[[row[i] <span class="keyword">for</span> row <span class="keyword">in</span> matrix] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">4</span>)]</span><br><span class="line">[[<span class="number">1</span>, <span class="number">5</span>, <span class="number">9</span>], [<span class="number">2</span>, <span class="number">6</span>, <span class="number">10</span>], [<span class="number">3</span>, <span class="number">7</span>, <span class="number">11</span>], [<span class="number">4</span>, <span class="number">8</span>, <span class="number">12</span>]]</span><br></pre></td></tr></table></figure></p>
<h3 id="del语句"><a href="#del语句" class="headerlink" title="del语句"></a>del语句</h3><p><code>del</code>语句可以从列表中按给定的索引而不是值来删除一个子项。<br>它不同于有返回值的 pop() 方法。语句 del 还可以从列表中删除切片或清空整个列表(我们以前介绍过一个方法是将空列表赋值给列表的切片)。</p>
<p>del 也可以删除整个变量。</p>
<h2 id="元组和序列"><a href="#元组和序列" class="headerlink" title="元组和序列"></a>元组和序列</h2><p>一个元组由数个逗号分隔的值组成。</p>
<p>元组在输出时总是有括号的，以便于正确表达嵌套结构。在输入时可以有或没有括号，不过经常括号都是必须的(如果元组是一个更大的表达式的一部分)。</p>
<p>不能给元组的一个独立的元素赋值(尽管你可以通过联接和切割来模拟)。还可以创建包含可变对象的元组，例如链表。</p>
<p>元组是<strong>不可变的</strong>，通常包含不同种类的元素并通过分拆或索引访问（如果是 namedtuples，甚至可以通过属性）。列表是<strong>可变的</strong>，它们的元素通常是相同的类型并通过迭代访问。</p>
<p>构造包含零个或一个元素的元组：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>empty = ()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>singleton = <span class="string">'hello'</span>,    <span class="comment"># &lt;-- note trailing comma</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>可变参数(multiple assignment)其实只是元组封装和序列拆封的一个结合。</p>
</blockquote>
<h2 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h2><p>集合是一个无序不重复元素的集。集合对象还支持union(联合)，intersection(交)，difference(差)和 sysmmetric difference(对称差集)等数学运算。</p>
<p>大括号或set()函数可以用来创建集合。注意：想要创建空集合，你必须使用 set() 而不是 {}。后者用于创建空字典。</p>
<p>类似列表推导式，集合也有推导式语法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = &#123;x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="string">'abracadabra'</span> <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> <span class="string">'abc'</span>&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h2><p>字典以 关键字 为索引，关键字可以是任意<strong>不可变类型</strong>，通常用字符串或数值。如果元组中只包含字符串和数字，它可以作为关键字，如果它直接或间接地包含了可变对象，就不能当做关键字。</p>
<p>字典的主要操作是依据键来存储和析取值。也可以用<code>del</code>来删除键：值对(key:value)。</p>
<p>对一个字典执行<code>keys()</code>将返回一个字典中所有关键字组成的无序列表(如果你想要排序，只需使用 sorted())。</p>
<p>dict() 构造函数可以直接从 key-value 对中创建字典:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict([(<span class="string">'sape'</span>, <span class="number">4139</span>), (<span class="string">'guido'</span>, <span class="number">4127</span>), (<span class="string">'jack'</span>, <span class="number">4098</span>)])</span><br></pre></td></tr></table></figure></p>
<p>字典推导式可以从任意的键值表达式中创建字典:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;x: x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> (<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>)&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果关键字都是简单的字符串，有时通过关键字参数指定 key-value 对更为方便:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dict(sape=<span class="number">4139</span>, guido=<span class="number">4127</span>, jack=<span class="number">4098</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h2><p>模块可以包含执行语句，一般用来初始化模块，仅在第一次被导入的地方执行一次。</p>
<p>每个模块都有自己私有的符号表，被模块内所有的函数定义作为全局符号表使用。因此，模块的作者可以在模块内部使用全局变量，而无需担心它与某个用户的全局变量意外冲突。也可以引用模块函数的表示法访问模块的全局变量，<code>modname.itemname</code>。</p>
<blockquote>
<p>出于性能考虑，每个模块在每个解释器会话中只导入一遍。因此，如果修改了模块，需要重启解释器或者如果想交互式的测试这么一个模块，可以用<code>reload()</code>重新加载，例如 reload(modulename)。</p>
</blockquote>
<p>如果调用python module.py执行某个模块，此时改模块的<code>__name__</code>被设置为<code>__main__</code>。如果在模块后加入代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></p>
<p>就可以让此文件像作为模块导入时一样作为脚本执行。此代码只有在模块作为 “main” 文件执行时才被调用。如果模块被导入，则不会执行这段代码。</p>
<p>当导入一个叫<code>module</code>的模块时，解释器现在当前的目录中搜索名为<code>module.py</code>的文件，如果没有找到的话，接着会到sys.path变量中给出的目录列表中查找。</p>
<p>sys.path变量的初始值：</p>
<ol>
<li>输入脚本的目录(当前目录)。</li>
<li>环境变量<code>PYTHONPATH</code>表示的目录列表中搜索</li>
<li>Python 默认安装路径中搜索。</li>
</ol>
<p>如果在<code>name.py</code>所在的目录下存在一个名为<code>name.pyc</code>的文件，它会被视为<code>name</code>模块的预编译(<code>byte-compiled</code>,二进制编译版本)，对于引用了大量标准模块的短程序，可以提高启动速度。用于创建<code>name.pyc</code>的这一版<code>spam.py</code>的修改时间记录在<code>spam.pyc</code>文件中，如果两者不匹配，<code>.pyc</code>文件就被忽略。</p>
<h2 id="包"><a href="#包" class="headerlink" title="包"></a>包</h2><p>为了让 Python 将目录当做内容包，目录中必须包含<code>__init__.py</code>文件。这是为了避免一个含有烂俗名字的目录无意中隐藏了稍后在模块搜索路径中出现的有效模块，比如<code>string</code>。最简单的情况下，只需要一个空的<code>__init__.py</code>文件即可。当然它也可以执行包的初始化代码，或者定义<code>__all__</code>变量。</p>
<p>执行<code>from package import *</code>时，如果包中的<code>__init__.py</code>代码定义了一个名为<code>__all__</code>的列表，就会按照列表中给出的模块名进行导入。</p>
<p>显式或隐式相对位置导入都基于当前模块的命名。因为主模块的名字总是 <code>__main__</code>，Python 应用程序的主模块应该总是用绝对导入。</p>
<h2 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h2><p>try 语句按如下方式工作：</p>
<ul>
<li>首先，执行 try 子句(在 try 和 except 关键字之间的部分)。</li>
<li>如果没有异常发生，except 子句在 try 语句执行完毕后就被忽略了。</li>
<li><p>如果在 try 子句执行过程中发生了异常，那么该子句其余的部分就会被忽略。<br>如果异常匹配于 except 关键字后面指定的异常类型，<br>就执行对应的 except 子句。<br>然后继续执行 try 语句之后的代码。</p>
</li>
<li><p>如果发生了一个异常，在 except 子句中没有与之匹配的分支，<br>它就会传递到上一级 try 语句中。<br>如果最终仍找不到对应的处理语句，它就成为一个 未处理异常，终止程序运行，显示提示信息。</p>
</li>
</ul>
<p>一个 try 语句可能包含多个 except 子句，分别指定处理不同的异常。至多只会有一个分支被执行。异常处理程序只会处理对应的 try 子句中发生的异常，在同一个 try 语句中，其他子句中发生的异常则不作处理。一个 except 子句可以在括号中列出多个异常的名字，例如:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">except</span> (RuntimeError, TypeError, NameError):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></p>
<p>最后一个 except 子句可以省略异常名称，以作为通配符使用。你需要慎用此法，因为它会轻易隐藏一个实际的程序错误！可以使用这种方法打印一条错误信息，然后重新抛出异常(允许调用者处理这个异常):<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">except</span> IOError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">except</span> ValueError:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">raise</span></span><br></pre></td></tr></table></figure></p>
<p>try … except 语句可以带有一个 else子句 ，该子句只能出现在所有 except 子句之后。当 try 语句没有抛出异常时，需要执行一些代码，可以使用这个子句。</p>
<p><code>raise</code>语句允许程序员强制抛出一个指定的异常。要抛出的异常由<code>raise</code>的唯一参数标识。它必需是一个异常实例或异常类(继承自 Exception 的类)。<br>如果你需要明确一个异常是否抛出，但不想处理它，<code>raise</code>语句可以让你很简单的重新抛出该异常。</p>
<p>不管有没有发生异常，finally子句 在程序离开 try 后都一定会被执行。当 try 语句中发生了未被 except 捕获的异常(或者它发生在 except 或 else 子句中)，在 finally 子句执行完后它会被重新抛出。try 语句经由 break，continue 或 return 语句退出也一样会执行 finally 子句。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">raise</span> KeyboardInterrupt</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'Goodbye, world!'</span></span><br></pre></td></tr></table></figure></p>
<h2 id="类"><a href="#类" class="headerlink" title="类"></a>类</h2><h3 id="命名空间和作用域"><a href="#命名空间和作用域" class="headerlink" title="命名空间和作用域"></a>命名空间和作用域</h3><p>命名空间 是从命名到对象的映射。当前命名空间主要是通过 Python 字典实现的。</p>
<p>不同命名空间中的命名没有任何联系。</p>
<p>不同的命名空间在不同的时刻创建，有不同的生存期。包含内置命名的命名空间在 Python 解释器启动时创建，会一直保留，不被删除。模块的全局命名空间在模块定义被读入时创建，通常，模块命名空间也会一直保存到解释器退出。由解释器在最高层调用执行的语句，不管它是从脚本文件中读入还是来自交互式输入，都是<code>__main__</code>模块的一部分，所以它们也拥有自己的命名空间(内置命名也同样被包含在一个模块中，它被称作<code>__builtin__</code>)。</p>
<p>当调用函数时，就会为它创建一个局部命名空间，并且在函数返回或抛出一个并没有在函数内部处理的异常时被删除。每个递归调用都有自己的局部命名空间。</p>
<h4 id="作用于访问顺序："><a href="#作用于访问顺序：" class="headerlink" title="作用于访问顺序："></a>作用于访问顺序：</h4><p>包含局部命名的使用域在最里面，首先被搜索；其次搜索的是中层的作用域，这里包含了同级的函数；最后搜索最外面的作用域，它包含内置命名。</p>
<ul>
<li>首先搜索最内层的作用域，它包含局部命名任意函数包含的作用域，是内层嵌套作用域搜索起点，包含非局部，但是也非全局的命名</li>
<li>接下来的作用域包含当前模块的全局命名</li>
<li>最外层的作用域(最后搜索)是包含内置命名的命名空间。</li>
</ul>
<p>一个定义于某模块中的函数的全局作用域是该模块的命名空间，而不是该函数的别名被定义或调用的位置。</p>
<h3 id="类对象"><a href="#类对象" class="headerlink" title="类对象"></a>类对象</h3><p>类对象支持两种操作：属性引用和实例化。</p>
<p>类定义了<code>__init__()</code>方法的话，类的实例化操作会自动为新创建的类实例调用<code>__init__()</code>方法。</p>
<p>和局部变量一样，数据属性不需要声明，第一次使用时它们就会生成。</p>
<p>类中所有(用户定义)的函数对象对应它的实例中的方法。实例中的函数是方法对象，不是函数对象。</p>
<p>例子：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>:</span></span><br><span class="line">    <span class="string">"""A simple example class"""</span></span><br><span class="line">    i = <span class="number">12345</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'hello world'</span></span><br><span class="line">x = MyClass()</span><br></pre></td></tr></table></figure></p>
<p>方法的特别之处在于实例对象作为函数的第一个参数传给了函数。</p>
<p>调用<code>x.f()</code>相当于<code>MyClass.f(x)</code></p>
<blockquote>
<p>引用非数据属性的实例属性时，会搜索它的类。如果这个命名确认为一个有效的函数对象类属性，就会将实例对象和函数对象封装进一个抽象对象：这就是方法对象。以一个参数列表调用方法对象时，它被重新拆 封，用实例对象和原始的参数列表构造一个新的参数列表，然后函数对象调用这个新的参数列表。</p>
</blockquote>
<p>一般来说，<code>实例变量</code>用于对每一个实例都是唯一的数据，<code>类变量</code>用于类的所有实例共享的属性和方法。</p>
<p>数据属性会覆盖同名的方法属性。</p>
<p>方法可以像引用普通的函数那样引用全局命名。与方法关联的全局作用域是包含类定义的模块(类本身永远不会做为全局作用域使用)。</p>
<blockquote>
<p>对于 C++ 程序员来说，Python 中的所有方法本质上都是虚方法</p>
</blockquote>
<p>派生类中的覆盖方法可能是想要扩充而不是简单的替代基类中的重名方法。有一个简单的方法可以直接调用基类方法，只要调用：<code>BaseClassName.methodname(self, arguments)</code>。</p>
<h2 id="实用技巧"><a href="#实用技巧" class="headerlink" title="实用技巧"></a>实用技巧</h2><ul>
<li><p>在Python源文件中可以使用非 ASCII 编码。最好的方法是在 #! 行的后面再增加一行特殊的注释来定义源文件的编码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: encoding -*-</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><a href="http://www.pythondoc.com/pythontutorial27/classes.html#tut-iterators" target="_blank" rel="noopener">迭代器</a></p>
</li>
<li><p><a href="http://www.pythondoc.com/pythontutorial27/classes.html#tut-generators" target="_blank" rel="noopener">生成器</a></p>
</li>
<li><p><a href="http://www.pythondoc.com/pythontutorial27/inputoutput.html" target="_blank" rel="noopener">格式化输入和输出</a></p>
</li>
<li><p><a href="http://www.pythondoc.com/pythontutorial27/inputoutput.html#tut-files" target="_blank" rel="noopener">文件读写</a></p>
</li>
<li><p>序列中循环时，索引位置和对应值可以使用<code>enumerate()</code>函数同时得到:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i, v <span class="keyword">in</span> enumerate([<span class="string">'tic'</span>, <span class="string">'tac'</span>, <span class="string">'toe'</span>]):</span><br><span class="line"><span class="meta">... </span>    print(i, v)</span><br></pre></td></tr></table></figure>
</li>
<li><p>同时循环两个或更多的序列，可以使用 zip() 整体打包:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>questions = [<span class="string">'name'</span>, <span class="string">'quest'</span>, <span class="string">'favorite color'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>answers = [<span class="string">'lancelot'</span>, <span class="string">'the holy grail'</span>, <span class="string">'blue'</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> q, a <span class="keyword">in</span> zip(questions, answers):</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> <span class="string">'What is your &#123;0&#125;?  It is &#123;1&#125;.'</span>.format(q, a)</span><br></pre></td></tr></table></figure>
</li>
<li><p>需要逆向循环序列的话，先正向定位序列，然后调用 reversed() 函数:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> i <span class="keyword">in</span> reversed(xrange(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>)):</span><br><span class="line"><span class="meta">... </span>    print(i)</span><br></pre></td></tr></table></figure>
</li>
<li><p>sorted() 函数不改动原序列，而是生成一个新的已排序的序列。</p>
</li>
<li><p>遍历字典时，使用 iteritems() 方法可以同时得到键和对应的值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>knights = &#123;<span class="string">'gallahad'</span>: <span class="string">'the pure'</span>, <span class="string">'robin'</span>: <span class="string">'the brave'</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> k, v <span class="keyword">in</span> knights.iteritems():</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">print</span> k, v</span><br></pre></td></tr></table></figure>
</li>
<li><p>在循环内部修改正在遍历的序列，应首先制作副本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">words = [<span class="string">'cat'</span>, <span class="string">'window'</span>, <span class="string">'defenestrate'</span>]</span><br><span class="line"><span class="keyword">for</span> w <span class="keyword">in</span> words[:]:  <span class="comment"># Loop over a slice copy of the entire list.</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>print 用一个逗号结尾就可以禁止输出换行</p>
</li>
</ul>
<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><ol>
<li><code>is</code> 用来判断两个对象是否是同一个对象，<code>==</code> 用来判断两个对象是否相等</li>
</ol>
<h2 id="编码风格"><a href="#编码风格" class="headerlink" title="编码风格"></a>编码风格</h2><ul>
<li>使用 4 空格缩进，而非 TAB。</li>
<li>在小缩进(可以嵌套更深)和大缩进(更易读)之间，4 空格是一个很好的折中。TAB 引发了一些混乱，最好弃用。</li>
<li>折行以确保其不会超过 79 个字符。</li>
<li>这有助于小显示器用户阅读，也可以让大显示器能并排显示几个代码文件。</li>
<li>使用空行分隔函数和类，以及函数中的大块代码。</li>
<li>可能的话，注释独占一行</li>
<li>使用文档字符串</li>
<li>把空格放到操作符两边，以及逗号后面，但是括号里侧不加空格：a = f(1, 2) + g(3, 4)。</li>
<li>统一函数和类命名。</li>
<li>推荐类名用 驼峰命名，函数和方法名用小写_和_下划线。总是用self作为方法的第一个参数(关于类和方法的知识详见 初识类)。</li>
<li>不要使用花的编码，如果你的代码的目的是要在国际化环境。Python的默认情况下，UTF-8，甚至普通的 ASCII 总是工作的最好。</li>
<li>同样，也不要使用非 ASCII 字符的标识符，除非是不同语种的会阅读或者维护代码。</li>
</ul>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://uyouii.github.io/2018/01/30/Lua-Table-Parser/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Uyouii">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Uyouii's Blogs">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/01/30/Lua-Table-Parser/" class="post-title-link" itemprop="url">Lua Table Parser</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-01-30 18:03:35" itemprop="dateCreated datePublished" datetime="2018-01-30T18:03:35+08:00">2018-01-30</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-02 11:28:18" itemprop="dateModified" datetime="2019-08-02T11:28:18+08:00">2019-08-02</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a></span>

                
                
              
            </span>
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <h1 id="Lua-Table-Parser-使用说明"><a href="#Lua-Table-Parser-使用说明" class="headerlink" title="Lua Table Parser 使用说明"></a>Lua Table Parser 使用说明</h1><p>PyLuaTblParser类中有两个私有变量：</p>
<ol>
<li><code>self.str_praser</code>是类<code>LuaStrParser</code>的实例，用来实现lua字符串的解析。</li>
<li><code>self.lua_table</code>是一个<code>dict</code>或者<code>list</code>，用来储存从lua table字符串或者其他dict中读取的数据。</li>
</ol>
<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load</span><span class="params">(self, s)</span>:</span></span><br><span class="line">读取Lua table数据，输入s为一个符合Lua table定义的字符串，无返回值</span><br><span class="line">遇到Lua table格式错误则抛出异常</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dump</span><span class="params">(self)</span>:</span></span><br><span class="line">根据类中数据返回Lua table字符串</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadLuaTable</span><span class="params">(self, f)</span>:</span></span><br><span class="line">从文件中读取Lua table字符串，f为文件路径，遇到Lua Table的格式错误则抛出异常，文件操作失败抛出异常</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dumpLuaTable</span><span class="params">(self, f)</span>:</span></span><br><span class="line">将类中的内容以Lua table格式存入文件，f为文件路径，文件若存在则覆盖，文件操作失败抛出异常</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loadDict</span><span class="params">(self, d)</span>:</span></span><br><span class="line">读取dict中的数据，存入类中，只处理数字和字符串两种类型的key，其他类型的key直接忽略</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dumpDict</span><span class="params">(self)</span>:</span></span><br><span class="line">返回一个dict，包含类中的数据</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self, d)</span>:</span></span><br><span class="line">用字典d更新类中的数据，类似于字典的update</span><br><span class="line"></span><br><span class="line">PyLuaTblParser类支持用[]进行赋值、读写数据的操作，类似字典</span><br></pre></td></tr></table></figure>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LuaStrParser</span>:</span></span><br><span class="line">    __spaceChars = [<span class="string">' '</span>, <span class="string">'\t'</span>, <span class="string">'\n'</span>, <span class="string">'\r'</span>]</span><br><span class="line">    __stopChars = [<span class="string">' '</span>, <span class="string">'\t'</span>, <span class="string">'\n'</span>, <span class="string">'\r'</span>, <span class="string">'='</span>, <span class="string">','</span>, <span class="string">';'</span>, <span class="string">'&#125;'</span>, <span class="string">']'</span>]</span><br><span class="line">    keyTypes = [int, float, str]</span><br><span class="line"></span><br><span class="line">    __specialChars = &#123;</span><br><span class="line">        <span class="string">'a'</span>: <span class="string">'\a'</span>, <span class="string">'b'</span>: <span class="string">'\b'</span>, <span class="string">'f'</span>: <span class="string">'\f'</span>, <span class="string">'n'</span>: <span class="string">'\n'</span>, <span class="string">'r'</span>: <span class="string">'\r'</span>, <span class="string">'t'</span>: <span class="string">'\t'</span>, <span class="string">'v'</span>: <span class="string">'\v'</span>,</span><br><span class="line">        <span class="string">'\\'</span>: <span class="string">'\\'</span>, <span class="string">'"'</span>: <span class="string">'"'</span>, <span class="string">"'"</span>: <span class="string">"'"</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    __reverseSpecialChars = &#123;</span><br><span class="line">        <span class="string">'\a'</span>: <span class="string">'\\a'</span>, <span class="string">'\b'</span>: <span class="string">'\\b'</span>, <span class="string">'\f'</span>: <span class="string">'\\f'</span>, <span class="string">'\n'</span>: <span class="string">'\\n'</span>, <span class="string">'\r'</span>: <span class="string">'\\r'</span>, <span class="string">'\t'</span>: <span class="string">'\\t'</span>, <span class="string">'\v'</span>: <span class="string">'\\v'</span>,</span><br><span class="line">        <span class="string">'\\'</span>: <span class="string">'\\\\'</span>, <span class="string">'"'</span>: <span class="string">'\\"'</span>, <span class="string">"'"</span>: <span class="string">"\\'"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__lua_object = <span class="literal">None</span></span><br><span class="line">        self.__lua_str = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__jumpSpace</span><span class="params">(self, string, loc)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> loc &lt; len(string) <span class="keyword">and</span> string[loc] <span class="keyword">in</span> self.__spaceChars:</span><br><span class="line">            loc += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> loc</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getBackSlashNum</span><span class="params">(self, lua_str, loc)</span>:</span></span><br><span class="line">        backslash_num = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> loc &gt;= <span class="number">0</span> <span class="keyword">and</span> lua_str[loc] == <span class="string">'\\'</span>:</span><br><span class="line">            loc -= <span class="number">1</span></span><br><span class="line">            backslash_num += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> backslash_num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getStringEnd</span><span class="params">(self, lua_str, loc, quote)</span>:</span></span><br><span class="line">        result = loc + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> lua_str[loc] == quote:</span><br><span class="line">            end = lua_str.find(quote, loc + <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> end != loc + <span class="number">1</span>:</span><br><span class="line">                at_end = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">while</span> <span class="keyword">not</span> at_end:</span><br><span class="line">                    <span class="keyword">if</span> self.__getBackSlashNum(lua_str, end - <span class="number">1</span>) % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">                        at_end = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> at_end:</span><br><span class="line">                        end = lua_str.find(quote, end + <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> end &lt; <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">"wrong quotes!"</span>)</span><br><span class="line">            result = end</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getStringConent</span><span class="params">(self, lua_str, loc)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        return the string in the  @para lua_str</span></span><br><span class="line"><span class="string">        thee result contain the quotes"""</span></span><br><span class="line">        loc = self.__jumpSpace(lua_str, loc)</span><br><span class="line">        result = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> lua_str[loc] == <span class="string">'"'</span> <span class="keyword">or</span> lua_str[loc] == <span class="string">"'"</span>:</span><br><span class="line">            end = self.__getStringEnd(lua_str, loc, lua_str[loc])</span><br><span class="line">            result = lua_str[loc: end + <span class="number">1</span>]</span><br><span class="line">            loc = end + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> result, loc</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__removeComment</span><span class="params">(self, lua_str)</span>:</span></span><br><span class="line">        result = <span class="string">""</span></span><br><span class="line">        loc = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> loc &lt; len(lua_str):</span><br><span class="line">            <span class="comment"># string should be add in result directly</span></span><br><span class="line">            <span class="keyword">if</span> lua_str[loc] == <span class="string">'"'</span> <span class="keyword">or</span> lua_str[loc] == <span class="string">"'"</span>:</span><br><span class="line">                string, loc = self.__getStringConent(lua_str, loc)</span><br><span class="line">                result += string</span><br><span class="line">            <span class="comment"># remove comment</span></span><br><span class="line">            <span class="keyword">elif</span> lua_str[loc] == <span class="string">'-'</span>:</span><br><span class="line">                <span class="keyword">if</span> loc + <span class="number">1</span> &lt; len(lua_str) <span class="keyword">and</span> lua_str[loc + <span class="number">1</span>] == <span class="string">'-'</span>:</span><br><span class="line">                    loc += <span class="number">2</span></span><br><span class="line">                    <span class="comment"># multi line comments</span></span><br><span class="line">                    <span class="keyword">if</span> loc + <span class="number">1</span> &lt; len(lua_str) <span class="keyword">and</span> lua_str[loc:loc + <span class="number">2</span>] == <span class="string">'[['</span>:</span><br><span class="line">                        loc = lua_str.find(<span class="string">']]'</span>, loc + <span class="number">1</span>) + <span class="number">2</span></span><br><span class="line">                    <span class="comment"># single line comment</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        loc = lua_str.find(<span class="string">'\n'</span>, loc + <span class="number">1</span>) + <span class="number">1</span></span><br><span class="line">                    <span class="comment"># add a space after remove the comment</span></span><br><span class="line">                    result += <span class="string">' '</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    result += lua_str[loc]</span><br><span class="line">                    loc += <span class="number">1</span></span><br><span class="line">            <span class="comment"># remove '\r'</span></span><br><span class="line">            <span class="keyword">elif</span> lua_str[loc] == <span class="string">'\r'</span>:</span><br><span class="line">                loc += <span class="number">1</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result += lua_str[loc]</span><br><span class="line">                loc += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getRightBrace</span><span class="params">(self, lua_str, loc)</span>:</span></span><br><span class="line">        loc = lua_str.find(<span class="string">'&#123;'</span>, loc) + <span class="number">1</span></span><br><span class="line">        left_barce_num = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> loc &lt; len(lua_str):</span><br><span class="line">            <span class="keyword">if</span> lua_str[loc] == <span class="string">'"'</span> <span class="keyword">or</span> lua_str[loc] == <span class="string">"'"</span>:</span><br><span class="line">                loc = self.__getStringEnd(lua_str, loc, lua_str[loc]) + <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> lua_str[loc] == <span class="string">'&#123;'</span>:</span><br><span class="line">                left_barce_num -= <span class="number">1</span></span><br><span class="line">                loc += <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> lua_str[loc] == <span class="string">'&#125;'</span>:</span><br><span class="line">                left_barce_num += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> left_barce_num &gt;= <span class="number">1</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                loc += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                loc += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> loc == len(lua_str):</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">"wrong number of brace"</span>)</span><br><span class="line">        <span class="keyword">return</span> loc</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getRightBracket</span><span class="params">(self, lua_str, loc)</span>:</span></span><br><span class="line">        loc = lua_str.find(<span class="string">'['</span>, loc) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> loc &lt; len(lua_str):</span><br><span class="line">            <span class="keyword">if</span> lua_str[loc] == <span class="string">'"'</span> <span class="keyword">or</span> lua_str[loc] == <span class="string">"'"</span>:</span><br><span class="line">                loc = self.__getStringEnd(lua_str, loc, lua_str[loc]) + <span class="number">1</span></span><br><span class="line">            <span class="keyword">elif</span> lua_str[loc] == <span class="string">']'</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                loc += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> loc == len(lua_str):</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">"wrong number of bracket"</span>)</span><br><span class="line">        <span class="keyword">return</span> loc</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getLastBrace</span><span class="params">(self, lua_str)</span>:</span></span><br><span class="line">        end = len(lua_str) - <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> end &gt;= <span class="number">0</span> <span class="keyword">and</span> lua_str[end] != <span class="string">'&#125;'</span>:</span><br><span class="line">            end -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> end &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">"wrong number of brace"</span>)</span><br><span class="line">        <span class="keyword">return</span> end</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__readNum</span><span class="params">(self, number_str)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            num = eval(number_str)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> num</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getRealStr</span><span class="params">(self, s)</span>:</span></span><br><span class="line">        result = <span class="string">""</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> i &lt; len(s):</span><br><span class="line">            <span class="keyword">if</span> s[i] == <span class="string">'\\'</span>:</span><br><span class="line">                <span class="keyword">if</span> i + <span class="number">1</span> &lt; len(s) <span class="keyword">and</span> s[i + <span class="number">1</span>] <span class="keyword">in</span> self.__specialChars.keys():</span><br><span class="line">                    result += self.__specialChars[s[i+<span class="number">1</span>]]</span><br><span class="line">                    i += <span class="number">2</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    result += s[i]</span><br><span class="line">                    i += <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result += s[i]</span><br><span class="line">                i += <span class="number">1</span></span><br><span class="line">        <span class="comment"># print s, "&gt;&gt;" , result</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__readValue</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        value = value.strip()</span><br><span class="line">        <span class="keyword">if</span> len(value) &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> value[<span class="number">0</span>] == <span class="string">'"'</span> <span class="keyword">or</span> value[<span class="number">0</span>] == <span class="string">"'"</span>:</span><br><span class="line">                <span class="keyword">return</span> self.__getRealStr(value[<span class="number">1</span>:len(value) - <span class="number">1</span>]), str</span><br><span class="line">            <span class="keyword">elif</span> value == <span class="string">'nil'</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span>, <span class="string">"nil"</span></span><br><span class="line">            <span class="keyword">elif</span> value == <span class="string">'false'</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span>, bool</span><br><span class="line">            <span class="keyword">elif</span> value == <span class="string">'true'</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span>, bool</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                number = self.__readNum(value)</span><br><span class="line">                <span class="keyword">if</span> isinstance(number, int):</span><br><span class="line">                    <span class="keyword">return</span> number, int</span><br><span class="line">                <span class="keyword">elif</span> isinstance(number, float):</span><br><span class="line">                    <span class="keyword">return</span> number, float</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> value, str</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__readStatement</span><span class="params">(self, lua_str, loc)</span>:</span></span><br><span class="line">        loc = self.__jumpSpace(lua_str, loc)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> lua_str[loc] == <span class="string">'&#123;'</span>:</span><br><span class="line">            end = self.__getRightBrace(lua_str, loc)</span><br><span class="line">            stat = self.__parserLuaStr(lua_str[loc: end + <span class="number">1</span>])</span><br><span class="line">            stat_type = type(stat)</span><br><span class="line">            loc = end + <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> lua_str[loc] == <span class="string">'['</span>:</span><br><span class="line">            end = self.__getRightBracket(lua_str, loc)</span><br><span class="line">            stat, stat_type = self.__readValue(lua_str[loc + <span class="number">1</span>: end])</span><br><span class="line">            loc = end + <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> lua_str[loc] == <span class="string">'"'</span> <span class="keyword">or</span> lua_str[loc] == <span class="string">"'"</span>:</span><br><span class="line">            end = self.__getStringEnd(lua_str, loc, lua_str[loc])</span><br><span class="line">            stat = lua_str[loc + <span class="number">1</span>: end]</span><br><span class="line">            stat = self.__getRealStr(stat)</span><br><span class="line">            stat_type = str</span><br><span class="line">            loc = end + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = loc</span><br><span class="line">            <span class="keyword">while</span> end &lt; len(lua_str) <span class="keyword">and</span> lua_str[end] <span class="keyword">not</span> <span class="keyword">in</span> self.__stopChars:</span><br><span class="line">                end += <span class="number">1</span></span><br><span class="line">            stat, stat_type = self.__readValue(lua_str[loc: end])</span><br><span class="line">            loc = end</span><br><span class="line">        <span class="keyword">return</span> stat, stat_type, loc</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__parserLuaStr</span><span class="params">(self, lua_str)</span>:</span></span><br><span class="line">        loc = lua_str.find(<span class="string">'&#123;'</span>) + <span class="number">1</span></span><br><span class="line">        end = self.__getLastBrace(lua_str)</span><br><span class="line">        has_equal = <span class="literal">False</span></span><br><span class="line">        keys = []</span><br><span class="line">        values = []</span><br><span class="line">        <span class="keyword">while</span> <span class="number">0</span> &lt;= loc &lt; end:</span><br><span class="line">            key, key_type, loc = self.__readStatement(lua_str, loc)</span><br><span class="line">            value, value_type = <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">            has_value = <span class="literal">False</span></span><br><span class="line">            loc = self.__jumpSpace(lua_str, loc)</span><br><span class="line">            <span class="keyword">if</span> lua_str[loc] == <span class="string">'='</span>:</span><br><span class="line">                has_value = has_equal = <span class="literal">True</span></span><br><span class="line">                loc += <span class="number">1</span></span><br><span class="line">                value, value_type, loc = self.__readStatement(lua_str, loc)</span><br><span class="line">                loc = self.__jumpSpace(lua_str, loc)</span><br><span class="line"></span><br><span class="line">            loc += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> has_value:</span><br><span class="line">                <span class="keyword">if</span> key <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    keys.append((key, key_type))</span><br><span class="line">                    values.append((value, value_type))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">raise</span> Exception(<span class="string">"the key is nil"</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                keys.append((key, key_type))</span><br><span class="line">                values.append((<span class="literal">None</span>, <span class="literal">None</span>))</span><br><span class="line">        number = <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> has_equal:</span><br><span class="line">            result = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> key_tuple, value_tuple <span class="keyword">in</span> zip(keys, values):</span><br><span class="line">                <span class="keyword">if</span> value_tuple[<span class="number">1</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    result[key_tuple[<span class="number">0</span>]] = value_tuple[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">if</span> key_tuple[<span class="number">1</span>] != <span class="string">'nil'</span> <span class="keyword">and</span> key_tuple[<span class="number">0</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                        result[number] = key_tuple[<span class="number">0</span>]</span><br><span class="line">                    number += <span class="number">1</span></span><br><span class="line">            result = &#123;k: v <span class="keyword">for</span> k, v <span class="keyword">in</span> result.iteritems() <span class="keyword">if</span> v <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>&#125;</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result = []</span><br><span class="line">            <span class="keyword">for</span> key_tuple <span class="keyword">in</span> keys:</span><br><span class="line">                <span class="keyword">if</span> key_tuple[<span class="number">1</span>] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    result.append(key_tuple[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">readStr</span><span class="params">(self, lua_str)</span>:</span></span><br><span class="line">        lua_str = self.__removeComment(lua_str.strip())</span><br><span class="line">        self.__lua_object = self.__parserLuaStr(lua_str)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLuaObject</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__lua_object</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__generateKeyStr</span><span class="params">(self, lua_object)</span>:</span></span><br><span class="line">        result = <span class="string">""</span></span><br><span class="line">        <span class="keyword">if</span> lua_object <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> type(lua_object) <span class="keyword">is</span> str:</span><br><span class="line">                result = <span class="string">'["'</span> + self.__getOriginStr(lua_object) + <span class="string">'"]'</span></span><br><span class="line">            <span class="keyword">elif</span> type(lua_object) <span class="keyword">is</span> int <span class="keyword">or</span> type(lua_object) <span class="keyword">is</span> float:</span><br><span class="line">                result = <span class="string">'['</span> + str(lua_object) + <span class="string">']'</span></span><br><span class="line">            <span class="keyword">elif</span> type(lua_object) <span class="keyword">is</span> bool:</span><br><span class="line">                <span class="keyword">if</span> lua_object:</span><br><span class="line">                    result = <span class="string">'[true]'</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    result = <span class="string">'[false]'</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">"Wrong type of key: "</span> + str(lua_object))</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getOriginStr</span><span class="params">(self, s)</span>:</span></span><br><span class="line">        result = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">in</span> self.__reverseSpecialChars.keys():</span><br><span class="line">                result += self.__reverseSpecialChars[c]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result += c</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__generateValueStr</span><span class="params">(self, lua_object)</span>:</span></span><br><span class="line">        result = <span class="string">""</span></span><br><span class="line">        object_type = type(lua_object)</span><br><span class="line">        <span class="keyword">if</span> lua_object <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            result = <span class="string">'nil'</span></span><br><span class="line">        <span class="keyword">elif</span> object_type <span class="keyword">is</span> list <span class="keyword">or</span> object_type <span class="keyword">is</span> dict:</span><br><span class="line">            result = self.generateLuaStr(lua_object)</span><br><span class="line">        <span class="keyword">elif</span> object_type <span class="keyword">is</span> str:</span><br><span class="line">            result = <span class="string">'"'</span> + self.__getOriginStr(lua_object) + <span class="string">'"'</span></span><br><span class="line">        <span class="keyword">elif</span> object_type <span class="keyword">is</span> int <span class="keyword">or</span> object_type <span class="keyword">is</span> float:</span><br><span class="line">            result = str(lua_object)</span><br><span class="line">        <span class="keyword">elif</span> object_type <span class="keyword">is</span> bool:</span><br><span class="line">            <span class="keyword">if</span> lua_object:</span><br><span class="line">                result = <span class="string">'true'</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result = <span class="string">'false'</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generateLuaStr</span><span class="params">(self, lua_object)</span>:</span></span><br><span class="line">        result = <span class="string">""</span></span><br><span class="line">        <span class="keyword">if</span> lua_object <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            result += <span class="string">'&#123;'</span></span><br><span class="line">            <span class="keyword">if</span> type(lua_object) <span class="keyword">is</span> dict:</span><br><span class="line">                <span class="keyword">for</span> key, value <span class="keyword">in</span> lua_object.iteritems():</span><br><span class="line">                    result += self.__generateKeyStr(key) + <span class="string">' = '</span> + self.__generateValueStr(value) + <span class="string">', '</span></span><br><span class="line">            <span class="keyword">elif</span> type(lua_object) <span class="keyword">is</span> list:</span><br><span class="line">                <span class="keyword">for</span> value <span class="keyword">in</span> lua_object:</span><br><span class="line">                    result += self.__generateValueStr(value) + <span class="string">', '</span></span><br><span class="line">            result += <span class="string">'&#125;'</span></span><br><span class="line">        self.__lua_str = result</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PyLuaTblParser</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.str_praser = LuaStrParser()</span><br><span class="line">        self.lua_table = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load</span><span class="params">(self, s)</span>:</span></span><br><span class="line">        self.str_praser.readStr(s)</span><br><span class="line">        self.lua_table = self.str_praser.getLuaObject()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dump</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.str_praser.generateLuaStr(self.lua_table)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loadLuaTable</span><span class="params">(self, f)</span>:</span></span><br><span class="line">        <span class="keyword">with</span> open(f, <span class="string">'r'</span>) <span class="keyword">as</span> lua_str_file:</span><br><span class="line">            lua_str = lua_str_file.read()</span><br><span class="line">            self.load(lua_str)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dumpLuaTable</span><span class="params">(self, f)</span>:</span></span><br><span class="line">        <span class="keyword">with</span> open(f, <span class="string">'w'</span>) <span class="keyword">as</span> out_file:</span><br><span class="line">            out_file.write(self.str_praser.generateLuaStr(self.lua_table))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">deleteOtherKey</span><span class="params">(self, d)</span>:</span></span><br><span class="line">        result = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> type(d) <span class="keyword">is</span> dict:</span><br><span class="line">            result = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> key, value <span class="keyword">in</span> d.iteritems():</span><br><span class="line">                <span class="keyword">if</span> type(key) <span class="keyword">in</span> LuaStrParser.keyTypes:</span><br><span class="line">                    <span class="keyword">if</span> type(value) <span class="keyword">is</span> list <span class="keyword">or</span> type(value) <span class="keyword">is</span> dict:</span><br><span class="line">                        result[key] = self.deleteOtherKey(value)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        result[key] = value</span><br><span class="line">        <span class="keyword">elif</span> type(d) <span class="keyword">is</span> list:</span><br><span class="line">            result = []</span><br><span class="line">            <span class="keyword">for</span> value <span class="keyword">in</span> d:</span><br><span class="line">                <span class="keyword">if</span> type(value) <span class="keyword">is</span> list <span class="keyword">or</span> type(value) <span class="keyword">is</span> dict:</span><br><span class="line">                    result.append(self.deleteOtherKey(value))</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    result.append(value)</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">loadDict</span><span class="params">(self, d)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> type(d) <span class="keyword">is</span> dict:</span><br><span class="line">            self.lua_table = self.deleteOtherKey(d)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dumpDict</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> type(self.lua_table) <span class="keyword">is</span> dict:</span><br><span class="line">            <span class="keyword">return</span> self.lua_table.copy()</span><br><span class="line">        <span class="keyword">elif</span> type(self.lua_table) <span class="keyword">is</span> list:</span><br><span class="line">            <span class="keyword">return</span> [v <span class="keyword">for</span> v <span class="keyword">in</span> self.lua_table]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self, d)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.lua_table <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.lua_table = d</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> type(self.lua_table) <span class="keyword">is</span> list:</span><br><span class="line">                new_table = &#123;&#125;</span><br><span class="line">                <span class="keyword">for</span> k, v <span class="keyword">in</span> zip(range(<span class="number">1</span>, len(self.lua_table) + <span class="number">1</span>), self.lua_table):</span><br><span class="line">                    <span class="keyword">if</span> v <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                        new_table[k] = v</span><br><span class="line">                self.lua_table = new_table</span><br><span class="line">            new_table = self.deleteOtherKey(d)</span><br><span class="line">            <span class="keyword">for</span> k, v <span class="keyword">in</span> new_table.iteritems():</span><br><span class="line">                self.lua_table[k] = v</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self.lua_table[item]</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.lua_table <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.lua_table = &#123;&#125;</span><br><span class="line">            self.lua_table[key] = value</span><br><span class="line">        <span class="keyword">elif</span> type(self.lua_table) <span class="keyword">is</span> dict:</span><br><span class="line">            self.lua_table[key] = value</span><br><span class="line">        <span class="keyword">elif</span> type(self.lua_table) <span class="keyword">is</span> list:</span><br><span class="line">            new_table = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> k, v <span class="keyword">in</span> zip(range(<span class="number">1</span>,len(self.lua_table) + <span class="number">1</span>), self.lua_table):</span><br><span class="line">                <span class="keyword">if</span> v <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    new_table[k] = v</span><br><span class="line">            new_table[key] = value</span><br><span class="line">            self.lua_table = new_table</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    pyluatblparser = PyLuaTblParser()</span><br><span class="line"></span><br><span class="line">    pyluatblparser.load(<span class="string">'&#123;&#123;&#125;,nil,nil,2,3&#125;'</span>)</span><br><span class="line">    pyluatblparser[<span class="number">1</span>] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">print</span> pyluatblparser[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">print</span> pyluatblparser.dump()</span><br><span class="line">    pyluatblparser[<span class="number">1</span>] = &#123;&#125;</span><br><span class="line">    <span class="keyword">print</span> pyluatblparser.dump()</span><br><span class="line">    <span class="comment"># print repr(lua_str)</span></span><br><span class="line">    <span class="comment"># print str_parser.__removeComment(lua_str)</span></span><br><span class="line">    <span class="comment"># with open('sysinput2', 'r') as f:</span></span><br><span class="line">    <span class="comment">#     lua_str = f.read()</span></span><br><span class="line">    <span class="comment">#     pyluatblparser.load(lua_str)</span></span><br><span class="line">    <span class="comment">#     outDict = pyluatblparser.dumpDict()</span></span><br><span class="line">    <span class="comment">#     print outDict</span></span><br><span class="line">    <span class="comment">#     result = outDict['root'][7]</span></span><br><span class="line">    <span class="comment">#     print result["\\\"\b\f\n\r\t`1~!@#$%^&amp;*()_+-=[]&#123;&#125;|;:',./&lt;&gt;?"]</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#     print '\n'</span></span><br><span class="line">    <span class="comment">#     print pyluatblparser.dump()</span></span><br><span class="line">    <span class="comment">#     # print result</span></span><br><span class="line">    <span class="comment">#     # next = None</span></span><br><span class="line">    <span class="comment">#     # for key,value in result.iteritems():</span></span><br><span class="line">    <span class="comment">#     #     for k, v in value.iteritems():</span></span><br><span class="line">    <span class="comment">#     #         if k == 7:</span></span><br><span class="line">    <span class="comment">#     #             next = v</span></span><br><span class="line">    <span class="comment">#     #</span></span><br><span class="line">    <span class="comment">#     # for k,v in next.iteritems():</span></span><br><span class="line">    <span class="comment">#     #     print k ,'=', v</span></span><br><span class="line">    <span class="comment">#     # print '\n'</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#     pyluatblparser.dumpLuaTable('output')</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment">#     # with open('output', 'w') as out:</span></span><br><span class="line">    <span class="comment">#     #     new_str = pyluatblparser.dump()</span></span><br><span class="line">    <span class="comment">#     #     print new_str</span></span><br><span class="line">    <span class="comment">#     #     out.write(new_str)</span></span><br><span class="line">    <span class="comment">#     # with open('output.lua', 'w') as out:</span></span><br><span class="line">    <span class="comment">#     #     out.write(result)</span></span><br></pre></td></tr></table></figure>
<h1 id="测试代码"><a href="#测试代码" class="headerlink" title="测试代码"></a>测试代码</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># test multi table levels</span></span><br><span class="line">    a1 = PyLuaTblParser()</span><br><span class="line">    test_str = <span class="string">'&#123;array = &#123;65,23,5,&#125;,dict = &#123;mixed = &#123;43,54.33,false,9,string = "value",&#125;,array = &#123;3,6,4,&#125;,string = "value",&#125;,&#125;'</span></span><br><span class="line">    a1.load(test_str)</span><br><span class="line">    d1 = a1.dumpDict()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'&gt;&gt;&gt;&gt;&gt;'</span>, d1</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'==========================================================='</span></span><br><span class="line">    <span class="comment"># test file load</span></span><br><span class="line">    a2 = PyLuaTblParser()</span><br><span class="line">    a2.loadDict(d1)</span><br><span class="line">    a2.dumpLuaTable(<span class="string">'test_output'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># test file dump</span></span><br><span class="line">    a3 = PyLuaTblParser()</span><br><span class="line">    a3.loadLuaTable(<span class="string">'test_input'</span>)</span><br><span class="line"></span><br><span class="line">    d3 = a3.dumpDict()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'&gt;&gt;&gt;&gt;&gt;'</span>, d3</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'==========================================================='</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># test complex string</span></span><br><span class="line">    test_str = <span class="string">'&#123; strs = "\\"\'\\" \\t\\b\\f\\n", ["\\"\'\\" \\t\\b\\f\\n"] = "complex string is key"&#125;'</span></span><br><span class="line">    <span class="keyword">print</span> test_str</span><br><span class="line">    a4 = PyLuaTblParser()</span><br><span class="line">    a4.load(test_str)</span><br><span class="line">    d4 = a4.dumpDict()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'&gt;&gt;&gt;&gt;&gt;'</span>, d4</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'==========================================================='</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># test comment</span></span><br><span class="line">    test_str = <span class="string">'&#123;\t\n-- "comment str",\t\n["hello world"] = 1,\t\n--[[\t\n"should be comment",\t\n2 = 1\t\n ]]\t\n[3] = 2\n&#125;'</span></span><br><span class="line">    <span class="keyword">print</span> test_str</span><br><span class="line">    a5 = PyLuaTblParser()</span><br><span class="line">    a5.load(test_str)</span><br><span class="line">    d5 = a5.dumpDict()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'&gt;&gt;&gt;&gt;&gt;'</span>, d5</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'==========================================================='</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># test []</span></span><br><span class="line">    test_str = <span class="string">'&#123;[1] = "1", a = "a"&#125;'</span></span><br><span class="line">    <span class="keyword">print</span> test_str</span><br><span class="line">    a6 = PyLuaTblParser()</span><br><span class="line">    a6.load(test_str)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'&gt;&gt;&gt;&gt;&gt;'</span>, a6.dump()</span><br><span class="line">    a6[<span class="number">1</span>] = <span class="string">"changed"</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'&gt;&gt;&gt;&gt;&gt;'</span>, a6[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'&gt;&gt;&gt;&gt;&gt;&gt;'</span>, a6.dump()</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'==========================================================='</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># test update</span></span><br><span class="line">    test_str = <span class="string">'&#123;[1] = "1", a = "a"&#125;'</span></span><br><span class="line">    <span class="keyword">print</span> test_str</span><br><span class="line">    a7 = PyLuaTblParser()</span><br><span class="line">    a7.load(test_str)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'&gt;&gt;&gt;&gt;&gt;'</span>, a7.dump()</span><br><span class="line">    update_table = &#123;<span class="number">1</span>: [&#123;&#125;], <span class="string">"b"</span>: <span class="string">"b"</span>&#125;</span><br><span class="line">    a7.update(update_table)</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'&gt;&gt;&gt;&gt;&gt;'</span>, a7.dump()</span><br></pre></td></tr></table></figure>
<h1 id="测试样例"><a href="#测试样例" class="headerlink" title="测试样例"></a>测试样例</h1><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    root = &#123;</span><br><span class="line">        <span class="string">"Test Pattern String"</span>,</span><br><span class="line">        <span class="comment">-- &#123;"object with 1 member" = &#123;"array with 1 element",&#125;,&#125;,</span></span><br><span class="line">        &#123;[<span class="string">"object with 1 member"</span>] = &#123;<span class="string">"array with 1 element"</span>,&#125;,&#125;,</span><br><span class="line"></span><br><span class="line">        &#123;&#125;,</span><br><span class="line"></span><br><span class="line">        [<span class="number">99</span>] = <span class="number">-42</span>,</span><br><span class="line"></span><br><span class="line">        [<span class="number">98</span>] = &#123;&#123;&#125;&#125;,</span><br><span class="line"></span><br><span class="line">        [<span class="number">97</span>] = &#123;&#123;&#125;,&#123;&#125;&#125;,</span><br><span class="line"></span><br><span class="line">        [<span class="number">96</span>] = &#123;&#123;&#125;, <span class="number">1</span>, <span class="number">2</span>, <span class="literal">nil</span>&#125;,</span><br><span class="line"></span><br><span class="line">        [<span class="number">95</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, &#123;[<span class="string">"1"</span>] = <span class="number">1</span>&#125;&#125;,</span><br><span class="line"></span><br><span class="line">        [<span class="number">94</span>] = &#123; &#123;[<span class="string">"1"</span>]=<span class="number">1</span>, [<span class="string">"2"</span>]=<span class="number">2</span>&#125;, &#123;<span class="number">1</span>, [<span class="string">"2"</span>]=<span class="number">2</span>&#125;, [<span class="string">"3"</span>] = <span class="number">3</span> &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">        <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">        <span class="literal">nil</span>,</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            [<span class="string">"integer"</span>]= <span class="number">1234567890</span>,</span><br><span class="line"></span><br><span class="line">            real=<span class="number">-9876.543210</span>,</span><br><span class="line"></span><br><span class="line">            e= <span class="number">0.123456789e-12</span>,</span><br><span class="line"></span><br><span class="line">            E= <span class="number">1.234567890E+34</span>,</span><br><span class="line"></span><br><span class="line">            zero = <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">            one = <span class="number">1</span>,</span><br><span class="line"></span><br><span class="line">            space = <span class="string">" "</span>,</span><br><span class="line"></span><br><span class="line">            quote = <span class="string">"\""</span>,</span><br><span class="line"></span><br><span class="line">            backslash = <span class="string">"\\"</span>,</span><br><span class="line"></span><br><span class="line">            controls = <span class="string">"\b\f\n\r\t"</span>,</span><br><span class="line"></span><br><span class="line">            slash = <span class="string">"/ &amp; \\"</span>,</span><br><span class="line"></span><br><span class="line">            alpha= <span class="string">"abcdefghijklmnopqrstuvwyz"</span>,</span><br><span class="line"></span><br><span class="line">            ALPHA = <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWYZ"</span>,</span><br><span class="line"></span><br><span class="line">            digit = <span class="string">"0123456789"</span>,</span><br><span class="line"></span><br><span class="line">            special = <span class="string">"`1~!@#$%^&amp;*()_+-=&#123;':[,]&#125;|;.&lt;/&gt;?"</span>,</span><br><span class="line"></span><br><span class="line">            hex = <span class="string">"0x01230x45670x89AB0xCDEF0xabcd0xef4A"</span>,</span><br><span class="line"></span><br><span class="line">            [<span class="string">"true"</span>] = <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">            [<span class="string">"false"</span>] = <span class="literal">false</span>,</span><br><span class="line"></span><br><span class="line">            [<span class="string">"nil"</span>] = <span class="literal">nil</span>,</span><br><span class="line"></span><br><span class="line">            array = &#123;<span class="literal">nil</span>, <span class="literal">nil</span>,&#125;,</span><br><span class="line"></span><br><span class="line">            object = &#123;  &#125;,</span><br><span class="line"></span><br><span class="line">            address = <span class="string">"50 St. James Street"</span>,</span><br><span class="line"></span><br><span class="line">            url = <span class="string">"http://www.JSON.org/"</span>,</span><br><span class="line"></span><br><span class="line">            comment = <span class="string">"// /* &lt;!-- --"</span>,</span><br><span class="line"></span><br><span class="line">            [<span class="string">"# -- --&gt; */"</span>] = <span class="string">" "</span>,</span><br><span class="line"></span><br><span class="line">            [<span class="string">" s p a c e d "</span> ] = &#123;<span class="number">1</span>,<span class="number">2</span> , <span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                ,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="number">4</span> , <span class="number">5</span>        ,          <span class="number">6</span>           ,<span class="number">7</span>        &#125;,</span><br><span class="line"></span><br><span class="line">            <span class="comment">--[[[][][]  Test multi-line comments</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                compact = &#123;1,2,3,4,5,6,7&#125;,</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        - -[luatext = "&#123;\"object with 1 member\" = &#123;\"array with 1 element\"&#125;&#125;",</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            quotes = "&amp;#34; (0x0022) %22 0x22 034 &amp;#x22;",</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            ["\\\"\b\f\n\r\t`1~!@#$%^&amp;*()_+-=[]&#123;&#125;|;:',./&lt;&gt;?"]</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            = "A key can be any string"]]</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">--         ]]</span></span><br><span class="line"></span><br><span class="line">            compact = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>&#125;,</span><br><span class="line"></span><br><span class="line">            luatext = <span class="string">"&#123;\"object with 1 member\" = &#123;\"array with 1 element\"&#125;&#125;"</span>,</span><br><span class="line"></span><br><span class="line">            quotes = <span class="string">"&amp;#34; (0x0022) %22 0x22 034 &amp;#x22;"</span>,</span><br><span class="line"></span><br><span class="line">            [<span class="string">"\\\"\b\f\n\r\t`1~!@#$%^&amp;*()_+-=[]&#123;&#125;|;:',./&lt;&gt;?"</span>]</span><br><span class="line"></span><br><span class="line">            = <span class="string">"A key can be any string"</span></span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line"></span><br><span class="line">        <span class="number">0.5</span> ,<span class="number">31415926535897932384626433832795028841971693993751058209749445923.</span></span><br><span class="line"></span><br><span class="line">        ,</span><br><span class="line"></span><br><span class="line">        <span class="number">3.1415926535897932384626433832795028841971693993751058209749445923</span></span><br><span class="line"></span><br><span class="line">        ,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="number">1066</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        ,<span class="string">"rosebud"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://uyouii.github.io/2017/12/21/合金装备V-幻痛-游戏测评/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Uyouii">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Uyouii's Blogs">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/12/21/合金装备V-幻痛-游戏测评/" class="post-title-link" itemprop="url">合金装备V 幻痛 游戏评测</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-12-21 23:35:35" itemprop="dateCreated datePublished" datetime="2017-12-21T23:35:35+08:00">2017-12-21</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-02 11:28:18" itemprop="dateModified" datetime="2019-08-02T11:28:18+08:00">2019-08-02</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/game/" itemprop="url" rel="index"><span itemprop="name">game</span></a></span>

                
                
              
            </span>
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <p><img src="/images/MGS 1.jpg" alt></p>
<h2 id="游戏概述"><a href="#游戏概述" class="headerlink" title="游戏概述"></a>游戏概述</h2><p><strong>《合金装备V 幻痛》</strong>(Metal Gear Solid V: The Phantom Pain, 台译作“潜龙谍影V 幻痛”) 是一款由小岛制作（KONAMI旗下的王牌游戏研发工作室）开发的隐蔽类开放世界动作冒险游戏。它由小岛制作研发的游戏引擎“狐引擎”（FOX Engine）制作，在2015年9月1日发行于Microsoft Windows、PlayStation 3、PlayStation 4、Xbox 360和Xbox One平台。</p>
<p>游戏起初被分别公布为2个不同的项目，一个是在合金装备25周年纪念会上公布，名为《合金装备 原爆点》（Metal Gear Solid : Ground Zeroes），另一个则是由Moby Dick Studio开发的《幻痛》（Phantom Pain）。至2013年3月游戏网页正式上线，游戏名称才确定为《合金装备V 幻痛》。2013年11月11日，科乐美宣布《合金装备V 原爆点》独立于2014年春季发行。2014年德国Gamescom展，小岛秀夫宣布《幻痛》将借由Steam登上电脑平台。</p>
<h2 id="游戏背景"><a href="#游戏背景" class="headerlink" title="游戏背景"></a>游戏背景</h2><p>游戏设定在一个架空的冷战世界中，除了对峙的美国和苏联外，世界的格局还被一种名为“合金装备”的武器影响着。游戏的时间设定在《合金装备V 原爆点》九年之后，即1984年，此时游戏中和现实一样也在进行着阿富汗战争。尽管游戏大体和现实相同，但是玩家可以发现游戏内的武器和科技要远远比现实中的冷战时期先进，军事技术诸如外骨骼、双足机甲、光学隐形、全息影像都被各国谍报机关所使用着。其他科学技术诸如纳米技术、克隆、人工智能也进入了实用化的阶段。</p>
<p>主角Big Boss建立的佣兵组织“无界之师”在《合金装备V 原爆点》的结尾被摧毁，主角也陷入了长达9年的昏迷。醒来后世界也发生了翻天覆地的变化。《合金装备V 幻痛》讲述的是主角在苏醒后重新建立佣兵组织“Diamond Dogs”，并在“Snake”的代号下，在阿富汗和安哥拉-扎伊尔边境进行冒险，以向九年前摧毁自己亲手建立的无国界军队MSF的神秘人物”Skull Face”复仇。</p>
<h2 id="配置要求"><a href="#配置要求" class="headerlink" title="配置要求"></a>配置要求</h2><table>
<thead>
<tr>
<th style="text-align:center">项目</th>
<th style="text-align:center">最低配置</th>
<th style="text-align:center">推荐配置</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">系统</td>
<td style="text-align:center">Windows 7</td>
<td style="text-align:center">Windows 7</td>
</tr>
<tr>
<td style="text-align:center">处理器</td>
<td style="text-align:center">i5-4460</td>
<td style="text-align:center">i7-4790</td>
</tr>
<tr>
<td style="text-align:center">内存</td>
<td style="text-align:center">4GB RAM</td>
<td style="text-align:center">8GB RAM</td>
</tr>
<tr>
<td style="text-align:center">显卡</td>
<td style="text-align:center">GeForce GTX 650或更好</td>
<td style="text-align:center">GeForce GTX 760或更好</td>
</tr>
<tr>
<td style="text-align:center">硬盘</td>
<td style="text-align:center">28GB空闲空间</td>
<td style="text-align:center">28GB空闲空间</td>
</tr>
</tbody>
</table>
<blockquote>
<p>资料来源：游民星空</p>
</blockquote>
<h2 id="游戏评测"><a href="#游戏评测" class="headerlink" title="游戏评测"></a>游戏评测</h2><h3 id="1-游戏场景-9-0"><a href="#1-游戏场景-9-0" class="headerlink" title="1. 游戏场景 9.0"></a>1. 游戏场景 9.0</h3><p>合金装备V是开放世界类的潜入冒险游戏。游戏中总共有两个比较大的开放式的地图，分别在中东地区的阿富汗和非洲地区，游戏的情节和任务也都在这两个地图中展开。</p>
<p><img src="/images/MGS 2.png" alt="游戏场景1"></p>
<p>可以说合金装备5幻痛的游戏画面是日式游戏中少见的优质画面，几乎所有玩家在进入游戏之后都会在几分钟内被游戏所折服，可以说是真正的划时代之作。在画面的重大突破很大程度上得益于FOX引擎。2008年Kojima开发FOX引擎绝对是个目光长远之举，人们当时还没有意识到游戏画面可以进化到今天这个地步，但当时的“FOX引擎”团队致力于打造世界上最好的游戏引擎，也就是这个好高骛远的目标如今终于为日式游戏正名。</p>
<p>游戏中的场景可谓多种多样，甚至不做任务在游戏中闲逛也是一种乐趣。幻痛对游戏环境场景做了生动的还原。在游戏中你会发现各种植物和动物，有时还会遇到瀑布、峡谷、沼泽等等。游戏中会标出有用的药草和资源等等，收集药草可以用来制作药品和装备，甚至可以在基地出售换取游戏中的金币，进而开发装备。</p>
<p>游戏中的动物可以被主角用麻醉枪麻醉后送往基地（传送或虫洞技术）。游戏中有一个动物保护组织承诺主角收集动物后可以给予主角相应的声望和金币。甚至有个支线任务要求主角前往指定区域抓捕棕熊。</p>
<p>游戏中同样添加了气候和自然时间的设定。笔者总共体验过晴天、阴天、雨天和沙尘暴这几种气候。对于潜入型的游戏来说，这个设定更增添了游戏的趣味性。白天和黑夜会影响NPC的巡逻线路和视野，雨天可以很好的掩盖主角的脚步声，沙尘暴更是无压力潜入（偶尔会撞在敌人脸上…）。</p>
<p><img src="/images/MGS 3.jpg" alt="游戏场景2"></p>
<p>地图上会散布着很多岗哨和敌人的大型据点，兵力和设备也会有所不同。随着游戏的推进，驻守的兵力也会不断增多，而且会根据玩家的入侵习惯不断调整，这是游戏一个特别新颖的地方。比如玩家入侵时喜欢爆头，则NPC会装配头盔、玩家喜欢在夜晚时入侵，敌人则会装备夜视仪等。敌人也会因为玩家的方式来采取不同的措施，他们会组队调查可以的地方对玩家进行包围，必要的时候会采用重武器对玩家进行压制（不止一次被榴弹炮和武装直升机干掉= =）。</p>
<p>幻痛的游戏环境是对现实的高度还原，人物的视觉和感官也做的十分逼真，使人们在玩游戏是的代入感十分强烈。唯一不足是游戏中的时间流逝设定比现实中快了不少，往往潜入敌方基地后还没完成任务天就亮了。俘虏敌人的回答和选项方面的设定也比较单一，希望增强游戏中NPC的多样性，更能增添游戏的趣味性。</p>
<h3 id="2-游戏玩法-9-5"><a href="#2-游戏玩法-9-5" class="headerlink" title="2. 游戏玩法 9.5"></a>2. 游戏玩法 9.5</h3><p>开放世界对于潜入游戏的核心玩法的改变可以说是革命性的，可以说完成游戏的方式完全取决于玩家自身，这款游戏基本没有固定的模式。潜入只是暗示玩家游戏的风格，但玩家完全可以按照自己的路线来完成。当然游戏推荐潜入的玩法确实具有挑战性，也更加考验玩家的耐心。</p>
<p>潜入时玩家可以选择晚上或者暴雨天气，之前先用望远镜标记好敌人的位置，为潜入工作打下基础。枪械方面也可以选择带消音管或者麻醉枪。因为这个游戏中玩家有一个自己的基地，俘虏敌人并传送回基地可以加强基地的建设工作，促进武器的研发和资源的收集。具有特殊技能的NPC也会带来意想不到的好处。例如当你回收一名具有翻译技能的人员后你就能够听懂敌人交流的语言了。</p>
<p>在不惊动其他敌人的情况下俘虏敌人也可以获得一些关键性的情报，例如指挥所的位置，蓝图的地点，钻石的地点，具有特殊技能的人员（专家）是哪些等。在进行主线任务时，通过审问敌人可以得到完成主线任务的线索。这些设定都增加了游戏的趣味性和挑战性。</p>
<p><img src="/images/MGS 4.jpg" alt="游戏场景3"></p>
<p>当然对于没有耐心的玩家这些都是虚的，正面刚才是王道呀。背着火箭炮，空投坦克，穿着重型装甲就可以攻占下来一个基地了，任务什么的在进去探索就行了。这样魂斗罗式的玩法也别有一番趣味。</p>
<p>游戏中NPC使用的任何车辆和武器玩家都可以使用，包括榴弹炮，火箭发射车等，不过在坦克中如果被敌人集火攻击的话也很容易被干掉。</p>
<h3 id="3-游戏装备和资源-9-0"><a href="#3-游戏装备和资源-9-0" class="headerlink" title="3. 游戏装备和资源 9.0"></a>3. 游戏装备和资源 9.0</h3><p>第三人称射击类的游戏怎么会少了武器枪械。合金装备V 中的枪械种类可以说是花样繁多，不管是现实中存在的或者是改版的都有在游戏中体现出来。</p>
<p>武器的研发是在玩家的基地中实现的。玩家通过不断升级研发平台可以不断解锁新的武器装备。研发平台的升级需要人员扩中和基地基础设施研发来完成，部分武器还需要武器蓝图和专业人员存在才可以解锁。</p>
<p><img src="/images/MGS 5.png" alt="游戏场景4"></p>
<p>武器的研发是按照树状图的方式进行的，即一类武器只有将其之前的武器解锁后，才可以继续研发更加先进的武器。</p>
<p>玩家在游戏中可以选择各种不同的枪械，不同的武器也拥有不同的功能。玩家在进行任务时，不仅可以呼叫直升机空投武器资源，还可以空投之前回收的武器车辆等，例如双足机器人和坦克。</p>
<p>玩家在执行任务时回收的资源很多会运回基地用于基地基础设施的开发和武器的研究。</p>
<p><img src="/images/MGS 6.png" alt="游戏场景5"></p>
<p>玩家可以随时回到基地，有时会触发一些剧情。在基地中有些地方会出现一些试炼任务，完成后会给玩家提供大量的游戏金币。在基地中闲逛的时候偶尔会发现一些钻石碎片，同样可以兑换大量的GMP（游戏金币）。小岛的幽默依然不减，基地中偶尔也会出现一些日式风格的海报，收集后同样可以兑换一下GMP。</p>
<p>在基地的建设中，人员素质占了很大一部分比重。基地人员的能力与基地的研发等级相挂钩。主角的声望越高，越容易招募到高素质的成员。同时玩家在执行任务时对高素质人员的回收也很重要。这同时也暗示了玩家幻痛不仅仅是一个枪战游戏，更重要的是策略和思维。</p>
<p><img src="/images/MGS 7.jpg" alt="游戏场景6"></p>
<p>游戏中黑科技依然不少，寄生虫，人体改造，基因技术，机械手臂，双足机器等。一些超自然的设定和剧情也为游戏增添的不少魔幻主义色彩，很多时候玩家在进行游戏的时候都会有一种惊心动魄的感觉，有些NPC是真的太恐怖了！</p>
<h3 id="4-游戏剧情-9-9"><a href="#4-游戏剧情-9-9" class="headerlink" title="4 游戏剧情 9.9"></a>4 游戏剧情 9.9</h3><p>合金装备V 幻痛剧情只是整个合金装备游戏系列的一个中间阶段，它讲述的是Snake在基地被摧毁，经历了长达9年的昏迷之后，在山猫和米勒的帮助下，投身于阿富汗战场，并重新建立佣兵组织钻石狗的故事。这些剧情和往届合金装备游戏的剧情都属于同一种风格，但是不同的是，幻痛中竟然出现了女主！这个设定真的是让不少玩家去趋之若鹜呀，真的是一直在刷妹子的好感度。什么主线剧情的先不管了，最终主角是把大反派“Skull Face”消灭了，我们还是围绕静静来介绍。</p>
<p>女主的名字叫做“Quiet”，顾名思义，意思是女主从来都不说话，至于原因我们会在后面揭晓。</p>
<p><img src="/images/MGS 8.jpg" alt="游戏场景6"></p>
<p>玩家在进行到第11次主线任务时，会触发一次隐藏剧情，在阿富汗某地区会遇到一名强大的女狙击手。不仅身法快捷，而且还会隐身伪装的能力，狙击能力也特别强。这时候玩家就要想办法战胜这位女狙击手。当任务完成后，基地一个NPC会要求玩家杀掉Quiet，认为他是“Skull Face”的人，而另一个NPC则认为可以俘虏Quiet到基地来观察一段时间。这时候玩家就可以选择是否要杀掉Quiet。我觉得正常的玩家肯定会把Quiet带回基地啊！这么漂亮的女主。</p>
<p><img src="/images/MGS 9.png" alt="游戏场景6"></p>
<p>游戏的第一个任务是要让昏迷了9年的主角逃出医院。当主角还在医院中的时候，“Skull Face”曾派遣了一位女特工来刺杀主角，结果被主角和一位NPC联手烧伤后不知所踪。细心的玩家会发现者刺杀主角的女特工和静静其实是同一个，由此可以推断Quiet是来复仇的。</p>
<p>当Quiet来到基地以后，基地的NPC发现他们根本控制不住Quiet（根本打不过），Quiet也从不说话，但是只听主角一个人的指挥，Quiet就只能暂时被关押起来。后来一次机缘巧合基地的NPC同意主角带上Quiet一起执行任务。这时玩家会发现Quiet来了以后，执行任务的速度简直事半功倍呀，有时Quiet自己就可以团灭一个敌方基地。</p>
<p>后来主角建立的基地会面临一种灾难，就是不断有成员得一种怪病死去，原因要主角自己调查。在见到密语者（NPC）之后得知这场疾病是由于声带寄生虫引起的。声带寄生虫是指一种寄生到人的声带，根据人的语言种类来进行繁殖的一种寄生虫。只会感染说某种特定语言的群体并繁殖，感染到基本无药可救，而且传染性极强。声带寄生虫是“Skull Face”从密语者哪里获得后拿来进行人体改造实验。静静的特殊能力、以及“Skull Face”身边的一些NPC都是寄生虫改造的产物，因此具有了异于常人的能力。</p>
<p><img src="/images/MGS 10.png" alt="游戏场景6"></p>
<p>Quiet和主角的关系也在一次次的任务中不断升温，Quiet和boss这雨中嬉戏的这个画面相信让很多玩家难以忘怀，本以为主角和Quiet最后能走在一次，可是忘了编剧喜欢悲剧的这个事实（寄过刀片了有没有）。</p>
<p>游戏的第30个主线任务完成后，也就是主角终于将最终Boss“Skull Face”杀掉后，会说明一个关键信息。“Skull Face”共制造了三支英语种的寄生虫，可是现在只剩下两支……相信细心的读者已经明白了剩下的一支到哪里去了，但是笔者没想到结果会来的这么突然。</p>
<p>在任务推进到一定程度，会出现隐藏的45号主线任务。任务会提示静静突然消失了，然后主角得知静静被苏联人抓走了，笔者当时第一反应当然是干翻他们找到静静啊！说实话这个关卡挺难的。</p>
<p>关卡任务是玩家要和静静一起摧毁掉苏联军队的一个坦克部队。当玩家摧毁所有地图上的敌军后，会进入下一段剧情。主角以为所有坦克都被摧毁，但一辆没有完全摧毁的坦克已经悄悄瞄准了主角。静静因为不能说话，一把抢过主角的火箭炮摧毁了坦克，但是也被炮弹击中，陷入昏迷，也就在这时，敌军的增援部队赶到，主角要带着静静从这个绝望之地逃出。</p>
<p><img src="/images/MGS 11.png" alt="游戏场景6"></p>
<p>主角和静静躲在了一处岩石后，敌人的搜查部队就在眼前，由于沙尘暴的原因主角和静静躲过了一劫，但主角却因此被眼镜蛇咬伤，而后同样陷入昏迷（眼镜蛇是神经性毒素，可以致命）。主角后来在半睡半醒中听到救援直升机赶到，但因为沙尘暴找不到正确的方位。当救援直升机得不到应答，正要返回的时候，静静说出了英语。相信大家都猜到了，静静是英语语种的寄生虫携带者，所以她从不说话。之前“Skull Face”派遣她来就是为了感染主角，但是她没有这样做。在最后时刻她为了救主角却牺牲了自己。静静在直升机到来后，看了主角最后一眼，然后离开。</p>
<p><img src="/images/MGS 12.png" alt="游戏场景6"></p>
<p>主角得到救援后发现静静不在，但跟着脚印在一处山顶上发现了静静留下的一个录音磁带。里面说：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">I did not choose to be Quiet.</span><br><span class="line">I wanted to express my feelings to you.</span><br><span class="line">If only we shared a common tongue.</span><br><span class="line">Vengeance was what drove me to them...</span><br><span class="line">The only language left to me, revenge.</span><br><span class="line">But the words we shared...</span><br><span class="line">No, that was no language at all.</span><br><span class="line">That&apos;s why I...</span><br><span class="line">I chose the language of gratitude instead, and go back to silence.</span><br><span class="line">I am Quiet...</span><br><span class="line">I am... The absence of words...</span><br></pre></td></tr></table></figure></p>
<p><img src="/images/MGS 13.png" alt="游戏场景6"></p>
<p>从此静静便淡出了玩家的视野，但是回到基地后会发现静静已经列入了基地的死亡名单，直升机上静静的相片也不见了，再也不会有静静的身影了……</p>
<p>当笔者玩到这里的时候真的是非常的虐心，但是毕竟程序员们的智慧是无限的，虽然网友通过替换文件的方法可以重新找回静静，但是再也没有和静静有关的任务了。</p>
<p>游戏剧情的设计让玩家们如此着迷，甚至主线任务通关后仍然想要找回女主的身影，更让无数玩家尝试各种方法寻回静静，真心满分。</p>
<p>在静静淡出后，游戏的最终关卡也出现了。玩家们发现这个最终关卡和第一关基本一样，但是却揭示了和第一关完全不同的结局。原来玩家操控的主角一直都不是真正的Big Boss，而是Big Boss的一个替身，这个秘密只有将主角救出的山猫一个人知道。真正的Big Boss已经去了其他地方开辟新的基地。游戏开始会让玩家自定义自己的外貌属性，但是在第一关却没有体现出来，直到现在自定义的外貌的选项才出现。原来这个游戏本身就是一场幻痛……</p>
<p>笔者个人觉得，游戏的画面感和操作倒是其次，游戏的剧情才是游戏真正的灵魂。一个没有剧情的游戏很容易让人感到无聊，但是游戏的剧情却可以让人回味无穷。</p>
<h3 id="5-游戏音效-9-0"><a href="#5-游戏音效-9-0" class="headerlink" title="5. 游戏音效 9.0"></a>5. 游戏音效 9.0</h3><p>游戏的音效方面的效果也是很棒的，游戏中的所有的音效都是立体音，玩家在游戏中的时候，无论是风声，鸟叫声或者是流水的声音都非常的真实，仿佛真的置身于野外一样。在执行任务的时候，敌人的交谈声和脚步声也是非常重要的信息。</p>
<p>游戏中也穿插了大量的70、80年代的大量的经典的歌曲。在执行任务的过程中，玩家可以在敌人的据点或者基地中可以发现一些录音机，从而获得一些磁带，来解锁一些游戏中的经典的歌曲。</p>
<p>这些歌曲玩家可以在任务栏的磁带中收听。在基地中的女主的房间中，玩家可以听到收集来的磁带中的歌曲。女主的房间中有彩蛋的哦。在女主的房间中偶尔可以看到女主在洗澡哦！</p>
<p><img src="/images/MGS 14.png" alt="游戏场景6"></p>
<h3 id="6-综合评价-9-5"><a href="#6-综合评价-9-5" class="headerlink" title="6. 综合评价 9.5"></a>6. 综合评价 9.5</h3><p>很多人对《合金装备V 幻痛》的评价颇高，在笔者看来，有两个主要的原因：</p>
<ol>
<li>游戏具有超高的自由度。玩家不会再被任务限制在一个狭小的空间内，相反是在两个巨大的沙盒式的世界中。</li>
<li>游戏有着行云流水般的剧情体验，而不是生硬的强迫性的过场。</li>
</ol>
<p>这两个体验往往不会兼得，重视了一项，就会影响另一项。《合金装备V 幻痛》做到了二者的水乳交融，可以说是行业的顶尖的神作。</p>
<p>游戏具有意义的复杂性、灵活的潜入选择、海量的道具和能力也带给了玩家更加丰富的游戏体验，不可不玩的游戏之一。</p>
<h2 id="媒体评价"><a href="#媒体评价" class="headerlink" title="媒体评价"></a>媒体评价</h2><h3 id="IGN-——-10-10"><a href="#IGN-——-10-10" class="headerlink" title="IGN —— 10/10"></a>IGN —— 10/10</h3><blockquote>
<p>“《合金装备5：幻痛》是一款拥有奇迹般的游戏玩法、需要玩家动用自己的创造力和智力的游戏——没有多少游戏可以做成这样。”</p>
</blockquote>
<h3 id="Gamespot-——-10-10"><a href="#Gamespot-——-10-10" class="headerlink" title="Gamespot —— 10/10"></a>Gamespot —— 10/10</h3><blockquote>
<p>“每一个粉丝都会有自己喜爱的《合金装备》作品，可能在这方面玩家没有统一的意见。但是《合金装备5：幻痛》的出现解决了这个问题。《合金装备》系列中没有哪一部作品会如此有深度，会有如此丰富的游戏内容。游戏中的开放世界令整体素质更上一个台阶。《幻痛》无疑是合金装备系列中最好的作品。”</p>
</blockquote>
<h3 id="Daily-Dot-5-5"><a href="#Daily-Dot-5-5" class="headerlink" title="Daily Dot 5/5"></a>Daily Dot 5/5</h3><blockquote>
<p>“小岛很机智，他将故事讲的很含蓄。玩家只有在事后才会意识到，原来之前的每件叙事都是有一些深刻的含义的。”</p>
</blockquote>
<h3 id="Game-Informer-9-25-10"><a href="#Game-Informer-9-25-10" class="headerlink" title="Game Informer 9.25/10"></a>Game Informer 9.25/10</h3><blockquote>
<p>“一个游戏系列如果没有进化将很难长久的生存下去，《合金装备5：幻痛》就是一个勇于冒险的证明。一个开放世界，一个可自定义的基地，一个多变的任务体系——这些都不曾是传统《合金装备》系列中的元素，但正是这些令《幻痛》如此出色。”</p>
</blockquote>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://uyouii.github.io/2017/12/21/KCP-源码阅读/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Uyouii">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Uyouii's Blogs">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/12/21/KCP-源码阅读/" class="post-title-link" itemprop="url">KCP 源码阅读</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-12-21 22:01:04" itemprop="dateCreated datePublished" datetime="2017-12-21T22:01:04+08:00">2017-12-21</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-02 11:28:18" itemprop="dateModified" datetime="2019-08-02T11:28:18+08:00">2019-08-02</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/network/" itemprop="url" rel="index"><span itemprop="name">network</span></a></span>

                
                
              
            </span>
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <p>KCP项目地址： <a href="https://github.com/skywind3000/kcp" target="_blank" rel="noopener">KCP - A Fast and Reliable ARQ Protocol</a></p>
<blockquote>
<p>版权声明：本文为博主原创文章，转载请注明出处。</p>
</blockquote>
<p>作者: Uyouii</p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>KCP是一个快速可靠协议，能以比 TCP浪费10%-20%的带宽的代价，换取平均延迟降低 30%-40%，且最大延迟降低三倍的传输效果。纯算法实现，并不负责底层协议（如UDP）的收发，需要使用者自己定义下层数据包的发送方式，以 callback的方式提供给 KCP。 连时钟都需要外部传递进来，内部不会有任何一次系统调用。</p>
<h1 id="主要数据结构"><a href="#主要数据结构" class="headerlink" title="主要数据结构"></a>主要数据结构</h1><h2 id="IKCPSEG"><a href="#IKCPSEG" class="headerlink" title="IKCPSEG"></a>IKCPSEG</h2><p>IKCPSEG是kcp的数据段结构，即储存需要发送的packet的内容。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IKCPSEG</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">IQUEUEHEAD</span> <span class="title">node</span>;</span>	<span class="comment">// 双向链表定义的队列</span></span><br><span class="line">	IUINT32 conv;           <span class="comment">// conversation, 会话序号: 接收到的数据包与发送的一致才接收此数据包</span></span><br><span class="line">	IUINT32 cmd;            <span class="comment">// command, 指令类型: 代表这个Segment的类型</span></span><br><span class="line">	IUINT32 frg;            <span class="comment">// fragment, 分段序号</span></span><br><span class="line">	IUINT32 wnd;            <span class="comment">// window, 窗口大小</span></span><br><span class="line">	IUINT32 ts;             <span class="comment">// timestamp, 发送的时间戳</span></span><br><span class="line">	IUINT32 sn;             <span class="comment">// sequence number, segment序号</span></span><br><span class="line">	IUINT32 una;            <span class="comment">// unacknowledged, 当前未收到的序号: 即代表这个序号之前的包均收到</span></span><br><span class="line">	IUINT32 len;            <span class="comment">// length, 数据长度</span></span><br><span class="line">	IUINT32 resendts;		<span class="comment">// 重发的时间戳</span></span><br><span class="line">	IUINT32 rto;			<span class="comment">// 超时重传的时间间隔</span></span><br><span class="line">	IUINT32 fastack;		<span class="comment">// ack跳过的次数，用于快速重传</span></span><br><span class="line">	IUINT32 xmit;			<span class="comment">// 发送的次数(即重传的次数)</span></span><br><span class="line">	<span class="keyword">char</span> data[<span class="number">1</span>];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="IKCPCB"><a href="#IKCPCB" class="headerlink" title="IKCPCB"></a>IKCPCB</h2><p>IKCPCB是kcp的控制块，用于控制packet的发送，接收，重传等操作。</p>
<p>buffer的发送和接收均调用外部传入的函数。IKCPCB只负责处理算法层面的逻辑。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">IKCPCB</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="comment">//conv:会话ID，mtu:最大传输单元，mss:最大分片大小，state:连接状态</span></span><br><span class="line">	IUINT32 conv, mtu, mss, state;			</span><br><span class="line">	<span class="comment">//sun_una：第一个未确认的包，sen_nxt：待发送包的序号，rcv_nxt：待接收消息的序号</span></span><br><span class="line">	IUINT32 snd_una, snd_nxt, rcv_nxt;		</span><br><span class="line">	<span class="comment">//ssthresh:拥塞窗口的阈值</span></span><br><span class="line">	IUINT32 ts_recent, ts_lastack, ssthresh;</span><br><span class="line">	<span class="comment">//rx_rttval：ack接收rtt浮动值，rx_srtt：ack接收rtt平滑值(smoothed)，rx_rto：由ack接收延迟计算出来的复原时间，rx_minrto：最小复原时间</span></span><br><span class="line">	IINT32 rx_rttval, rx_srtt, rx_rto, rx_minrto;	</span><br><span class="line">	<span class="comment">//sen_wnd：发送窗口大小，rcv_wnd：接收窗口大小，rmt_wnd：远端接收窗口大小，cwnd：拥塞窗口大小，probe	探查变量，IKCP_ASK_TELL表示告知远端窗口大小。IKCP_ASK_SEND表示请求远端告知窗口大小。</span></span><br><span class="line">	IUINT32 snd_wnd, rcv_wnd, rmt_wnd, cwnd, probe;	</span><br><span class="line">	<span class="comment">//currunt：当前的时间戳，interval：内部flush刷新间隔，ts_flush：下次flush刷新时间戳</span></span><br><span class="line">	IUINT32 current, interval, ts_flush, xmit;</span><br><span class="line">	IUINT32 nrcv_buf, nsnd_buf;</span><br><span class="line">	IUINT32 nrcv_que, nsnd_que;</span><br><span class="line">	<span class="comment">//nodelay：是否启动无延迟模式，update：是否调用过update函数的标识(kcp需要上层通过不断的ikcp_update和ikcp_check来驱动kcp的收发过程)</span></span><br><span class="line">	IUINT32 nodelay, updated;</span><br><span class="line">	<span class="comment">//ts_probe：下次探查窗口的时间戳，probe_wait：探查窗口需要等待的时间</span></span><br><span class="line">	IUINT32 ts_probe, probe_wait;</span><br><span class="line">	<span class="comment">//dead_link：最大重传次数，incr：可发送的最大数据量</span></span><br><span class="line">	IUINT32 dead_link, incr;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">IQUEUEHEAD</span> <span class="title">snd_queue</span>;</span>	<span class="comment">//发送消息的队列</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">IQUEUEHEAD</span> <span class="title">rcv_queue</span>;</span>	<span class="comment">//接收消息的队列</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">IQUEUEHEAD</span> <span class="title">snd_buf</span>;</span>		<span class="comment">//发送消息的缓存</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">IQUEUEHEAD</span> <span class="title">rcv_buf</span>;</span>		<span class="comment">//接收消息的缓存</span></span><br><span class="line">	IUINT32 *acklist;				<span class="comment">//待发送的ack的列表</span></span><br><span class="line">	IUINT32 ackcount;				<span class="comment">//ack数量</span></span><br><span class="line">	IUINT32 ackblock;				<span class="comment">//acklist的大小</span></span><br><span class="line">	<span class="keyword">void</span> *user;</span><br><span class="line">	<span class="keyword">char</span> *buffer;					<span class="comment">//储存消息字节流的内存</span></span><br><span class="line">	<span class="keyword">int</span> fastresend;					<span class="comment">//触发快速重传的重复ack个数</span></span><br><span class="line">	<span class="keyword">int</span> nocwnd, stream;				<span class="comment">//nocwnd：取消拥塞控制，stream：是否采用流传输模式</span></span><br><span class="line">	<span class="keyword">int</span> logmask;</span><br><span class="line">	<span class="keyword">int</span> (*output)(<span class="keyword">const</span> <span class="keyword">char</span> *buf, <span class="keyword">int</span> len, struct IKCPCB *kcp, <span class="keyword">void</span> *user);	<span class="comment">//发送消息的回调函数</span></span><br><span class="line">	<span class="keyword">void</span> (*writelog)(<span class="keyword">const</span> <span class="keyword">char</span> *<span class="built_in">log</span>, struct IKCPCB *kcp, <span class="keyword">void</span> *user);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1 id="KCP网络包头结构"><a href="#KCP网络包头结构" class="headerlink" title="KCP网络包头结构"></a>KCP网络包头结构</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">|&lt;------------ <span class="number">4</span> bytes ------------&gt;|</span><br><span class="line">+--------+--------+--------+--------+</span><br><span class="line">|               conv                | conv：Conversation, 会话序号，用于标识收发数据包是否一致</span><br><span class="line">+--------+--------+--------+--------+ cmd: command，用于标识指令，例如：push，ack等</span><br><span class="line">|  cmd   |  frg   |       wnd       | frg: Fragment, 分段序号，序号从大到小</span><br><span class="line">+--------+--------+--------+--------+ wnd: 接收窗口大小</span><br><span class="line">|                ts                 | ts: 发送的时间戳</span><br><span class="line">+--------+--------+--------+--------+</span><br><span class="line">|                sn                 | sn: Segment序号</span><br><span class="line">+--------+--------+--------+--------+</span><br><span class="line">|                una                | una: Unacknowledged, 当前未收到的序号，即代表这个序号之前的包均收到</span><br><span class="line">+--------+--------+--------+--------+      </span><br><span class="line">|                len                | len: data数据的长度</span><br><span class="line">+--------+--------+--------+--------+</span><br></pre></td></tr></table></figure>
<p>kcp包头总共占用了24个字节。给sn分配了4个字节，可以不用考虑序号越界的问题。</p>
<h1 id="KCP工作流程"><a href="#KCP工作流程" class="headerlink" title="KCP工作流程"></a>KCP工作流程</h1><h2 id="发送数据"><a href="#发送数据" class="headerlink" title="发送数据"></a>发送数据</h2><p>kcp首先将要发送的数据存到kcp-&gt;buffer中，如果需要发送的数据总量的大小大于kcp-&gt;mtu，则将buffer中的数据调用output函数发送出去，output函数由用户传入。</p>
<p>kcp数据包发送顺序：</p>
<ol>
<li><code>IKCP_CMD_ACK</code>(ack)</li>
<li><code>IKCP_CMD_WASK</code>(请求远程窗口大小)</li>
<li><code>IKCP_CMD_WINS</code>(发送本地窗口大小)</li>
<li><code>IKCP_CMD_PUSH</code>(push data)</li>
</ol>
<p><img src="/images/kcp1.png" alt></p>
<p>在发送PUSH类型的数据时，首先需要将数据从sen_que移动到sen_buf中（在移动时会检测拥塞窗口的大小，sen_que可以理解为发送数的缓冲队列）。</p>
<p>kcp在发送sen_buf队列中的数据时会检测是否是第一次发送：</p>
<ul>
<li>如果该segment的发送次数为0，则直接发送。</li>
<li>如果发送次数大于0并且已经超时，则再次发送并调整rto和下次超时时间</li>
<li>如果没有超时但是达到了快速重传的条件（被跳过了几个包），则发送并且更新下次超时时间。</li>
</ul>
<h1 id="函数解析"><a href="#函数解析" class="headerlink" title="函数解析"></a>函数解析</h1><h2 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ikcp_input</span><span class="params">(ikcpcb *kcp, <span class="keyword">const</span> <span class="keyword">char</span> *data, <span class="keyword">long</span> size)</span></span></span><br></pre></td></tr></table></figure>
<p>处理接收到的数据，data即用户传入的数据。kcp不负责网络数据的接收，需要用户将接收到的数据传入。</p>
<p>在接收到数据后，解析数据得到segment的sn，una等数据包头信息。首先根据una清除掉<code>kcp-&gt;snd_buf</code>中已经确认接收到的segment（una即表示该seg之前数据包均已收到），随后根据<code>kcp-&gt;sen_buf</code>更新<code>kcp-&gt;snd_una</code>。</p>
<ol>
<li>ack: <code>IKCP_CMD_ACK</code>，首先根据该segment的rtt更新计算kcp的rtt和rto，删除掉<code>kcp-&gt;snd_buf</code>中相应的segment，更新kcp的sed_una(下一个未确认的segment)。</li>
<li>push:<code>IKCP_CMD_PUSH</code>，收到push segment后需要发送ack，将该segment的sn和ts放入<code>kcp-&gt;acklist</code>中。 如果该seg符合滑动窗口的范围，则将该segment放入<code>kcp-&gt;rev_buf</code>中。 如果<code>kcp-&gt;queue</code>的大小小于<code>kcp-&gt;rev_wnd</code>(滑动窗口的大小)，则将<code>kcp-&gt;rev_buf</code>符合条件的segment放入<code>kcp-&gt;rcv_queue</code>中(保证序号连续的seg)。</li>
<li>window ask: <code>IKCP_CMD_WASK</code>,将kcp-&gt;probe中相应位置为1，发送segment时向远端发送相应接收窗口大小。</li>
<li><code>IKCP_CMD_WINS</code>，对应远端的窗口更新包，无需做额外的操作。</li>
</ol>
<p>随后遍历<code>kcp-&gt;sed_buf</code>，更新每个segment的<code>seg-&gt;fastack</code>(被跳过的次数，用于判断是否需要快速重传)。</p>
<p>如果远端接收状态有更新，则更新本地拥塞窗口的大小。</p>
<h2 id="Receive"><a href="#Receive" class="headerlink" title="Receive"></a>Receive</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ikcp_recv</span><span class="params">(ikcpcb *kcp, <span class="keyword">char</span> *buffer, <span class="keyword">int</span> len)</span></span></span><br></pre></td></tr></table></figure>
<p>用户层面的数据读取，从<code>rcv_queue</code>中读取一个packet（如果该packet在发送前分段的话，则将fragement合并后放入buffer中）。input的操作保证了<code>rcv_queue</code>中的segment都是有序且连续的。</p>
<p>随后如果<code>rcv_queue</code>大小小于<code>rcv_wnd</code>（接收窗口）的大小，则将<code>rcv_buf</code>中合适的segment放入<code>rcv_queue</code>中。</p>
<p>如果需要告知远端主机窗口大小，则<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kcp-&gt;probe |= IKCP_ASK_TELL</span><br></pre></td></tr></table></figure></p>
<p>将<code>ICKP_ASK_TELL</code>置为1。</p>
<h2 id="Send"><a href="#Send" class="headerlink" title="Send"></a>Send</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ikcp_send</span><span class="params">(ikcpcb *kcp, <span class="keyword">const</span> <span class="keyword">char</span> *buffer, <span class="keyword">int</span> len)</span></span></span><br></pre></td></tr></table></figure>
<p>将buffer中需要发送的数据分片后放入<code>snd_queue</code>中。</p>
<p>在发送数据时，会首先检测是否开启了流模式。如果开启流模式，在发送数据时，如果上一个segment没有填满mss（最大分片大小），则将这次要发送的数据继续写入上一个segment。如果没有开启流模式，则创建一个新的segment发送。</p>
<p>如果需要发送的数据大小大于mss，则将其拆分为多个segment发送，如果不是流模式，则将其<code>frg</code>至为其相应的序号，序号从count-1开始递减至0，即count-1表示第一个segment，0表示最后一个segment。</p>
<h2 id="Flush"><a href="#Flush" class="headerlink" title="Flush"></a>Flush</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ikcp_flush</span><span class="params">(ikcpcb *kcp)</span></span></span><br></pre></td></tr></table></figure>
<p>flush data，即发送需要发送的数据，ack，win probe，push data等，以及检测<code>snd_buf</code>中的数据是否需要重传。</p>
<p>将seg的wnd设置为接收窗口的剩余大小<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kcp-&gt;rcv_wnd - kcp-&gt;nrcv_que</span><br></pre></td></tr></table></figure></p>
<p><code>nrcv_que</code>指接收队列中的segment的数量。</p>
<p>在发送时将需要发送的数据填充到buffer中，如果buffer下次填入的数据量 &gt; <code>mtu</code>，则调用output函数将buffer中的数据发送出去，ouotput函数由用户定义。</p>
<h4 id="发送segment"><a href="#发送segment" class="headerlink" title="发送segment"></a>发送segment</h4><p>首先将<code>acklist</code>中需要发送的ack发送出去，kcp在发送时会优先发送ack。</p>
<p>如果远端接收窗口大小为0且当前时间超过下次发送窗口探测时间，则<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kcp-&gt;probe |= IKCP_ASK_SEND;</span><br></pre></td></tr></table></figure></p>
<p>并更新窗口探测时间间隔和下次窗口探测时间。</p>
<p>如果需要探测远端发送窗口大小或者需要告诉远端本机发送窗口大小，则发送相应的probe segment。</p>
<p>取拥塞窗口的大小为发送窗口和远端接收窗口的最小值。在已经发送的segment的数量不超过拥塞窗口大小时将送<code>sed_queue</code>中的segment放入<code>snd_buf</code>中。</p>
<p>遍历<code>snd_buf</code>中的数据：</p>
<ol>
<li>如果之前没有发送过，则设置其rto和超时重传时间，并将needsend置为1.</li>
<li>如果<code>snd_buf</code>中的segment超过其超时重传时间，如果启动无延时模式，则将segment的rto<em>1.5，否则将rto </em> 2，并将needsend置为1。</li>
<li>如果启动了快速重传并且该segment被跳过的次数大于resent，则将needsend置为1，并更新该segment的超时时间。</li>
</ol>
<p>如果needsend被置为1，则将该segment发送出去。</p>
<p>如果segment的重传次数超过kcp的最大重传次数，则更新kcp的连接状态为-1。</p>
<p>发送之后更新ssthresh(拥塞窗口阈值)和cwnd(拥塞窗口大小)。</p>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
      

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://uyouii.github.io/2017/12/21/剑指offer题解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Uyouii">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/logo1.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Uyouii's Blogs">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2017/12/21/剑指offer题解/" class="post-title-link" itemprop="url">剑指offer题解</a>
              
            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-12-21 21:15:39" itemprop="dateCreated datePublished" datetime="2017-12-21T21:15:39+08:00">2017-12-21</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-02 11:28:18" itemprop="dateModified" datetime="2019-08-02T11:28:18+08:00">2019-08-02</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/algorithm/" itemprop="url" rel="index"><span itemprop="name">algorithm</span></a></span>

                
                
              
            </span>
          

          <br>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
            <p>剑指offer上的一些算法题解。</p>
<h2 id="1-10-Problems"><a href="#1-10-Problems" class="headerlink" title="1 ~ 10 Problems"></a>1 ~ 10 Problems</h2><h3 id="01-赋值运算符函数"><a href="#01-赋值运算符函数" class="headerlink" title="01 赋值运算符函数"></a>01 赋值运算符函数</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">求出1~13的整数中1出现的次数,并算出100~1300的整数中1出现的次数？</span><br><span class="line">为此他特别数了一下1~13中包含1的数字有1、10、11、12、13因此共出现6次,但是对于后面问题他就没辙了。</span><br><span class="line">ACMer希望你们帮帮他,并把问题更加普遍化,可以很快的求出任意非负整数区间中1出现的次数。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">NumberOf1Between1AndN_Solution</span><span class="params">(<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> index = <span class="number">10</span>;</span><br><span class="line">		<span class="keyword">while</span> (index / <span class="number">10</span> &lt;= n) &#123;</span><br><span class="line">			<span class="keyword">int</span> res = n / index, rem = n % index;</span><br><span class="line">			<span class="keyword">if</span>(res &gt;= <span class="number">1</span>)</span><br><span class="line">				result += res * index / <span class="number">10</span>; </span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (rem &gt;= <span class="number">2</span> * index / <span class="number">10</span>) &#123;</span><br><span class="line">				result += index / <span class="number">10</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(rem &gt;= index / <span class="number">10</span> )&#123;</span><br><span class="line">				result += rem - (index / <span class="number">10</span>) + <span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			index *= <span class="number">10</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="03-数组中重复的数字"><a href="#03-数组中重复的数字" class="headerlink" title="03 数组中重复的数字"></a>03 数组中重复的数字</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在一个长度为n的数组里的所有数字都在0到n-1的范围内。数组中某些数字是重复的，但不知道有几个数字重复了，</span><br><span class="line">也不知道每个数字重复了几次。请找出数组中任意一个重复的数字。例如，如果输入长度为7的数组&#123;2, 3, 1, 0, 2, 5, 3&#125;，</span><br><span class="line">那么对应的输出是重复的数字2或者3。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">duplicate</span><span class="params">(<span class="keyword">int</span> numbers[], <span class="keyword">int</span> length, <span class="keyword">int</span>* duplication)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!numbers || length &lt;= <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">		<span class="keyword">while</span> (numbers[i] != i) &#123;</span><br><span class="line">			<span class="keyword">if</span> (numbers[i] == numbers[numbers[i]]) &#123;</span><br><span class="line">				*duplication = numbers[i];</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			swap(numbers[i], numbers[numbers[i]]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="04-二维数组中的查找"><a href="#04-二维数组中的查找" class="headerlink" title="04 二维数组中的查找"></a>04 二维数组中的查找</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在一个二维数组中，每一行都按照从左到右递增的顺序排序，每一列都按</span><br><span class="line">照从上到下递增的顺序排序。请完成一个函数，输入这样的一个二维数组和一个</span><br><span class="line">整数，判断数组中是否含有该整数。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//每次比较右上角的元素和target的关系，选择剔除行或者列</span></span><br><span class="line"><span class="comment">//如果该数字等于要查找的数字，则查找过程结束</span></span><br><span class="line"><span class="comment">//如果该数字中大于要查找的数字，则剔除这个字所在的列</span></span><br><span class="line"><span class="comment">//如果这个字小于要查找的数字，则提出这个字所在的行</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">Find</span><span class="params">(<span class="keyword">int</span>* matrix, <span class="keyword">int</span> rows, <span class="keyword">int</span> columns, <span class="keyword">int</span> number)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!matrix || rows &lt;= <span class="number">0</span> || columns &lt;= <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">int</span> index, r = <span class="number">0</span>, c = columns - <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (r &lt; rows &amp;&amp; c &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">		index = r * columns + c;</span><br><span class="line">		<span class="keyword">if</span> (matrix[index] == number)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (matrix[index] &lt; number) &#123;</span><br><span class="line">			++r;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (matrix[index] &gt; number) &#123;</span><br><span class="line">			--c;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="05-替换空格"><a href="#05-替换空格" class="headerlink" title="05 替换空格"></a>05 替换空格</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请实现一个函数，把字符串中的每个空格替换成&quot;%20&quot;。例如输入“We are happy.”，则输出“We%20are%20happy.”。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//先遍历一遍字符串得到其中空格的数量</span></span><br><span class="line"><span class="comment">//然后从后面开始替换，时间复杂度O(n),空间复杂度O(1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//length 为字符串的总容量</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ReplaceBlank</span><span class="params">(<span class="keyword">char</span> <span class="built_in">string</span>[], <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!<span class="built_in">string</span> || length &lt;= <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">int</span> blankNum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> oldl = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (; <span class="built_in">string</span>[oldl] != <span class="string">'\0'</span>; oldl++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">string</span>[oldl] == <span class="string">' '</span>)</span><br><span class="line">			++blankNum;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> newLength = oldl + <span class="number">2</span> * blankNum;</span><br><span class="line">	<span class="keyword">if</span> (newLength &gt; length)</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> l1 = newLength - <span class="number">1</span>, l2 = oldl - <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">while</span> (l2 &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">string</span>[l2] != <span class="string">' '</span>) &#123;</span><br><span class="line">			<span class="built_in">string</span>[l1--] = <span class="built_in">string</span>[l2--];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">string</span>[l1--] = <span class="string">'0'</span>;</span><br><span class="line">			<span class="built_in">string</span>[l1--] = <span class="string">'2'</span>;</span><br><span class="line">			<span class="built_in">string</span>[l1--] = <span class="string">'%'</span>;</span><br><span class="line">			--l2;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="06-从尾到头打印链表"><a href="#06-从尾到头打印链表" class="headerlink" title="06 从尾到头打印链表"></a>06 从尾到头打印链表</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输入一个链表的头结点，从尾到头反过来打印出每个结点的值。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; printListFromTailToHead(ListNode* head) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!head)</span><br><span class="line">			<span class="keyword">return</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">		ListNode* node = head;</span><br><span class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; result;</span><br><span class="line">		<span class="keyword">while</span> (node) &#123;</span><br><span class="line">			result.push_back(node-&gt;val);</span><br><span class="line">			node = node-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">		reverse(result.begin(), result.end());</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="07-重建二叉树"><a href="#07-重建二叉树" class="headerlink" title="07 重建二叉树"></a>07 重建二叉树</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入某二叉树的前序遍历和中序遍历的结果，请重建出该二叉树。</span><br><span class="line">假设输入的前序遍历和中序遍历的结果中都不含重复的数字。</span><br><span class="line">例如输入前序遍历序列&#123; 1,2,4,7,3,5,6,8 &#125;和中序遍历序列&#123; 4,7,2,1,5,3,8,6 &#125;，则重建二叉树并返回。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">TreeNode* <span class="title">reConstructBinaryTree</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; pre, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vin)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (pre.size() == <span class="number">0</span> || vin.size() == <span class="number">0</span> || pre.size() != vin.size())</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">		<span class="keyword">return</span> createTree(pre, <span class="number">0</span>, pre.size() - <span class="number">1</span>, vin, <span class="number">0</span>, vin.size() - <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function">TreeNode* <span class="title">createTree</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; pre, <span class="keyword">int</span> p_begin, <span class="keyword">int</span> p_end, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; vin, <span class="keyword">int</span> v_begin, <span class="keyword">int</span> v_end)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (p_begin == p_end) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> TreeNode(pre[p_begin]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (p_begin &gt; p_end)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> v_head;</span><br><span class="line">		<span class="keyword">for</span> (v_head = v_begin; v_head &lt;= v_end; v_head++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (vin[v_head] == pre[p_begin])</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		TreeNode* head = <span class="keyword">new</span> TreeNode(vin[v_head]);</span><br><span class="line">		<span class="keyword">if</span> (v_head &gt; v_begin) &#123;</span><br><span class="line">			<span class="keyword">int</span> l = v_head - v_begin;</span><br><span class="line">			head-&gt;left = createTree(pre, p_begin + <span class="number">1</span>, p_begin + l, vin, v_begin, v_head - <span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (v_head &lt; v_end) &#123;</span><br><span class="line">			<span class="keyword">int</span> l = v_end - v_head;</span><br><span class="line">			head-&gt;right = createTree(pre, p_end - l + <span class="number">1</span>, p_end, vin, v_head + <span class="number">1</span>, v_end);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> head;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="08-二叉树的下一个节点"><a href="#08-二叉树的下一个节点" class="headerlink" title="08 二叉树的下一个节点"></a>08 二叉树的下一个节点</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">给定一个二叉树和其中的一个结点，请找出中序遍历顺序的下一个结点并且返回。</span><br><span class="line">注意，树中的结点不仅包含左右子结点，同时包含指向父结点的指针。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">TreeLinkNode* <span class="title">GetNext</span><span class="params">(TreeLinkNode* pNode)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!pNode)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (pNode-&gt;right) &#123;</span><br><span class="line">			TreeLinkNode* node = pNode-&gt;right;</span><br><span class="line">			<span class="keyword">while</span> (node-&gt;left)</span><br><span class="line">				node = node-&gt;left;</span><br><span class="line">			<span class="keyword">return</span> node;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			TreeLinkNode* node = pNode;</span><br><span class="line">			<span class="keyword">while</span> (node-&gt;next &amp;&amp; node-&gt;next-&gt;right == node)</span><br><span class="line">				node = node-&gt;next;</span><br><span class="line">			<span class="keyword">return</span> node-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="09-用两个栈实现队列"><a href="#09-用两个栈实现队列" class="headerlink" title="09 用两个栈实现队列"></a>09 用两个栈实现队列</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">用两个栈来实现一个队列，完成队列的Push和Pop操作。 </span><br><span class="line">队列中的元素为int类型。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//很厉害</span></span><br><span class="line"><span class="comment">//一个push栈，一个pop栈</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> node)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">pop</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; stack1;</span><br><span class="line">	<span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; stack2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> Solution::push(<span class="keyword">int</span> node) &#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;stack1.push(node);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> Solution::pop() &#123;</span><br><span class="line">	<span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span>-&gt;stack2.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		result = stack2.top();</span><br><span class="line">		<span class="keyword">this</span>-&gt;stack2.pop();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">while</span> (stack1.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			stack2.push(stack1.top());</span><br><span class="line">			stack1.pop();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (stack2.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			result = stack2.top();</span><br><span class="line">			stack2.pop();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-斐波那契数列"><a href="#10-斐波那契数列" class="headerlink" title="10 斐波那契数列"></a>10 斐波那契数列</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">大家都知道斐波那契数列，现在要求输入一个整数n，请你输出斐波那契数列的第n项。</span><br><span class="line">n &lt;= 39</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; fibArray;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">Fibonacci</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (n == <span class="number">0</span> || n == <span class="number">1</span>)</span><br><span class="line">			<span class="keyword">return</span> n;</span><br><span class="line">		fibArray = <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(n + <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">		fibArray[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">			fibArray[i] = fibArray[i - <span class="number">1</span>] + fibArray[i - <span class="number">2</span>];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> fibArray[n];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="11-20-Problems"><a href="#11-20-Problems" class="headerlink" title="11 ~ 20 Problems"></a>11 ~ 20 Problems</h2><h3 id="11-旋转数组的最小数字"><a href="#11-旋转数组的最小数字" class="headerlink" title="11 旋转数组的最小数字"></a>11 旋转数组的最小数字</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">把一个数组最开始的若干个元素搬到数组的末尾，我们称之为数组的旋转。 </span><br><span class="line">输入一个非递减排序的数组的一个旋转，输出旋转数组的最小元素。 </span><br><span class="line">例如数组&#123; 3,4,5,1,2 &#125;为&#123; 1,2,3,4,5 &#125;的一个旋转，该数组的最小值为1。 </span><br><span class="line">NOTE：给出的所有元素都大于0，若数组大小为0，请返回0。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">minNumberInRotateArray</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; rotateArray)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> begin = <span class="number">0</span>, end = rotateArray.size() - <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span> (begin &lt; end &amp;&amp; rotateArray[begin] &gt;= rotateArray[end]) &#123;</span><br><span class="line">			<span class="keyword">int</span> mid = (begin + end) / <span class="number">2</span>;</span><br><span class="line">			<span class="keyword">if</span> (rotateArray[mid] &gt;= rotateArray[end]) &#123;</span><br><span class="line">				begin = mid + <span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (rotateArray[mid] &lt; rotateArray[end]) &#123;</span><br><span class="line">				end = mid;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> rotateArray[begin];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="12-矩阵中的路径"><a href="#12-矩阵中的路径" class="headerlink" title="12 矩阵中的路径"></a>12 矩阵中的路径</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">请设计一个函数，用来判断在一个矩阵中是否存在一条包含某字符串所有字符的路径。</span><br><span class="line">路径可以从矩阵中的任意一个格子开始，每一步可以在矩阵中向左，向右，向上，向下移动一个格子。</span><br><span class="line">如果一条路径经过了矩阵中的某一个格子，则该路径不能再进入该格子。 </span><br><span class="line">例如 a b c e s f c s a d e e 矩阵中包含一条字符串&quot;bcced&quot;的路径，但是矩阵中不包含&quot;abcb&quot;路径，</span><br><span class="line">因为字符串的第一个字符b占据了矩阵中的第一行第二个格子之后，路径不能再次进入该格子。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">int</span> rows, cols;</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt;&gt; mark;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">hasPath</span><span class="params">(<span class="keyword">char</span>* matrix, <span class="keyword">int</span> rows, <span class="keyword">int</span> cols, <span class="keyword">char</span>* str)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!matrix || rows &lt;= <span class="number">0</span> || cols &lt;= <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">this</span>-&gt;mark = <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt;&gt;(rows, <span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt;(cols, <span class="literal">false</span>));</span><br><span class="line">		<span class="keyword">this</span>-&gt;rows = rows;</span><br><span class="line">		<span class="keyword">this</span>-&gt;cols = cols;</span><br><span class="line">		<span class="keyword">char</span>* c = matrix;</span><br><span class="line">		<span class="keyword">bool</span> result = <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(matrix); i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (matrix[i] == *str) &#123;</span><br><span class="line">				result = found(matrix, str, i / cols, i % cols);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (result)</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">found</span><span class="params">(<span class="keyword">char</span>* matrix, <span class="keyword">char</span>* str, <span class="keyword">int</span> x,<span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (*str == <span class="string">'\0'</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">if</span> (x &lt; <span class="number">0</span> || x &gt;= rows || y &lt; <span class="number">0</span> || y &gt;= cols)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">int</span> index = x * cols + y;</span><br><span class="line">		<span class="keyword">bool</span> result = <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (!mark[x][y] &amp;&amp; matrix[index] == *str) &#123;</span><br><span class="line">			mark[x][y] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (!result)</span><br><span class="line">				result = found(matrix, str + <span class="number">1</span>, x - <span class="number">1</span>, y);</span><br><span class="line">			<span class="keyword">if</span> (!result)</span><br><span class="line">				result = found(matrix, str + <span class="number">1</span>, x + <span class="number">1</span>, y);</span><br><span class="line">			<span class="keyword">if</span> (!result)</span><br><span class="line">				result = found(matrix, str + <span class="number">1</span>, x, y - <span class="number">1</span>);</span><br><span class="line">			<span class="keyword">if</span> (!result)</span><br><span class="line">				result = found(matrix, str + <span class="number">1</span>, x, y + <span class="number">1</span>);</span><br><span class="line">			mark[x][y] = <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="13-机器人的运动范围"><a href="#13-机器人的运动范围" class="headerlink" title="13 机器人的运动范围"></a>13 机器人的运动范围</h3><p>题目:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">地上有一个m行和n列的方格。</span><br><span class="line">一个机器人从坐标0, 0的格子开始移动，每一次只能向左，右，上，下四个方向移动一格，</span><br><span class="line">但是不能进入行坐标和列坐标的数位之和大于k的格子。 </span><br><span class="line">例如，当k为18时，机器人能够进入方格（35, 37），因为3 + 5 + 3 + 7 = 18。</span><br><span class="line">但是，它不能进入方格（35, 38），因为3 + 5 + 3 + 8 = 19。</span><br><span class="line">请问该机器人能够达到多少个格子？</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">movingCount</span><span class="params">(<span class="keyword">int</span> threshold, <span class="keyword">int</span> rows, <span class="keyword">int</span> cols)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (threshold &lt; <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt; check(rows * cols, <span class="number">0</span>);</span><br><span class="line">		<span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; search;</span><br><span class="line">		search.push(<span class="number">0</span>);</span><br><span class="line">		check[<span class="number">0</span> ] = <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">int</span> result = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span> (search.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">int</span> point = search.front();</span><br><span class="line">			<span class="keyword">int</span> x = point / cols, y = point % cols;</span><br><span class="line">			search.pop();</span><br><span class="line">			<span class="keyword">if</span> (x &gt; <span class="number">0</span> &amp;&amp; count(x - <span class="number">1</span>, y) &gt; threshold) &#123;</span><br><span class="line">				check[point - cols] = <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (x &gt; <span class="number">0</span> &amp;&amp; !check[point - cols]) &#123;</span><br><span class="line">				search.push(point - cols);</span><br><span class="line">				check[point - cols] = <span class="literal">true</span>;</span><br><span class="line">				++result;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (x &lt; rows - <span class="number">1</span> &amp;&amp; count(x + <span class="number">1</span>, y) &gt; threshold) &#123;</span><br><span class="line">				check[point + cols] = <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (x &lt; rows - <span class="number">1</span> &amp;&amp; !check[point + cols]) &#123;</span><br><span class="line">				search.push(point + cols);</span><br><span class="line">				check[point + cols] = <span class="literal">true</span>;</span><br><span class="line">				++result;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (y &gt; <span class="number">0</span> &amp;&amp; count(x, y - <span class="number">1</span>) &gt; threshold) &#123;</span><br><span class="line">				check[point - <span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (y &gt; <span class="number">0</span> &amp;&amp; !check[point - <span class="number">1</span>]) &#123;</span><br><span class="line">				search.push(point - <span class="number">1</span>);</span><br><span class="line">				check[point - <span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">				++result;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (y &lt; cols - <span class="number">1</span> &amp;&amp; count(x, y + <span class="number">1</span>) &gt; threshold) &#123;</span><br><span class="line">				check[point + <span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (y &lt; cols - <span class="number">1</span> &amp;&amp; !check[point + <span class="number">1</span>]) &#123;</span><br><span class="line">				search.push(point + <span class="number">1</span>);</span><br><span class="line">				check[point + <span class="number">1</span>] = <span class="literal">true</span>;</span><br><span class="line">				++result;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">count</span><span class="params">(<span class="keyword">int</span> rows, <span class="keyword">int</span> cols)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span> (rows &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			result += rows % <span class="number">10</span>;</span><br><span class="line">			rows /= <span class="number">10</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span> (cols &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			result += cols % <span class="number">10</span>;</span><br><span class="line">			cols /= <span class="number">10</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="14-剪绳子"><a href="#14-剪绳子" class="headerlink" title="14 剪绳子"></a>14 剪绳子</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">给你一根长度为n绳子，请把绳子剪成m段（m、n都是整数，n&gt;1并且m≥1）。</span><br><span class="line">每段的绳子的长度记为k[0]、k[1]、……、k[m]。k[0]*k[1]*…*k[m]可能的最大乘积是多少？</span><br><span class="line">例如当绳子的长度是8时，我们把它剪成长度分别为2、3、3的三段，此时得到最大的乘积18。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//如果不知道结论的话可以用动态规划的方法实现</span></span><br><span class="line"><span class="comment">//结论：如果剩下的长度仍大于等于5，则尽可能的减成长度为3的绳子</span></span><br><span class="line"><span class="comment">//如果小于5，则不变</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">maxProductAfterCutting</span><span class="params">(<span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (length &lt;= <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (length &lt;= <span class="number">4</span>)</span><br><span class="line">		<span class="keyword">return</span> length;</span><br><span class="line">	<span class="keyword">int</span> time3 = length / <span class="number">3</span>;</span><br><span class="line">	<span class="keyword">int</span> rem = length % <span class="number">3</span>;</span><br><span class="line">	<span class="keyword">if</span> (rem == <span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">4</span> * (<span class="keyword">int</span>)(<span class="built_in">pow</span>(<span class="number">3</span>, time3 - <span class="number">1</span>));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (rem == <span class="number">0</span>)</span><br><span class="line">		<span class="keyword">return</span> (<span class="keyword">int</span>)(<span class="built_in">pow</span>(<span class="number">3</span>, time3));</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">return</span> (<span class="keyword">int</span>)(<span class="built_in">pow</span>(<span class="number">3</span>, time3)) * rem;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="15-二进制中1的个数"><a href="#15-二进制中1的个数" class="headerlink" title="15 二进制中1的个数"></a>15 二进制中1的个数</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输入一个整数，输出该数二进制表示中1的个数。其中负数用补码表示。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接将n右移可能会因为n为负数造成死循环</span></span><br><span class="line"><span class="comment">//正常解法是用一个flat每次左移和原来的数进行&amp;运算</span></span><br><span class="line"><span class="comment">//这里采用一种新解法</span></span><br><span class="line"><span class="comment">//n &amp; (n - 1) 相当于将一个数最右边的1变成0</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">NumberOf1</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span> (n) &#123;</span><br><span class="line">			n = n &amp; (n - <span class="number">1</span>);</span><br><span class="line">			++count;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> count;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="16-数值的整数次方法"><a href="#16-数值的整数次方法" class="headerlink" title="16 数值的整数次方法"></a>16 数值的整数次方法</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">给定一个double类型的浮点数base和int类型的整数exponent。求base的exponent次方。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">double</span> <span class="title">Power</span><span class="params">(<span class="keyword">double</span> base, <span class="keyword">int</span> exponent)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (exponent == <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (exponent &lt; <span class="number">0</span>) &#123;</span><br><span class="line">			flag = <span class="literal">true</span>;</span><br><span class="line">			exponent = -exponent;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">double</span> result = <span class="number">1.0</span>;</span><br><span class="line">		<span class="keyword">double</span> temp = base;</span><br><span class="line">		<span class="keyword">while</span> (exponent &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span> (exponent &amp; <span class="number">1</span>) &#123;</span><br><span class="line">				result *= temp;</span><br><span class="line">			&#125;</span><br><span class="line">			exponent &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">			temp *= temp;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (flag) &#123;</span><br><span class="line">			result = <span class="number">1</span> / result;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="18-删除链表中重复的节点"><a href="#18-删除链表中重复的节点" class="headerlink" title="18 删除链表中重复的节点"></a>18 删除链表中重复的节点</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在一个排序的链表中，存在重复的结点，请删除该链表中重复的结点，</span><br><span class="line">重复的结点不保留，返回链表头指针。 </span><br><span class="line">例如，链表1-&gt;2-&gt;3-&gt;3-&gt;4-&gt;4-&gt;5 处理后为 1-&gt;2-&gt;5</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">ListNode* <span class="title">deleteDuplication</span><span class="params">(ListNode* pHead)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!pHead)</span><br><span class="line">			<span class="keyword">return</span> pHead;</span><br><span class="line">		ListNode* head = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">		head-&gt;next = pHead;</span><br><span class="line">		ListNode* node = head, *tem;</span><br><span class="line">		<span class="keyword">while</span> (node) &#123;</span><br><span class="line">			<span class="keyword">if</span> (node-&gt;next &amp;&amp; node-&gt;next-&gt;next &amp;&amp; node-&gt;next-&gt;val == node-&gt;next-&gt;next-&gt;val) &#123;</span><br><span class="line">				<span class="keyword">int</span> val = node-&gt;next-&gt;val;</span><br><span class="line">				<span class="keyword">while</span> (node-&gt;next &amp;&amp; node-&gt;next-&gt;val == val) &#123;</span><br><span class="line">					tem = node-&gt;next;</span><br><span class="line">					node-&gt;next = node-&gt;next-&gt;next;</span><br><span class="line">					<span class="keyword">delete</span> tem;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//需要注意!</span></span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				node = node-&gt;next;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		pHead = head-&gt;next;</span><br><span class="line">		<span class="keyword">delete</span> head;</span><br><span class="line">		<span class="keyword">return</span> pHead;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="19-正则表达死匹配"><a href="#19-正则表达死匹配" class="headerlink" title="19 正则表达死匹配"></a>19 正则表达死匹配</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">请实现一个函数用来匹配包括&apos;.&apos;和&apos;*&apos;的正则表达式。模式中的字符&apos;.&apos;表示任意一个字符，</span><br><span class="line">而&apos;*&apos;表示它前面的字符可以出现任意次（包含0次）。 </span><br><span class="line">在本题中，匹配是指字符串的所有字符匹配整个模式。</span><br><span class="line">例如，字符串&quot;aaa&quot;与模式&quot;a.a&quot;和&quot;ab*ac*a&quot;匹配，但是与&quot;aa.a&quot;和&quot;ab*a&quot;均不匹配</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">match</span><span class="params">(<span class="keyword">char</span>* str, <span class="keyword">char</span>* pattern)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!str &amp;&amp; !pattern)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">int</span> M = <span class="built_in">strlen</span>(str);</span><br><span class="line">		<span class="keyword">int</span> N = <span class="built_in">strlen</span>(pattern);</span><br><span class="line">		<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt;&gt; check(M + <span class="number">1</span>, <span class="built_in">vector</span>&lt;<span class="keyword">bool</span>&gt;(N + <span class="number">1</span>, <span class="literal">false</span>));</span><br><span class="line">		check[<span class="number">0</span>][<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= N; k++) &#123;</span><br><span class="line">			check[<span class="number">0</span>][k] = (k &gt;= <span class="number">2</span> &amp;&amp; pattern[k - <span class="number">1</span>] == <span class="string">'*'</span> &amp;&amp; check[<span class="number">0</span>][k - <span class="number">2</span>]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= M; i++) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= N; j++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (pattern[j - <span class="number">1</span>] == <span class="string">'.'</span>) &#123;</span><br><span class="line">					check[i][j] = check[i - <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">if</span> (pattern[j - <span class="number">1</span>] == <span class="string">'*'</span>) &#123;</span><br><span class="line">					<span class="keyword">if</span> (j &gt;= <span class="number">2</span> &amp;&amp; pattern[j - <span class="number">2</span>] == <span class="string">'.'</span>) &#123;</span><br><span class="line">						<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;= i; k++) &#123;</span><br><span class="line">							<span class="keyword">if</span> (check[k][j - <span class="number">2</span>]) &#123;</span><br><span class="line">								check[i][j] = <span class="literal">true</span>;</span><br><span class="line">								<span class="keyword">break</span>;</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">else</span> &#123;</span><br><span class="line">						check[i][j] = check[i][j - <span class="number">1</span>] ||</span><br><span class="line">							(j &gt;= <span class="number">2</span> &amp;&amp; (check[i - <span class="number">1</span>][j] || check[i - <span class="number">1</span>][j - <span class="number">1</span>]) &amp;&amp; (str[i - <span class="number">1</span>] == pattern[j - <span class="number">2</span>])) ||</span><br><span class="line">							(j &gt;= <span class="number">2</span> &amp;&amp; check[i][j - <span class="number">2</span>]);</span><br><span class="line">					&#125;	</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span>&#123;</span><br><span class="line">					check[i][j] = check[i - <span class="number">1</span>][j - <span class="number">1</span>] &amp;&amp; (str[i - <span class="number">1</span>] == pattern[j - <span class="number">1</span>]);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//for (int i = 0; i &lt;= M; i++) &#123;</span></span><br><span class="line">		<span class="comment">//	for (int j = 0; j &lt;= N; j++) &#123;</span></span><br><span class="line">		<span class="comment">//		cout &lt;&lt; check[i][j] &lt;&lt; " ";</span></span><br><span class="line">		<span class="comment">//	&#125;</span></span><br><span class="line">		<span class="comment">//	cout &lt;&lt; endl;</span></span><br><span class="line">		<span class="comment">//&#125;</span></span><br><span class="line">		<span class="keyword">return</span> check[M][N];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="21-30-Problems"><a href="#21-30-Problems" class="headerlink" title="21 ~ 30 Problems"></a>21 ~ 30 Problems</h2><h3 id="21-调整数组顺序使奇数位于偶数前面"><a href="#21-调整数组顺序使奇数位于偶数前面" class="headerlink" title="21 调整数组顺序使奇数位于偶数前面"></a>21 调整数组顺序使奇数位于偶数前面</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入一个整数数组，实现一个函数来调整该数组中数字的顺序，</span><br><span class="line">使得所有的奇数位于数组的前半部分，所有的偶数位于位于数组的后半部分，</span><br><span class="line">并保证奇数和奇数，偶数和偶数之间的相对位置不变。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">reOrderArray</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; <span class="built_in">array</span>)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">array</span>.size() == <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; orderArray(<span class="built_in">array</span>);</span><br><span class="line">		<span class="keyword">int</span> begin = <span class="number">0</span>, end = orderArray.size() - <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; orderArray.size(); i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (orderArray[i] &amp; <span class="number">1</span>) &#123;</span><br><span class="line">				<span class="built_in">array</span>[begin++] = orderArray[i];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = orderArray.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!(orderArray[i] &amp; <span class="number">1</span>))</span><br><span class="line">				<span class="built_in">array</span>[end--] = orderArray[i];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="22-链表中倒数第k个节点"><a href="#22-链表中倒数第k个节点" class="headerlink" title="22 链表中倒数第k个节点"></a>22 链表中倒数第k个节点</h3><p>题目:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输入一个链表，输出该链表中倒数第k个结点。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">ListNode* <span class="title">FindKthToTail</span><span class="params">(ListNode* pListHead, <span class="keyword">unsigned</span> <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (k &lt;= <span class="number">0</span> || !pListHead)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">		ListNode* node = pListHead;</span><br><span class="line">		ListNode* lastKNode = pListHead;</span><br><span class="line">		<span class="keyword">int</span> number = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">while</span> (node) &#123;</span><br><span class="line">			<span class="keyword">if</span> (number &gt;= k)</span><br><span class="line">				lastKNode = lastKNode-&gt;next;</span><br><span class="line">			node = node-&gt;next;</span><br><span class="line">			number++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (k &gt; number)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">		<span class="keyword">return</span> lastKNode;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="23-链表中环的入口点"><a href="#23-链表中环的入口点" class="headerlink" title="23 链表中环的入口点"></a>23 链表中环的入口点</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一个链表中包含环，请找出该链表的环的入口结点。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">ListNode* <span class="title">EntryNodeOfLoop</span><span class="params">(ListNode* pHead)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!pHead)</span><br><span class="line">			<span class="keyword">return</span> pHead;</span><br><span class="line">		ListNode *fast = pHead, *slow = pHead;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (fast) &#123;</span><br><span class="line">			<span class="keyword">if</span> (!fast-&gt;next || !fast-&gt;next-&gt;next)</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">			fast = fast-&gt;next-&gt;next;</span><br><span class="line">			slow = slow-&gt;next;</span><br><span class="line">			<span class="keyword">if</span> (fast == slow)</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		ListNode *entrance = pHead;</span><br><span class="line">		<span class="keyword">while</span> (entrance != slow) &#123;</span><br><span class="line">			entrance = entrance-&gt;next;</span><br><span class="line">			slow = slow-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> entrance;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="24-反转链表"><a href="#24-反转链表" class="headerlink" title="24 反转链表"></a>24 反转链表</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输入一个链表，反转链表后，输出链表的所有元素。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">ListNode* <span class="title">ReverseList</span><span class="params">(ListNode* pHead)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!pHead || !pHead-&gt;next)</span><br><span class="line">			<span class="keyword">return</span> pHead;</span><br><span class="line">		ListNode *p1 = pHead, *p2 = pHead-&gt;next, *p3 = pHead-&gt;next-&gt;next;</span><br><span class="line">		<span class="keyword">while</span> (p2) &#123;</span><br><span class="line">			p2-&gt;next = p1;</span><br><span class="line">			p1 = p2;</span><br><span class="line">			p2 = p3;</span><br><span class="line">			<span class="keyword">if</span> (p3)</span><br><span class="line">				p3 = p3-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">		pHead-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">		<span class="keyword">return</span> p1;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="25-合并两个排序的链表"><a href="#25-合并两个排序的链表" class="headerlink" title="25 合并两个排序的链表"></a>25 合并两个排序的链表</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输入两个单调递增的链表，输出两个链表合成后的链表，当然我们需要合成后的链表满足单调不减规则。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">ListNode* <span class="title">Merge</span><span class="params">(ListNode* pHead1, ListNode* pHead2)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!pHead1)</span><br><span class="line">			<span class="keyword">return</span> pHead2;</span><br><span class="line">		<span class="keyword">if</span> (!pHead2)</span><br><span class="line">			<span class="keyword">return</span> pHead1;</span><br><span class="line"></span><br><span class="line">		ListNode *node1 = pHead1, *node2 = pHead2, *node;</span><br><span class="line">		ListNode *head = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">		node = head;</span><br><span class="line">		<span class="keyword">while</span> (node1 &amp;&amp; node2) &#123;</span><br><span class="line">			<span class="keyword">if</span> (node1-&gt;val &lt;= node2-&gt;val) &#123;</span><br><span class="line">				node-&gt;next = node1;</span><br><span class="line">				node1 = node1-&gt;next;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				node-&gt;next = node2;</span><br><span class="line">				node2 = node2-&gt;next;</span><br><span class="line">			&#125;</span><br><span class="line">			node = node-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (node1) &#123;</span><br><span class="line">			node-&gt;next = node1;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (node2) &#123;</span><br><span class="line">			node-&gt;next = node2;</span><br><span class="line">		&#125;</span><br><span class="line">		node = head-&gt;next;</span><br><span class="line">		<span class="keyword">delete</span> head;</span><br><span class="line">		<span class="keyword">return</span> node;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="26-树的子结构"><a href="#26-树的子结构" class="headerlink" title="26 树的子结构"></a>26 树的子结构</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输入两棵二叉树A，B，判断B是不是A的子结构。（ps：我们约定空树不是任意一个树的子结构）</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">HasSubtree</span><span class="params">(TreeNode* pRoot1, TreeNode* pRoot2)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!pRoot2 || !pRoot1)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="built_in">queue</span>&lt;TreeNode*&gt; nodeQueue;</span><br><span class="line">		nodeQueue.push(pRoot1);</span><br><span class="line">		<span class="keyword">while</span> (nodeQueue.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			TreeNode* top = nodeQueue.front();</span><br><span class="line">			<span class="keyword">if</span> (top-&gt;val == pRoot2-&gt;val &amp;&amp; check(top, pRoot2))</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">			nodeQueue.pop();</span><br><span class="line">			<span class="keyword">if</span> (top-&gt;left)</span><br><span class="line">				nodeQueue.push(top-&gt;left);</span><br><span class="line">			<span class="keyword">if</span> (top-&gt;right)</span><br><span class="line">				nodeQueue.push(top-&gt;right);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(TreeNode* node1, TreeNode* node2)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!node1 &amp;&amp; !node2)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">if</span> (!node1 || !node2)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (node1-&gt;val != node2-&gt;val)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">bool</span> result = <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">if</span> (node2-&gt;left) &#123;</span><br><span class="line">			result *= check(node1-&gt;left, node2-&gt;left);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (node2-&gt;right) &#123;</span><br><span class="line">			result *= check(node1-&gt;right, node2-&gt;right);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="27-2叉树的镜像"><a href="#27-2叉树的镜像" class="headerlink" title="27 2叉树的镜像"></a>27 2叉树的镜像</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">操作给定的二叉树，将其变换为源二叉树的镜像。</span><br><span class="line">输入描述 :</span><br><span class="line">二叉树的镜像定义：源二叉树</span><br><span class="line">    8</span><br><span class="line">   / \</span><br><span class="line">  6   10</span><br><span class="line"> / \ / \</span><br><span class="line">5  7 9 11</span><br><span class="line">镜像二叉树</span><br><span class="line">    8</span><br><span class="line">   / \</span><br><span class="line">  10   6</span><br><span class="line"> / \ / \</span><br><span class="line">11 9 7  5</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Mirror</span><span class="params">(TreeNode *pRoot)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!pRoot)</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		TreeNode* tem = pRoot-&gt;left;</span><br><span class="line">		pRoot-&gt;left = pRoot-&gt;right;</span><br><span class="line">		pRoot-&gt;right = tem;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (pRoot-&gt;left)</span><br><span class="line">			Mirror(pRoot-&gt;left);</span><br><span class="line">		<span class="keyword">if</span> (pRoot-&gt;right)</span><br><span class="line">			Mirror(pRoot-&gt;right);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="28-对称的二叉树"><a href="#28-对称的二叉树" class="headerlink" title="28 对称的二叉树"></a>28 对称的二叉树</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">请实现一个函数，用来判断一颗二叉树是不是对称的。</span><br><span class="line">注意，如果一个二叉树同此二叉树的镜像是同样的，定义其为对称的。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">isSymmetrical</span><span class="params">(TreeNode* pRoot)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!pRoot)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">return</span> isMirror(pRoot-&gt;left, pRoot-&gt;right);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">isMirror</span><span class="params">(TreeNode* node1, TreeNode* node2)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!node1 &amp;&amp; !node2)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">if</span> (!node1 || !node2)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">if</span> (node1-&gt;val != node2-&gt;val)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> isMirror(node1-&gt;left, node2-&gt;right) &amp;&amp; isMirror(node1-&gt;right, node2-&gt;left);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="30-包含min函数的栈"><a href="#30-包含min函数的栈" class="headerlink" title="30 包含min函数的栈"></a>30 包含min函数的栈</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">定义栈的数据结构，请在该类型中实现一个能够得到栈最小元素的min函数。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (minValue &gt; value)</span><br><span class="line">			minValue = value;</span><br><span class="line">		minStack.push(minValue);</span><br><span class="line">		dataStack.push(value);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		dataStack.pop();</span><br><span class="line">		minStack.pop();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">top</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dataStack.top();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">min</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> minStack.top();</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">int</span> minValue = INT_MAX;</span><br><span class="line">	<span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; minStack;</span><br><span class="line">	<span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; dataStack;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="31-40-Problems"><a href="#31-40-Problems" class="headerlink" title="31 ~ 40 Problems"></a>31 ~ 40 Problems</h2><h3 id="31-栈的压入和弹出序列"><a href="#31-栈的压入和弹出序列" class="headerlink" title="31 栈的压入和弹出序列"></a>31 栈的压入和弹出序列</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">输入两个整数序列，第一个序列表示栈的压入顺序，请判断第二个序列是否为该栈的弹出顺序。</span><br><span class="line">假设压入栈的所有数字均不相等。</span><br><span class="line">例如序列1, 2, 3, 4, 5是某栈的压入顺序，序列4，5, 3, 2, 1是该压栈序列对应的一个弹出序列，</span><br><span class="line">但4, 3, 5, 1, 2就不可能是该压栈序列的弹出序列。（注意：这两个序列的长度是相等的）</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">IsPopOrder</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; pushV, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; popV)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (pushV.size() == <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">int</span> index1 = <span class="number">0</span>, index2 = <span class="number">0</span>;</span><br><span class="line">		<span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; dataStack;</span><br><span class="line">		<span class="keyword">while</span> (index1 &lt; pushV.size()) &#123;</span><br><span class="line">			<span class="keyword">do</span> &#123;</span><br><span class="line">				<span class="keyword">if</span> (index1 &gt;= pushV.size() || index2 &gt;= popV.size())</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				dataStack.push(pushV[index1]);</span><br><span class="line">			&#125; <span class="keyword">while</span> (pushV[index1++] != popV[index2]);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">while</span> (dataStack.size() &gt; <span class="number">0</span> &amp;&amp; dataStack.top() == popV[index2]) &#123;</span><br><span class="line">				dataStack.pop();</span><br><span class="line">				index2++;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> dataStack.size() == <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="32-从上到下打印二叉树"><a href="#32-从上到下打印二叉树" class="headerlink" title="32 从上到下打印二叉树"></a>32 从上到下打印二叉树</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">从上往下打印出二叉树的每个节点，同层节点从左至右打印。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//层序遍历二叉树本质上是广度优先遍历二叉树</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; PrintFromTopToBottom(TreeNode* root) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!root)</span><br><span class="line">			<span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;result;</span><br><span class="line">		<span class="built_in">queue</span>&lt;TreeNode*&gt; levelQueue;</span><br><span class="line">		levelQueue.push(root);</span><br><span class="line">		<span class="keyword">while</span> (levelQueue.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			TreeNode* node = levelQueue.front();</span><br><span class="line">			levelQueue.pop();</span><br><span class="line">			<span class="keyword">if</span> (node-&gt;left)</span><br><span class="line">				levelQueue.push(node-&gt;left);</span><br><span class="line">			<span class="keyword">if</span> (node-&gt;right)</span><br><span class="line">				levelQueue.push(node-&gt;right);</span><br><span class="line">			result.push_back(node-&gt;val);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">从上到下按层打印二叉树，同一层结点从左至右输出。每一层输出一行。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; Print(TreeNode* pRoot) &#123;</span><br><span class="line">		<span class="keyword">if</span> (pRoot == <span class="literal">NULL</span>)</span><br><span class="line">			<span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">		<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; result;</span><br><span class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; curruntLevel;</span><br><span class="line">		<span class="keyword">int</span> currunt = <span class="number">1</span>;</span><br><span class="line">		<span class="built_in">queue</span>&lt;TreeNode*&gt; nodeQueue;</span><br><span class="line">		nodeQueue.push(pRoot);</span><br><span class="line">		<span class="keyword">while</span> (nodeQueue.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			TreeNode* node = nodeQueue.front();</span><br><span class="line">			nodeQueue.pop();</span><br><span class="line">			<span class="keyword">if</span> (node-&gt;left)</span><br><span class="line">				nodeQueue.push(node-&gt;left);</span><br><span class="line">			<span class="keyword">if</span> (node-&gt;right)</span><br><span class="line">				nodeQueue.push(node-&gt;right);</span><br><span class="line">			curruntLevel.push_back(node-&gt;val);</span><br><span class="line">			currunt--;</span><br><span class="line">			<span class="keyword">if</span> (currunt == <span class="number">0</span>) &#123;</span><br><span class="line">				currunt = nodeQueue.size();</span><br><span class="line">				result.push_back(curruntLevel);</span><br><span class="line">				curruntLevel = <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">请实现一个函数按照之字形打印二叉树，</span><br><span class="line">即第一行按照从左到右的顺序打印，第二层按照从右至左的顺序打印，第三行按照从左到右的顺序打印，其他行以此类推。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//其实copy操作可以省去，用一个二维的数组和一个bool量实现</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; Print(TreeNode* pRoot) &#123;</span><br><span class="line">		<span class="keyword">if</span> (pRoot == <span class="literal">NULL</span>)</span><br><span class="line">			<span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">		<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; result;</span><br><span class="line">		<span class="built_in">vector</span>&lt;TreeNode*&gt; level1;</span><br><span class="line">		<span class="built_in">vector</span>&lt;TreeNode*&gt; level2;</span><br><span class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; curruntLevel;</span><br><span class="line">		level1.push_back(pRoot);</span><br><span class="line">		<span class="keyword">bool</span> currunt = <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">while</span> (level1.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; level1.size(); i++) &#123;</span><br><span class="line">				<span class="keyword">if</span> (level1[i]-&gt;left) &#123;</span><br><span class="line">					level2.push_back(level1[i]-&gt;left);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (level1[i]-&gt;right)</span><br><span class="line">					level2.push_back(level1[i]-&gt;right);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (currunt) &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; level1.size(); i++) &#123;</span><br><span class="line">					curruntLevel.push_back(level1[i]-&gt;val);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">int</span> i = level1.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">					curruntLevel.push_back(level1[i]-&gt;val);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			level1 = level2;</span><br><span class="line">			level2 = <span class="built_in">vector</span>&lt;TreeNode*&gt;();</span><br><span class="line">			result.push_back(curruntLevel);</span><br><span class="line">			curruntLevel = <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;();</span><br><span class="line">			currunt = !currunt;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="33-二叉树的后续遍历序列"><a href="#33-二叉树的后续遍历序列" class="headerlink" title="33 二叉树的后续遍历序列"></a>33 二叉树的后续遍历序列</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入一个整数数组，判断该数组是不是某二叉搜索树的后序遍历的结果。</span><br><span class="line">如果是则输出Yes, 否则输出No。假设输入的数组的任意两个数字都互不相同。</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">VerifySquenceOfBST</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; sequence)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (sequence.size() == <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		<span class="keyword">return</span> justify(sequence, <span class="number">0</span>, sequence.size() - <span class="number">1</span>);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">justify</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp;sequence, <span class="keyword">int</span> begin, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (begin == end)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">int</span> top = sequence[end];</span><br><span class="line">		<span class="keyword">int</span> firstLarge;</span><br><span class="line">		<span class="keyword">for</span> (firstLarge = begin; firstLarge &lt; end; firstLarge++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (sequence[firstLarge] &gt; top)</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = firstLarge; i &lt; end; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (sequence[i] &lt; top)</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (firstLarge == begin) &#123;</span><br><span class="line">			<span class="keyword">return</span> justify(sequence, begin, end - <span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (firstLarge == end)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> justify(sequence, begin, end - <span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> justify(sequence, begin, firstLarge - <span class="number">1</span>) &amp;&amp; justify(sequence, firstLarge, end - <span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="34-二叉树中和为某一值的路径"><a href="#34-二叉树中和为某一值的路径" class="headerlink" title="34 二叉树中和为某一值的路径"></a>34 二叉树中和为某一值的路径</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入一颗二叉树和一个整数，打印出二叉树中结点值的和为输入整数的所有路径。</span><br><span class="line">路径定义为从树的根结点开始往下一直到叶结点所经过的结点形成一条路径。</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; FindPath(TreeNode* root, <span class="keyword">int</span> expectNumber) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!root)</span><br><span class="line">			<span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">		<span class="keyword">this</span>-&gt;expectNumber = expectNumber;</span><br><span class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; pathNumbers;</span><br><span class="line">		find(pathNumbers, root, <span class="number">0</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>-&gt;paths;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; paths;</span><br><span class="line">	<span class="keyword">int</span> expectNumber;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">find</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; pathNumbers,TreeNode* node,<span class="keyword">int</span> total)</span> </span>&#123;</span><br><span class="line">		pathNumbers.push_back(node-&gt;val);</span><br><span class="line">		total += node-&gt;val;</span><br><span class="line">		<span class="keyword">if</span> (!node-&gt;left &amp;&amp; !node-&gt;right) &#123;</span><br><span class="line">			<span class="keyword">if</span> (total == <span class="keyword">this</span>-&gt;expectNumber) &#123;</span><br><span class="line">				<span class="keyword">this</span>-&gt;paths.push_back(pathNumbers);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (node-&gt;left) &#123;</span><br><span class="line">				find(pathNumbers, node-&gt;left, total);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (node-&gt;right) &#123;</span><br><span class="line">				find(pathNumbers, node-&gt;right, total);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (pathNumbers.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">			total -= pathNumbers.back();</span><br><span class="line">			pathNumbers.pop_back();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="35-复杂链表的复制"><a href="#35-复杂链表的复制" class="headerlink" title="35 复杂链表的复制"></a>35 复杂链表的复制</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">输入一个复杂链表（每个节点中有节点值，以及两个指针，一个指向下一个节点，</span><br><span class="line">另一个特殊指针指向任意一个节点），返回结果为复制后复杂链表的head。</span><br><span class="line">（注意，输出结果中请不要返回参数中的节点引用，否则判题程序会直接返回空）</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RandomListNode</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> label;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">RandomListNode</span> *<span class="title">next</span>, *<span class="title">random</span>;</span></span><br><span class="line">	RandomListNode(<span class="keyword">int</span> x) : label(x), next(<span class="literal">NULL</span>), random(<span class="literal">NULL</span>) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">RandomListNode* <span class="title">Clone</span><span class="params">(RandomListNode* pHead)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!pHead)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">		RandomListNode* node = pHead;</span><br><span class="line">		<span class="keyword">while</span> (node) &#123;</span><br><span class="line">			RandomListNode *newNode = <span class="keyword">new</span> RandomListNode(node-&gt;label);</span><br><span class="line">			newNode-&gt;next = node-&gt;next;</span><br><span class="line">			node-&gt;next = newNode;</span><br><span class="line"></span><br><span class="line">			node = newNode-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">		node = pHead;</span><br><span class="line">		<span class="keyword">while</span> (node) &#123;</span><br><span class="line">			<span class="keyword">if</span> (node-&gt;random) &#123;</span><br><span class="line">				node-&gt;next-&gt;random = node-&gt;random-&gt;next;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				node-&gt;next-&gt;random = <span class="literal">NULL</span>;</span><br><span class="line">			node = node-&gt;next-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line">		RandomListNode* newHead = <span class="keyword">new</span> RandomListNode(<span class="number">0</span>), *newNode;</span><br><span class="line">		newNode = newHead;</span><br><span class="line">		node = pHead;</span><br><span class="line">		<span class="keyword">while</span> (node) &#123;</span><br><span class="line">			newNode-&gt;next = node-&gt;next;</span><br><span class="line">			node-&gt;next = node-&gt;next-&gt;next;</span><br><span class="line"></span><br><span class="line">			newNode = newNode-&gt;next;</span><br><span class="line">			node = node-&gt;next;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		newNode = newHead-&gt;next;</span><br><span class="line">		<span class="keyword">delete</span> newHead;</span><br><span class="line">		<span class="keyword">return</span> newNode;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="36-二叉搜索树与双向链表"><a href="#36-二叉搜索树与双向链表" class="headerlink" title="36 二叉搜索树与双向链表"></a>36 二叉搜索树与双向链表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">输入一棵二叉搜索树，将该二叉搜索树转换成一个排序的双向链表。要求不能创建任何新的结点，只能调整树中结点指针的指向。</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">TreeNode* <span class="title">Convert</span><span class="params">(TreeNode* pRootOfTree)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!pRootOfTree)</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">		change(pRootOfTree);</span><br><span class="line">		<span class="keyword">while</span> (lagetestNode-&gt;left)</span><br><span class="line">			lagetestNode = lagetestNode-&gt;left;</span><br><span class="line">		<span class="keyword">return</span> lagetestNode;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="comment">//TreeNode* smallestNode;</span></span><br><span class="line">	TreeNode* lagetestNode = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(TreeNode* node)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (node-&gt;left) &#123;</span><br><span class="line">			change(node-&gt;left);</span><br><span class="line">		&#125;</span><br><span class="line">		node-&gt;left = lagetestNode;</span><br><span class="line">		<span class="keyword">if</span> (lagetestNode) &#123;</span><br><span class="line">			lagetestNode-&gt;right = node;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		lagetestNode = node;</span><br><span class="line">		<span class="keyword">if</span> (node-&gt;right) &#123;</span><br><span class="line">			change(node-&gt;right);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="37-序列化二叉树"><a href="#37-序列化二叉树" class="headerlink" title="37 序列化二叉树"></a>37 序列化二叉树</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请实现两个函数，分别用来序列化和反序列化二叉树</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">char</span>* <span class="title">Serialize</span><span class="params">(TreeNode *root)</span> </span>&#123;</span><br><span class="line">		<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; values;</span><br><span class="line">		Serial(root, values);</span><br><span class="line">		<span class="built_in">stringstream</span> ss;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; values.size(); i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (values[i] == <span class="number">-1</span>) &#123;</span><br><span class="line">				ss &lt;&lt; <span class="string">'$'</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				ss &lt;&lt; values[i];</span><br><span class="line">			&#125;</span><br><span class="line">			ss &lt;&lt; <span class="string">','</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> (<span class="keyword">char</span>*)ss.str().c_str();</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">TreeNode* <span class="title">Deserialize</span><span class="params">(<span class="keyword">char</span> *str)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Serial</span><span class="params">(TreeNode* node, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; values)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!node) &#123;</span><br><span class="line">			values.push_back(<span class="number">-1</span>);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		values.push_back(node-&gt;val);</span><br><span class="line">		Serial(node-&gt;left, values);</span><br><span class="line">		Serial(node-&gt;right, values);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="39-数组中出现次数超过一半的数字"><a href="#39-数组中出现次数超过一半的数字" class="headerlink" title="39 数组中出现次数超过一半的数字"></a>39 数组中出现次数超过一半的数字</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">数组中有一个数字出现的次数超过数组长度的一半，请找出这个数字。</span><br><span class="line">例如输入一个长度为9的数组&#123; 1,2,3,2,2,2,5,4,2 &#125;。</span><br><span class="line">由于数字2在数组中出现了5次，超过数组长度的一半，因此输出2。如果不存在则输出0。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">MoreThanHalfNum_Solution</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; numbers)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (numbers.size() &lt;= <span class="number">0</span>)</span><br><span class="line">			<span class="keyword">return</span> INT_MAX;</span><br><span class="line">		<span class="keyword">if</span> (numbers.size() == <span class="number">1</span>)</span><br><span class="line">			<span class="keyword">return</span> numbers[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">int</span> result = numbers[<span class="number">0</span>], times = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; numbers.size(); i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (numbers[i] != result) &#123;</span><br><span class="line">				--times;</span><br><span class="line">				<span class="keyword">if</span> (times == <span class="number">0</span>) &#123;</span><br><span class="line">					result = numbers[i];</span><br><span class="line">					times = <span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				times++;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> CheckHalf(result, numbers) ? result : <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">CheckHalf</span><span class="params">(<span class="keyword">int</span> number, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; numbers)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> times = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numbers.size(); i++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (numbers[i] == number) &#123;</span><br><span class="line">				times++;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> times &gt; numbers.size() / <span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="40-最小的k个数"><a href="#40-最小的k个数" class="headerlink" title="40 最小的k个数"></a>40 最小的k个数</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">输入n个整数，找出其中最小的K个数。</span><br><span class="line">例如输入4, 5, 1, 6, 2, 7, 3, 8这8个数字，则最小的4个数字是1, 2, 3, 4, 。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; GetLeastNumbers_Solution(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; input, <span class="keyword">int</span> k) &#123;</span><br><span class="line">		<span class="keyword">if</span> (k &lt;= <span class="number">0</span> || k &gt; input.size())</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>-&gt;result;</span><br><span class="line">		FindSmallestK(input, k, <span class="number">0</span>, input.size() - <span class="number">1</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>-&gt;result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; result;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">FindSmallestK</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; numbers, <span class="keyword">int</span> k, <span class="keyword">int</span> begin, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (k == <span class="number">0</span> || begin &gt; end)</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">if</span> (end - begin + <span class="number">1</span> &lt;= k) &#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = begin; i &lt;= end; i++) &#123;</span><br><span class="line">				<span class="keyword">this</span>-&gt;result.push_back(numbers[i]);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">int</span> num = numbers[end];</span><br><span class="line">		<span class="keyword">int</span> b = begin, e = end - <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span> (b &lt; e) &#123;</span><br><span class="line">			<span class="keyword">while</span> (b &lt; end &amp;&amp; numbers[b] &lt;= num)</span><br><span class="line">				++b;</span><br><span class="line">			<span class="keyword">while</span> (e &gt; begin &amp;&amp; numbers[e] &gt; num)</span><br><span class="line">				--e;</span><br><span class="line">			<span class="keyword">if</span> (b &lt; e)</span><br><span class="line">				swap(numbers[b], numbers[e]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(numbers[b] &gt; numbers[end])</span><br><span class="line">			swap(numbers[b], numbers[end]);</span><br><span class="line">		<span class="keyword">if</span> (b == end) &#123;</span><br><span class="line">			FindSmallestK(numbers, k, begin, end - <span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (b - begin + <span class="number">1</span> &lt;= k) &#123;</span><br><span class="line">			k -= b - begin + <span class="number">1</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = begin; i &lt;= b; i++) &#123;</span><br><span class="line">				result.push_back(numbers[i]);</span><br><span class="line">			&#125;</span><br><span class="line">			FindSmallestK(numbers, k, b + <span class="number">1</span>, end);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			FindSmallestK(numbers, k, begin, b);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="41-50-Problems"><a href="#41-50-Problems" class="headerlink" title="41 ~ 50 Problems"></a>41 ~ 50 Problems</h2><h3 id="42-连续子数组的最大和"><a href="#42-连续子数组的最大和" class="headerlink" title="42 连续子数组的最大和"></a>42 连续子数组的最大和</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HZ偶尔会拿些专业问题来忽悠那些非计算机专业的同学。</span><br><span class="line">今天测试组开完会后, 他又发话了:在古老的一维模式识别中, 常常需要计算连续子向量的最大和, 当向量全为正数的时候, 问题很好解决。但是, 如果向量中包含负数, 是否应该包含某个负数, 并期望旁边的正数会弥补它呢？</span><br><span class="line">例如 : &#123;6, -3, -2, 7, -15, 1, 2, 2&#125;, 连续子向量的最大和为8(从第0个开始, 到第3个为止)。</span><br><span class="line">你会不会被他忽悠住？(子向量的长度至少是1)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">FindGreatestSumOfSubArray</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="built_in">array</span>)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">array</span>.size() == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> max = INT_MIN, sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">int</span> begin = <span class="number">0</span>, end = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span> (end &lt; <span class="built_in">array</span>.size()) &#123;</span><br><span class="line">			sum += <span class="built_in">array</span>[end];</span><br><span class="line">			<span class="keyword">if</span> (sum &gt; max)</span><br><span class="line">				max = sum;</span><br><span class="line">			<span class="keyword">if</span> (sum &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">				begin = end + <span class="number">1</span>;</span><br><span class="line">				sum = <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			end++;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> max;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="43-1-n整数中1出现的次数"><a href="#43-1-n整数中1出现的次数" class="headerlink" title="43  1~n整数中1出现的次数"></a>43  1~n整数中1出现的次数</h3><p>题目：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">求出1~13的整数中1出现的次数,并算出100~1300的整数中1出现的次数？</span><br><span class="line">为此他特别数了一下1~13中包含1的数字有1、10、11、12、13因此共出现6次,但是对于后面问题他就没辙了。</span><br><span class="line">ACMer希望你们帮帮他,并把问题更加普遍化,可以很快的求出任意非负整数区间中1出现的次数。</span><br></pre></td></tr></table></figure></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">NumberOf1Between1AndN_Solution</span><span class="params">(<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> index = <span class="number">10</span>;</span><br><span class="line">		<span class="keyword">while</span> (index / <span class="number">10</span> &lt;= n) &#123;</span><br><span class="line">			<span class="keyword">int</span> res = n / index, rem = n % index;</span><br><span class="line">			<span class="keyword">if</span>(res &gt;= <span class="number">1</span>)</span><br><span class="line">				result += res * index / <span class="number">10</span>; </span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (rem &gt;= <span class="number">2</span> * index / <span class="number">10</span>) &#123;</span><br><span class="line">				result += index / <span class="number">10</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span>(rem &gt;= index / <span class="number">10</span> )&#123;</span><br><span class="line">				result += rem - (index / <span class="number">10</span>) + <span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			index *= <span class="number">10</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
    </footer>
  </div>
  
  
  
  </article>

    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/logo1.jpg"
      alt="Uyouii">
  <p class="site-author-name" itemprop="name">Uyouii</p>
  <div class="site-description motion-element" itemprop="description"></div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">tags</span>
        </a>
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/Uyouii" title="GitHub &rarr; https://github.com/Uyouii" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:taiyoudong@gmail.com" title="E-Mail &rarr; mailto:taiyoudong@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>



        </div>
      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Uyouii</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.3.0</div>

        








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
      </div>

    

  </div>

  
    
    
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  <script src="/js/utils.js?v=7.3.0"></script>

  
  <script src="/js/affix.js?v=7.3.0"></script>
  <script src="/js/schemes/pisces.js?v=7.3.0"></script>



  

  <script src="/js/next-boot.js?v=7.3.0"></script>

  

  

  


  

































    


</body>
</html>
